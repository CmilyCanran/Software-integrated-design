# 代码质量清理 - 执行时间表与检查清单

## 📅 第一阶段：安全风险修复（第1-2天）

### 🌅 Day 1 上午 - 环境变量化
**时间**: 9:00-12:00
**优先级**: 🔴 最高

#### 任务清单
- [ ] **备份关键文件**
  - [ ] 备份 `application.yml`
  - [ ] 备份 `JwtUtil.java`
  - [ ] 备份 `request.ts`

- [ ] **后端配置环境变量化**
  - [ ] 修改 `application.yml`:
    ```yaml
    spring:
      datasource:
        url: ${DB_URL:jdbc:postgresql://localhost:5432/clothes_db}
        username: ${DB_USERNAME:postgres}
        password: ${DB_PASSWORD:123456}
    ```

- [ ] **JWT密钥环境变量化**
  - [ ] 修改 `JwtUtil.java` 第39行:
    ```java
    private String secret = System.getenv("JWT_SECRET");
    ```

- [ ] **前端配置环境变量化**
  - [ ] 修改 `request.ts` 第14行:
    ```typescript
    const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api'
    ```

#### 验证清单
- [ ] 应用能正常启动
- [ ] 数据库连接正常
- [ ] JWT认证功能正常

### 🌆 Day 1 下午 - CORS安全加固
**时间**: 14:00-17:00
**优先级**: 🔴 最高

#### 任务清单
- [ ] **修改CORS配置**
  - [ ] 编辑 `WebSecurityConfig.java`
  - [ ] 移除 `setAllowedOriginPatterns("*")`
  - [ ] 添加具体域名配置

#### 验证清单
- [ ] 前端能正常访问后端API
- [ ] 跨域请求正常工作
- [ ] 安全扫描通过

### 🌙 Day 1 晚上 - 创建环境变量模板
**时间**: 19:00-21:00
**优先级**: 🟡 高

#### 任务清单
- [ ] **创建 `.env.example`**
  ```
  # 数据库配置
  DB_URL=jdbc:postgresql://localhost:5432/clothes_db
  DB_USERNAME=postgres
  DB_PASSWORD=your_password_here

  # JWT配置
  JWT_SECRET=your_secret_key_here

  # API配置
  VITE_API_BASE_URL=http://localhost:8080/api
  VITE_REQUEST_TIMEOUT=10000
  ```

#### 验证清单
- [ ] 环境变量模板完整
- [ ] 文档说明清楚

---

### 🌅 Day 2 上午 - 输入验证增强
**时间**: 9:00-12:00
**优先级**: 🔴 最高

#### 任务清单
- [ ] **AuthController输入验证**
  - [ ] 创建 `LoginRequest.java` DTO类
  - [ ] 添加 `@Valid` 注解
  - [ ] 添加字段验证注解

- [ ] **ProductController输入验证**
  - [ ] 创建相应DTO类
  - [ ] 添加参数验证
  - [ ] 测试验证逻辑

#### 验证清单
- [ ] 登录功能正常
- [ ] 参数验证生效
- [ ] 错误提示友好

---

## 📅 第二阶段：代码质量提升（第3-5天）

### 🌅 Day 3 上午 - 日志统一化
**时间**: 9:00-12:00
**优先级**: 🟡 高

#### 任务清单
- [ ] **移除System.out/err**
  - [ ] 搜索所有 `System.out.println`
  - [ ] 搜索所有 `System.err.println`
  - [ ] 替换为 `log.info()` 或 `log.error()`

- [ ] **GlobalExceptionHandler优化**
  - [ ] 移除 `e.printStackTrace()`
  - [ ] 添加适当的日志记录

#### 验证清单
- [ ] 日志输出正常
- [ ] 错误信息不暴露敏感信息

### 🌆 Day 3 下午 - 错误处理统一化
**时间**: 14:00-17:00
**优先级**: 🟡 高

#### 任务清单
- [ ] **后端错误格式统一**
  - [ ] 检查所有控制器返回格式
  - [ ] 确保使用 `ApiResponse` 包装

- [ ] **前端错误处理统一**
  - [ ] 优化 `request.ts` 错误处理
  - [ ] 移除组件中重复的错误处理

#### 验证清单
- [ ] 错误响应格式一致
- [ ] 前端错误显示正常

---

### 🌅 Day 4 上午 - 创建BaseController
**时间**: 9:00-12:00
**优先级**: 🟡 高

#### 任务清单
- [ ] **创建BaseController基类**
  - [ ] 提取通用认证逻辑
  - [ ] 提取通用错误处理
  - [ ] 提取通用响应方法

- [ ] **重构现有Controller**
  - [ ] 让 `AuthController` 继承 `BaseController`
  - [ ] 让 `ProductController` 继承 `BaseController`
  - [ ] 移除重复代码

#### 验证清单
- [ ] 控制器功能正常
- [ ] 重复代码已消除
- [ ] 代码结构更清晰

### 🌆 Day 4 下午 - DTO转换工具
**时间**: 14:00-17:00
**优先级**: 🟢 中

#### 任务清单
- [ ] **创建DtoConverter工具类**
  - [ ] 提取通用转换方法
  - [ ] 优化转换逻辑

- [ ] **应用到各Controller**
  - [ ] 使用新的转换工具
  - [ ] 移除重复转换代码

#### 验证清单
- [ ] DTO转换正常
- [ ] 数据映射正确

---

### 🌅 Day 5 全天 - 前端类型安全修复
**时间**: 9:00-17:00
**优先级**: 🟡 高

#### 任务清单
- [ ] **移除as any使用**
  - [ ] 搜索所有 `as any`
  - [ ] 添加正确类型定义
  - [ ] 修复类型错误

- [ ] **修复SearchBox内存泄漏**
  - [ ] 检查事件监听器清理
  - [ ] 添加proper cleanup

- [ ] **重构ProductForm逻辑**
  - [ ] 简化规格处理
  - [ ] 拆分复杂函数

#### 验证清单
- [ ] TypeScript编译无错误
- [ ] 组件功能正常
- [ ] 内存使用正常

---

## 📅 第三阶段：性能优化与测试（第6-8天）

### 🌅 Day 6 上午 - Redis缓存实现
**时间**: 9:00-12:00
**优先级**: 🟢 中

#### 任务清单
- [ ] **添加Redis依赖**
- [ ] **配置Redis连接**
- [ ] **实现缓存策略**
- [ ] **测试缓存功能**

### 🌆 Day 6 下午 - 前端性能优化
**时间**: 14:00-17:00
**优先级**: 🟢 中

#### 任务清单
- [ ] **Element Plus按需加载**
- [ ] **请求去重机制**
- [ ] **组件渲染优化**

---

### 🌅 Day 7-8 全天 - 测试覆盖
**时间**: 9:00-17:00
**优先级**: 🟢 中

#### 任务清单
- [ ] **后端单元测试**
- [ ] **集成测试**
- [ ] **前端单元测试**
- [ ] **API契约测试**

---

## ✅ 总体验证清单

### 功能验证
- [ ] 用户登录注册正常
- [ ] 商品管理功能正常
- [ ] 图片上传功能正常
- [ ] 权限控制正常

### 性能验证
- [ ] 页面加载时间 < 3秒
- [ ] API响应时间 < 500ms
- [ ] 内存使用稳定

### 安全验证
- [ ] 无硬编码敏感信息
- [ ] CORS配置安全
- [ ] 输入验证有效
- [ ] 错误信息不泄露

### 代码质量验证
- [ ] 无编译错误
- [ ] 无ESLint/Checkstyle警告
- [ ] 测试覆盖率 > 80%
- [ ] 代码重复率 < 5%

---

## 🚨 风险控制

### 回滚计划
- [ ] 每个阶段开始前创建git分支
- [ ] 关键修改前备份文件
- [ ] 测试失败立即回滚

### 质量门禁
- [ ] 代码审查通过
- [ ] 自动化测试通过
- [ ] 安全扫描通过
- [ ] 性能测试通过

---

**执行开始时间**: 2025-12-01
**预计完成时间**: 2025-12-08
**总工作量**: 8天
**检查点**: 每天结束时进行进度检查