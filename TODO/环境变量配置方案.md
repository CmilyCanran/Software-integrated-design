# ç¯å¢ƒå˜é‡é…ç½®æ–¹æ¡ˆ - é¡¹ç›®æ–‡ä»¶æ–¹å¼

## ğŸ¯ ç›®æ ‡

å°†ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯è½¬ç§»åˆ°é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­ï¼Œå®ç°ï¼š
- å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»
- é…ç½®é›†ä¸­ç®¡ç†
- æ•æ„Ÿä¿¡æ¯ä¸æš´éœ²åœ¨ä»£ç ä¸­
- å›¢é˜Ÿåä½œå‹å¥½

## ğŸ“‹ æ¨èæ–¹æ¡ˆï¼šSpring Boot Profile + Vite ç¯å¢ƒå˜é‡

### ğŸŒŸ æ–¹æ¡ˆä¼˜åŠ¿
- âœ… **Spring Boot åŸç”Ÿæ”¯æŒ**ï¼šæ— éœ€é¢å¤–ä¾èµ–
- âœ… **IDE å‹å¥½**ï¼šé…ç½®æ–‡ä»¶æœ‰è¯­æ³•é«˜äº®å’Œæç¤º
- âœ… **ç¯å¢ƒåˆ†ç¦»**ï¼šdev/prod/test ç¯å¢ƒç‹¬ç«‹é…ç½®
- âœ… **ç±»å‹å®‰å…¨**ï¼šé€šè¿‡é…ç½®ç±»æä¾›ç±»å‹æ£€æŸ¥
- âœ… **ç®€å•æ˜“ç”¨**ï¼šå›¢é˜Ÿæˆå‘˜å®¹æ˜“ç†è§£å’Œç»´æŠ¤

---

## ğŸ”§ åç«¯é…ç½®æ–¹æ¡ˆ

### 1. ä¸»é…ç½®æ–‡ä»¶ - application.yml
```yaml
spring:
  application:
    name: SpringWeb
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}  # é»˜è®¤å¼€å‘ç¯å¢ƒ

# åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    defer-datasource-initialization: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  jackson:
    serialization:
      fail-on-empty-beans: false
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

  servlet:
    multipart:
      max-file-size: 5MB
      max-request-size: 5MB
      enabled: true

  web:
    resources:
      static-locations: classpath:/static/,file:uploads/

# æ—¥å¿—é…ç½®
logging:
  level:
    com.cmliy.springweb: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
```

### 2. å¼€å‘ç¯å¢ƒé…ç½® - application-dev.yml
```yaml
# å¼€å‘ç¯å¢ƒæ•°æ®åº“é…ç½®
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/clothes_db
    username: postgres
    password: 123456
    driver-class-name: org.postgresql.Driver

  sql:
    init:
      mode: always
      encoding: UTF-8
      continue-on-error: false
      data-locations: classpath:data.sql

# å›¾ç‰‡å­˜å‚¨é…ç½® - å¼€å‘ç¯å¢ƒ
image:
  storage:
    upload-dir: ./uploads/images
    base-url: http://localhost:8080/api/images
    max-file-size: 5242880
    allowed-types:
      - image/jpeg
      - image/png
      - image/gif

app:
  image:
    storage:
      path: D:\Code\Learn\Java\Spring\image\uploads\images

# è‡ªå®šä¹‰åº”ç”¨é…ç½®
app-config:
  jwt:
    secret: mySecretKey123456789012345678901234567890
    expiration: 86400000  # 24å°æ—¶

  cors:
    allowed-origins:
      - http://localhost:5173
      - http://127.0.0.1:5173
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    allowed-headers:
      - "*"
    allow-credentials: true
```

### 3. ç”Ÿäº§ç¯å¢ƒé…ç½® - application-prod.yml
```yaml
# ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“é…ç½®
spring:
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/clothes_prod}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:your_prod_password}
    driver-class-name: org.postgresql.Driver

  sql:
    init:
      mode: never  # ç”Ÿäº§ç¯å¢ƒä¸è‡ªåŠ¨åˆå§‹åŒ–
      encoding: UTF-8

# å›¾ç‰‡å­˜å‚¨é…ç½® - ç”Ÿäº§ç¯å¢ƒ
image:
  storage:
    upload-dir: ${IMAGE_UPLOAD_DIR:/app/uploads/images}
    base-url: ${IMAGE_BASE_URL:https://your-domain.com/api/images}
    max-file-size: 5242880
    allowed-types:
      - image/jpeg
      - image/png
      - image/gif

app:
  image:
    storage:
      path: ${IMAGE_STORAGE_PATH:/app/uploads/images}

# è‡ªå®šä¹‰åº”ç”¨é…ç½®
app-config:
  jwt:
    secret: ${JWT_SECRET:yourProductionSecretKeyHere}
    expiration: ${JWT_EXPIRATION:86400000}

  cors:
    allowed-origins:
      - https://your-domain.com
      - https://www.your-domain.com
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    allowed-headers:
      - "*"
    allow-credentials: true
```

### 4. é…ç½®ç±» - AppConfig.java
```java
package com.cmliy.springweb.config;

import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Configuration;
import lombok.Data;

@Data
@Configuration
@ConfigurationProperties(prefix = "app-config")
public class AppConfig {

    @Data
    public static class JwtConfig {
        private String secret;
        private Long expiration;
    }

    @Data
    public static class CorsConfig {
        private String[] allowedOrigins;
        private String[] allowedMethods;
        private String[] allowedHeaders;
        private Boolean allowCredentials;
    }

    private JwtConfig jwt = new JwtConfig();
    private CorsConfig cors = new CorsConfig();
}
```

### 5. ä¿®æ”¹ JwtUtil.java ä½¿ç”¨é…ç½®
```java
@Component
public class JwtUtil {

    @Autowired
    private AppConfig appConfig;

    public String generateToken(UserDetails userDetails) {
        // ä½¿ç”¨é…ç½®ä¸­çš„å¯†é’¥
        String secret = appConfig.getJwt().getSecret();
        Long expiration = appConfig.getJwt().getExpiration();

        // ... JWTç”Ÿæˆé€»è¾‘
    }
}
```

---

## ğŸŒ å‰ç«¯é…ç½®æ–¹æ¡ˆ

### 1. å¼€å‘ç¯å¢ƒé…ç½® - .env.development
```bash
# å¼€å‘ç¯å¢ƒ API é…ç½®
VITE_API_BASE_URL=http://localhost:8080/api
VITE_REQUEST_TIMEOUT=10000

# å¼€å‘ç¯å¢ƒå…¶ä»–é…ç½®
VITE_UPLOAD_MAX_SIZE=5242880
VITE_SUPPORTED_IMAGE_TYPES=jpeg,png,gif
```

### 2. ç”Ÿäº§ç¯å¢ƒé…ç½® - .env.production
```bash
# ç”Ÿäº§ç¯å¢ƒ API é…ç½®
VITE_API_BASE_URL=https://your-domain.com/api
VITE_REQUEST_TIMEOUT=15000

# ç”Ÿäº§ç¯å¢ƒå…¶ä»–é…ç½®
VITE_UPLOAD_MAX_SIZE=5242880
VITE_SUPPORTED_IMAGE_TYPES=jpeg,png,gif
```

### 3. ç¯å¢ƒå˜é‡æ¨¡æ¿ - .env.example
```bash
# API é…ç½®
VITE_API_BASE_URL=http://localhost:8080/api
VITE_REQUEST_TIMEOUT=10000

# æ–‡ä»¶ä¸Šä¼ é…ç½®
VITE_UPLOAD_MAX_SIZE=5242880
VITE_SUPPORTED_IMAGE_TYPES=jpeg,png,gif

# å…¶ä»–é…ç½®
VITE_APP_TITLE=æœè£…é”€å”®ç³»ç»Ÿ
VITE_APP_VERSION=1.0.0
```

### 4. ä¿®æ”¹ request.ts ä½¿ç”¨ç¯å¢ƒå˜é‡
```typescript
const request: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api',
  timeout: Number(import.meta.env.VITE_REQUEST_TIMEOUT) || 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è·å–å…¶ä»–é…ç½®
const UPLOAD_MAX_SIZE = Number(import.meta.env.VITE_UPLOAD_MAX_SIZE) || 5242880
const SUPPORTED_TYPES = (import.meta.env.VITE_SUPPORTED_IMAGE_TYPES || 'jpeg,png,gif').split(',')
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¼€å‘ç¯å¢ƒå¯åŠ¨
```bash
# åç«¯ - é»˜è®¤ä½¿ç”¨ dev profile
mvn spring-boot:run

# å‰ç«¯ - é»˜è®¤ä½¿ç”¨ development
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# åç«¯ - æŒ‡å®šç”Ÿäº§ç¯å¢ƒ
mvn spring-boot:run -Dspring-boot.run.profiles=prod

# æˆ–è€…è®¾ç½®ç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=prod
mvn spring-boot:run

# å‰ç«¯ - æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
SpringWeb/
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml              # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ application-dev.yml          # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ data.sql                     # å¼€å‘ç¯å¢ƒæ•°æ®åˆå§‹åŒ–
â”œâ”€â”€ src/main/java/com/cmliy/springweb/config/
â”‚   â””â”€â”€ AppConfig.java               # é…ç½®ç±»
â””â”€â”€ frontend/
    â”œâ”€â”€ .env.development             # å‰ç«¯å¼€å‘ç¯å¢ƒ
    â”œâ”€â”€ .env.production              # å‰ç«¯ç”Ÿäº§ç¯å¢ƒ
    â””â”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
```

---

## âœ… é…ç½®éªŒè¯æ¸…å•

### åç«¯éªŒè¯
- [ ] å¼€å‘ç¯å¢ƒèƒ½æ­£å¸¸å¯åŠ¨å¹¶è¿æ¥æ•°æ®åº“
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®èƒ½æ­£ç¡®è¯»å–ç¯å¢ƒå˜é‡
- [ ] JWTå¯†é’¥ä»é…ç½®æ–‡ä»¶æ­£ç¡®è¯»å–
- [ ] CORSé…ç½®æŒ‰ç¯å¢ƒç”Ÿæ•ˆ

### å‰ç«¯éªŒè¯
- [ ] å¼€å‘ç¯å¢ƒAPIè¯·æ±‚æŒ‡å‘æ­£ç¡®åœ°å€
- [ ] ç”Ÿäº§ç¯å¢ƒæ„å»ºåAPIåœ°å€æ­£ç¡®
- [ ] ç¯å¢ƒå˜é‡åœ¨ä»£ç ä¸­æ­£ç¡®ä½¿ç”¨
- [ ] ç±»å‹å®‰å…¨æ£€æŸ¥é€šè¿‡

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ
- âœ… å¯ä»¥ä½¿ç”¨é»˜è®¤å¯†ç å’Œå¯†é’¥
- âœ… é…ç½®æ–‡ä»¶å¯ä»¥æäº¤åˆ°ä»£ç åº“
- âœ… ä¾¿äºå›¢é˜Ÿåä½œå¼€å‘

### ç”Ÿäº§ç¯å¢ƒ
- âš ï¸ **æ•æ„Ÿä¿¡æ¯å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥**
- âš ï¸ **ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸åº”åŒ…å«çœŸå®å¯†ç **
- âš ï¸ **ç¡®ä¿ .env æ–‡ä»¶ä¸è¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶**

### .gitignore é…ç½®
```gitignore
# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
.env.*.local

# ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå¦‚æœåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
application-prod.yml
```

---

## ğŸ¯ è¿ç§»æ­¥éª¤

1. **åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶ç»“æ„**
2. **ç§»åŠ¨ç°æœ‰é…ç½®åˆ°å¯¹åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶**
3. **åˆ›å»ºé…ç½®ç±»è¯»å–è‡ªå®šä¹‰é…ç½®**
4. **ä¿®æ”¹ä»£ç ä½¿ç”¨é…ç½®ç±»**
5. **æµ‹è¯•å¼€å‘ç¯å¢ƒé…ç½®**
6. **é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡**
7. **æµ‹è¯•ç”Ÿäº§ç¯å¢ƒé…ç½®**

è¿™ç§æ–¹æ¡ˆæ—¢ä¿æŒäº†é…ç½®çš„çµæ´»æ€§ï¼Œåˆç¡®ä¿äº†å®‰å…¨æ€§ï¼Œéå¸¸é€‚åˆä½ çš„é¡¹ç›®éœ€æ±‚ï¼