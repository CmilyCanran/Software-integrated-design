# ğŸ—„ï¸ æ•°æ®åº“è¡¨è®¾è®¡æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**ç›®æ ‡**ï¼šä»MySQLè¿ç§»åˆ°PostgreSQLï¼Œé‡‡ç”¨æ··åˆæ–¹æ¡ˆç®¡ç†å•†å“å±æ€§å’Œå›¾ç‰‡
- **åŸºæœ¬å­—æ®µ**ï¼šä½¿ç”¨ä¼ ç»Ÿå…³ç³»å‹å­—æ®µå­˜å‚¨æ ¸å¿ƒä¿¡æ¯
- **æ‰©å±•å­—æ®µ**ï¼šä½¿ç”¨JSONBå­˜å‚¨åŠ¨æ€å±æ€§ï¼Œé¿å…EAVæ¨¡å¼å¤æ‚æ€§
- **å›¾ç‰‡å­˜å‚¨**ï¼šæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å›¾ç‰‡ï¼ŒJSONBå­˜å‚¨URLå’Œå…ƒæ•°æ®

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### 1. ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    -- åŸºç¡€å­—æ®µ
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL DEFAULT 'USER',
    enabled BOOLEAN NOT NULL DEFAULT true,

    -- JSONBæ‰©å±•å­—æ®µ
    metadata JSONB DEFAULT '{}',
    attributes JSONB DEFAULT '{}',

    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_metadata_gin ON users USING GIN(metadata);
CREATE INDEX idx_users_attributes_gin ON users USING GIN(attributes);
```

**å­—æ®µè¯´æ˜**ï¼š
- `id`: ä¸»é”®ï¼Œè‡ªå¢
- `username`: ç”¨æˆ·åï¼Œå”¯ä¸€ç´¢å¼•
- `email`: é‚®ç®±ï¼Œå”¯ä¸€ç´¢å¼•
- `password`: åŠ å¯†å¯†ç 
- `role`: ç”¨æˆ·è§’è‰² (USER/ADMIN/SHOPER)
- `enabled`: è´¦æˆ·å¯ç”¨çŠ¶æ€
- `metadata`: JSONBå­˜å‚¨ç”¨æˆ·å…ƒæ•°æ®
- `attributes`: JSONBå­˜å‚¨ç”¨æˆ·æ‰©å±•å±æ€§
- `created_at/updated_at`: æ—¶é—´æˆ³

---

### 2. å•†å“è¡¨ (products)

```sql
CREATE TABLE products (
    -- åŸºç¡€å­—æ®µ
    id BIGSERIAL PRIMARY KEY,
    product_name VARCHAR(50) UNIQUE NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    creator_id BIGINT NOT NULL,
    is_available BOOLEAN NOT NULL DEFAULT false,
    stock_quantity INTEGER NOT NULL DEFAULT 0,

    -- æ–°å¢åŸºæœ¬å­—æ®µ
    description TEXT,
    sales_count INTEGER DEFAULT 0,
    discount DECIMAL(5,2) DEFAULT 0.00,

    -- JSONBå­—æ®µ
    product_data JSONB DEFAULT '{}',

    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (creator_id) REFERENCES users(id) ON DELETE CASCADE
);

-- åŸºç¡€ç´¢å¼•
CREATE INDEX idx_products_name ON products(product_name);
CREATE INDEX idx_products_creator ON products(creator_id);
CREATE INDEX idx_products_price ON products(price);
CREATE INDEX idx_products_available ON products(is_available);
CREATE INDEX idx_products_sales_count ON products(sales_count);
CREATE INDEX idx_products_discount ON products(discount);

-- JSONBç´¢å¼•
CREATE INDEX idx_products_image_data_gin ON products USING GIN(image_data);
CREATE INDEX idx_products_specifications_gin ON products USING GIN(specifications);
CREATE INDEX idx_products_tags_gin ON products USING GIN(tags);
CREATE INDEX idx_products_extended_attributes_gin ON products USING GIN(extended_attributes);

-- JSONBè·¯å¾„ç´¢å¼•
CREATE INDEX idx_products_main_image ON products ((image_data->>'main_image'));
CREATE INDEX idx_products_spec_color ON products ((specifications->>'color'));
CREATE INDEX idx_products_spec_size ON products ((specifications->>'size'));
CREATE INDEX idx_products_spec_category ON products ((specifications->>'category'));
```

**å­—æ®µè¯´æ˜**ï¼š
- `id`: ä¸»é”®ï¼Œè‡ªå¢
- `product_name`: å•†å“åç§°ï¼Œå”¯ä¸€ç´¢å¼•
- `price`: å•†å“ä»·æ ¼ï¼Œç²¾åº¦10ä½å°æ•°2ä½
- `creator_id`: åˆ›å»ºè€…IDï¼Œå¤–é”®
- `is_available`: ä¸Šæ¶çŠ¶æ€
- `stock_quantity`: åº“å­˜æ•°é‡
- `description`: å•†å“æè¿°ï¼ŒTEXTç±»å‹
- `sales_count`: é”€é‡ç»Ÿè®¡
- `discount`: æŠ˜æ‰£ç‡ï¼Œç²¾åº¦5ä½å°æ•°2ä½
- `product_data`: JSONBå­˜å‚¨å•†å“æ‰€æœ‰æ‰©å±•ä¿¡æ¯
### 3. è®¢å•è¡¨ (orders)

```sql
CREATE TABLE orders (
    -- åŸºç¡€å­—æ®µ
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    order_date DATE NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING',

    -- JSONBå­—æ®µ
    order_metadata JSONB DEFAULT '{}',
    order_items JSONB DEFAULT '[]',

    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT
);

-- ç´¢å¼•
CREATE INDEX idx_orders_user ON orders(user_id);
CREATE INDEX idx_orders_date ON orders(order_date);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_total_amount ON orders(total_amount);

-- JSONBç´¢å¼•
CREATE INDEX idx_orders_metadata_gin ON orders USING GIN(order_metadata);
CREATE INDEX idx_orders_items_gin ON orders USING GIN(order_items);
```

**å­—æ®µè¯´æ˜**ï¼š
- `id`: è®¢å•ä¸»é”®
- `user_id`: ç”¨æˆ·IDï¼Œå¤–é”®
- `order_date`: è®¢å•æ—¥æœŸ
- `total_amount`: è®¢å•æ€»é‡‘é¢
- `status`: è®¢å•çŠ¶æ€ (PENDING/CONFIRMED/SHIPPED/DELIVERED/CANCELLED)
- `order_metadata`: JSONBå­˜å‚¨è®¢å•å…ƒæ•°æ®
- `order_items`: JSONBå­˜å‚¨è®¢å•å•†å“åˆ—è¡¨


## ğŸ¯ æ€»ç»“

è¿™ä¸ªè®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
1. **ç®€æ´å®ç”¨** - é¿å…è¿‡åº¦å¤æ‚çš„è®¾è®¡
2. **æ€§èƒ½ä¼˜å…ˆ** - åˆç†ä½¿ç”¨ç´¢å¼•å’ŒJSONBä¼˜åŠ¿
3. **æ˜“äºæ‰©å±•** - JSONBå­—æ®µæ”¯æŒçµæ´»æ‰©å±•
4. **æ•°æ®ä¸€è‡´æ€§** - å¤–é”®çº¦æŸç¡®ä¿æ•°æ®å®Œæ•´æ€§
5. **ç»´æŠ¤å‹å¥½** - æ¸…æ™°çš„è¡¨ç»“æ„å’Œå‘½åè§„èŒƒ

