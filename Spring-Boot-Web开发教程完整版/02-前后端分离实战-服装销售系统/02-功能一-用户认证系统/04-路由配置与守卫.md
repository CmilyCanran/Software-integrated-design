# ç¬¬4ç« ï¼šè·¯ç”±é…ç½®ä¸å®ˆå«

> **å­¦ä¹ ç›®æ ‡**ï¼šé…ç½®Vue Routerï¼Œå®ç°é¡µé¢è®¿é—®æƒé™æ§åˆ¶

## ğŸ¯ æœ¬ç« æ¦‚è§ˆ

| å†…å®¹ | é¢„è®¡æ—¶é—´ | éš¾åº¦ | çŠ¶æ€ |
|------|----------|------|------|
| è·¯ç”±åŸºç¡€é…ç½® | 10åˆ†é’Ÿ | â­â­ | â³ |
| è·¯ç”±å®ˆå«å®ç° | 15åˆ†é’Ÿ | â­â­â­ | â³ |
| æƒé™æ§åˆ¶é€»è¾‘ | 5åˆ†é’Ÿ | â­â­ | â³ |

---

## ğŸ›£ï¸ è·¯ç”±é…ç½®åŸºç¡€

### ä¿®æ”¹ `src/router/index.js`

```javascript
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: '/',
      redirect: '/dashboard'
    },
    {
      path: '/dashboard',
      name: 'dashboard',
      component: () => import('../views/Dashboard.vue'),
      meta: { requiresAuth: true }
    },
    {
      path: '/login',
      name: 'login',
      component: () => import('../views/Login.vue'),
      meta: { guest: true }
    },
    {
      path: '/register',
      name: 'register',
      component: () => import('../views/Register.vue'),
      meta: { guest: true }
    }
  ]
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()

  // éœ€è¦ç™»å½•çš„é¡µé¢
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login')
    return
  }

  // å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•/æ³¨å†Œé¡µé¢ï¼Œé‡å®šå‘åˆ°é¦–é¡µ
  if (to.meta.guest && authStore.isLoggedIn) {
    next('/dashboard')
    return
  }

  next()
})

export default router
```

### è·¯ç”±é…ç½®è¯¦è§£

#### **æ ¹è·¯å¾„é‡å®šå‘**
```javascript
{
  path: '/',
  redirect: '/dashboard'
}
```
ç”¨æˆ·è®¿é—®ç½‘ç«™æ ¹ç›®å½•æ—¶è‡ªåŠ¨è·³è½¬åˆ°ä»ªè¡¨æ¿

#### **å—ä¿æŠ¤é¡µé¢**
```javascript
{
  path: '/dashboard',
  meta: { requiresAuth: true }
}
```
`requiresAuth: true` è¡¨ç¤ºéœ€è¦ç™»å½•æ‰èƒ½è®¿é—®

#### **æ¸¸å®¢é¡µé¢**
```javascript
{
  path: '/login',
  meta: { guest: true }
}
```
`guest: true` è¡¨ç¤ºæœªç™»å½•ç”¨æˆ·ä¸“ç”¨é¡µé¢

---

## ğŸš¨ è·¯ç”±å®ˆå«è¯¦è§£

### `beforeEach` å®ˆå«å‚æ•°

```javascript
router.beforeEach((to, from, next) => {
  // to: å³å°†è¦è¿›å…¥çš„ç›®æ ‡è·¯ç”±
  // from: å½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„è·¯ç”±
  // next: å¿…é¡»è°ƒç”¨çš„å‡½æ•°
})
```

### å®ˆå«é€»è¾‘è¯¦è§£

#### **æƒé™æ£€æŸ¥é€»è¾‘**
```javascript
// 1. æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•
if (to.meta.requiresAuth && !authStore.isLoggedIn) {
  next('/login')  // é‡å®šå‘åˆ°ç™»å½•é¡µ
  return
}

// 2. æ£€æŸ¥æ˜¯å¦ä¸ºæ¸¸å®¢é¡µé¢
if (to.meta.guest && authStore.isLoggedIn) {
  next('/dashboard')  // å·²ç™»å½•ç”¨æˆ·é‡å®šå‘åˆ°ä»ªè¡¨æ¿
  return
}

// 3. å…è®¸æ­£å¸¸è®¿é—®
next()
```

### å®Œæ•´çš„æƒé™æ§åˆ¶

```javascript
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()

  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  document.title = to.meta.title || 'æœè£…é”€å”®ç³»ç»Ÿ'

  // æ£€æŸ¥è·¯ç”±æƒé™
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    ElMessage.warning('è¯·å…ˆç™»å½•')
    next({
      path: '/login',
      query: { redirect: to.fullPath }  // ä¿å­˜ç›®æ ‡è·¯å¾„
    })
    return
  }

  // ç®¡ç†å‘˜æƒé™æ£€æŸ¥
  if (to.meta.requiresAdmin && !authStore.isAdmin) {
    ElMessage.error('éœ€è¦ç®¡ç†å‘˜æƒé™')
    next('/dashboard')
    return
  }

  // å·²ç™»å½•ç”¨æˆ·è®¿é—®æ¸¸å®¢é¡µé¢
  if (to.meta.guest && authStore.isLoggedIn) {
    next('/dashboard')
    return
  }

  next()
})
```

---

## ğŸ› ï¸ å®è·µç»ƒä¹ 

### ç™»å½•åè·³è½¬åˆ°ç›®æ ‡é¡µé¢
```javascript
// åœ¨ç™»å½•ç»„ä»¶ä¸­
const handleLogin = async () => {
  const result = await authStore.login(loginForm)

  if (result.success) {
    ElMessage.success('ç™»å½•æˆåŠŸ')

    // è·³è½¬åˆ°ç›®æ ‡é¡µé¢æˆ–é»˜è®¤é¡µé¢
    const redirect = router.currentRoute.value.query.redirect || '/dashboard'
    router.push(redirect)
  }
}
```

### åŠ¨æ€è·¯ç”±æƒé™
```javascript
// æ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€æ·»åŠ è·¯ç”±
const addAdminRoutes = () => {
  if (authStore.isAdmin) {
    router.addRoute('admin', {
      path: '/admin',
      name: 'admin',
      component: () => import('../views/Admin.vue'),
      meta: { requiresAuth: true, requiresAdmin: true }
    })
  }
}

// åœ¨ç”¨æˆ·ç™»å½•åè°ƒç”¨
addAdminRoutes()
```

---

## ğŸ“ æœ¬ç« å°ç»“

### âœ… æŒæ¡æŠ€èƒ½
- [x] è·¯ç”±åŸºç¡€é…ç½®
- [x] è·¯ç”±å®ˆå«å®ç°
- [x] æƒé™æ§åˆ¶é€»è¾‘

### ğŸš€ ä¸‹ä¸€æ­¥
è·¯ç”±é…ç½®å®Œæˆï¼Œä¸‹ä¸€ç« æˆ‘ä»¬å°†å­¦ä¹ APIæœåŠ¡å°è£…ï¼Œå®ç°å‰åç«¯æ•°æ®äº¤äº’ã€‚

---

**ä¸‹ä¸€ç« ï¼š[05-APIæœåŠ¡å°è£…](05-APIæœåŠ¡å°è£….md)**