---
tags:
  - Vueç»„ä»¶
  - ç»„ä»¶é€šä¿¡
  - Props
  - Events
  - Provide/Inject
  - Vue3
  - ç»„ä»¶äº¤äº’
created: 2025-11-18
modified: 2025-11-18
category: Vueæ ¸å¿ƒæ¦‚å¿µ
difficulty: intermediate
---

# Vueç»„ä»¶é€šä¿¡æœºåˆ¶è¯¦è§£

> **å­¦ä¹ ç›®æ ‡**ï¼šæ·±å…¥ç†è§£Vueç»„ä»¶é—´çš„å„ç§é€šä¿¡æ–¹å¼ï¼ŒæŒæ¡çˆ¶å­ã€å…„å¼Ÿã€è·¨å±‚çº§ç»„ä»¶é€šä¿¡çš„å®ç°æ–¹æ³•

## ğŸ¯ æœ¬ç« æ¦‚è§ˆ

| å†…å®¹ | é¢„è®¡æ—¶é—´ | éš¾åº¦ | çŠ¶æ€ |
|------|----------|------|------|
| ç»„ä»¶é€šä¿¡æ¦‚è¿° | 15åˆ†é’Ÿ | â­â­ | â³ |
| çˆ¶å­ç»„ä»¶é€šä¿¡ | 25åˆ†é’Ÿ | â­â­ | â³ |
| å…„å¼Ÿç»„ä»¶é€šä¿¡ | 20åˆ†é’Ÿ | â­â­â­ | â³ |
| è·¨å±‚çº§é€šä¿¡ | 25åˆ†é’Ÿ | â­â­â­ | â³ |
| çŠ¶æ€ç®¡ç†é€šä¿¡ | 20åˆ†é’Ÿ | â­â­â­ | â³ |

---

## ğŸŒ ç»„ä»¶é€šä¿¡æ¦‚è¿°

### é€šä¿¡åœºæ™¯åˆ†ç±»

```mermaid
graph TD
    A[Vueç»„ä»¶é€šä¿¡] --> B[çˆ¶å­é€šä¿¡]
    A --> C[å…„å¼Ÿé€šä¿¡]
    A --> D[è·¨å±‚çº§é€šä¿¡]
    A --> E[å…¨å±€çŠ¶æ€é€šä¿¡]

    B --> B1[çˆ¶åˆ°å­: Props]
    B --> B2[å­åˆ°çˆ¶: Events]
    B --> B3[åŒå‘ç»‘å®š: v-model]

    C --> C1[äº‹ä»¶æ€»çº¿]
    C --> C2[çˆ¶ç»„ä»¶ä¸­è½¬]
    C --> C3[çŠ¶æ€ç®¡ç†]

    D --> D1[Provide/Inject]
    D --> D2[çŠ¶æ€ç®¡ç†]
    D --> D3[å…¨å±€äº‹ä»¶]

    E --> E1[Pinia/Vuex]
    E --> E2[å…¨å±€çŠ¶æ€]
    E --> E3[å“åº”å¼æ•°æ®]
```

### é€‰æ‹©é€šä¿¡æ–¹å¼çš„ä¾æ®

| é€šä¿¡åœºæ™¯ | æ¨èæ–¹å¼ | å¤æ‚åº¦ | é€‚ç”¨è§„æ¨¡ |
|----------|----------|--------|----------|
| çˆ¶ä¼ å­ | Props | â­ | å°å‹ |
| å­ä¼ çˆ¶ | Events | â­ | å°å‹ |
| å…„å¼Ÿç»„ä»¶ | çˆ¶ç»„ä»¶ä¸­è½¬/çŠ¶æ€ç®¡ç† | â­â­ | ä¸­å‹ |
| è·¨å±‚çº§ | Provide/Inject | â­â­ | ä¸­å‹ |
| å¤æ‚åº”ç”¨ | çŠ¶æ€ç®¡ç†(Pinia) | â­â­â­ | å¤§å‹ |

---

## ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ çˆ¶å­ç»„ä»¶é€šä¿¡

### çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼ˆPropsï¼‰

#### åŸºç¡€Propsä¼ é€’

```vue
<!-- ParentComponent.vue -->
<template>
  <div class="parent">
    <h2>çˆ¶ç»„ä»¶</h2>
    <p>å½“å‰ç”¨æˆ·ï¼š{{ currentUser.name }}</p>

    <!-- é€šè¿‡Propså‘å­ç»„ä»¶ä¼ é€’æ•°æ® -->
    <ChildComponent
      :user="currentUser"
      :theme="currentTheme"
      :is-editable="canEdit"
      @user-update="handleUserUpdate"
    />
  </div>
</template>

<script setup>
import { reactive, ref } from 'vue'
import ChildComponent from './ChildComponent.vue'

const currentUser = reactive({
  id: 1,
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com',
  avatar: '/avatar.jpg'
})

const currentTheme = ref('light')
const canEdit = ref(true)

function handleUserUpdate(updatedUser) {
  Object.assign(currentUser, updatedUser)
  console.log('ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°ï¼š', currentUser)
}
</script>
```

```vue
<!-- ChildComponent.vue -->
<template>
  <div class="child" :class="theme">
    <h3>å­ç»„ä»¶</h3>
    <div class="user-info">
      <img :src="user.avatar" :alt="user.name" class="avatar">
      <div class="info">
        <p v-if="!isEditing">å§“åï¼š{{ user.name }}</p>
        <input v-else v-model="editedUser.name" @blur="finishEdit">

        <p v-if="!isEditing">é‚®ç®±ï¼š{{ user.email }}</p>
        <input v-else v-model="editedUser.email" @blur="finishEdit">
      </div>
    </div>

    <div class="actions">
      <button v-if="!isEditing && isEditable" @click="startEdit">ç¼–è¾‘</button>
      <button v-if="isEditing" @click="finishEdit">ä¿å­˜</button>
      <button v-if="isEditing" @click="cancelEdit">å–æ¶ˆ</button>
    </div>
  </div>
</template>

<script setup>
import { reactive, ref } from 'vue'

// æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„Props
const props = defineProps({
  user: {
    type: Object,
    required: true
  },
  theme: {
    type: String,
    default: 'light',
    validator: (value) => ['light', 'dark'].includes(value)
  },
  isEditable: {
    type: Boolean,
    default: false
  }
})

// å®šä¹‰å‘çˆ¶ç»„ä»¶å‘é€çš„äº‹ä»¶
const emit = defineEmits(['user-update'])

const isEditing = ref(false)
const editedUser = reactive({ ...props.user })

function startEdit() {
  isEditing.value = true
  Object.assign(editedUser, props.user)
}

function finishEdit() {
  isEditing.value = false
  emit('user-update', { ...editedUser })
}

function cancelEdit() {
  isEditing.value = false
  Object.assign(editedUser, props.user)
}
</script>

<style scoped>
.child {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  margin: 10px 0;
}

.child.dark {
  background: #333;
  color: white;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
}

.info input {
  margin: 5px 0;
  padding: 5px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.actions {
  display: flex;
  gap: 10px;
}
</style>
```

#### åŒå‘æ•°æ®ç»‘å®šï¼ˆv-modelï¼‰

```vue
<!-- CustomInput.vue - è‡ªå®šä¹‰è¾“å…¥ç»„ä»¶ -->
<template>
  <div class="custom-input">
    <label v-if="label">{{ label }}</label>
    <input
      :type="type"
      :value="modelValue"
      :placeholder="placeholder"
      :disabled="disabled"
      @input="handleInput"
      @blur="handleBlur"
      @focus="handleFocus"
    >
    <span v-if="error" class="error">{{ error }}</span>
  </div>
</template>

<script setup>
const props = defineProps({
  // v-modelé»˜è®¤æ¥æ”¶modelValue
  modelValue: {
    type: [String, Number],
    default: ''
  },
  label: String,
  type: {
    type: String,
    default: 'text'
  },
  placeholder: String,
  disabled: Boolean,
  error: String
})

// v-modelé»˜è®¤äº‹ä»¶æ˜¯update:modelValue
const emit = defineEmits(['update:modelValue', 'blur', 'focus'])

function handleInput(event) {
  emit('update:modelValue', event.target.value)
}

function handleBlur(event) {
  emit('blur', event.target.value)
}

function handleFocus(event) {
  emit('focus', event.target.value)
}
</script>

<style scoped>
.custom-input {
  margin-bottom: 15px;
}

.custom-input label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.custom-input input {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.error {
  color: red;
  font-size: 12px;
  margin-top: 5px;
  display: block;
}
</style>
```

```vue
<!-- ParentComponent.vue - ä½¿ç”¨è‡ªå®šä¹‰è¾“å…¥ç»„ä»¶ -->
<template>
  <div class="form">
    <h2>ç”¨æˆ·è¡¨å•</h2>

    <!-- åŸºç¡€v-modelç”¨æ³• -->
    <CustomInput
      v-model="user.name"
      label="å§“å"
      placeholder="è¯·è¾“å…¥å§“å"
    />

    <!-- å¸¦éªŒè¯çš„v-model -->
    <CustomInput
      v-model="user.email"
      label="é‚®ç®±"
      type="email"
      placeholder="è¯·è¾“å…¥é‚®ç®±"
      :error="emailError"
    />

    <!-- æ”¯æŒä¿®é¥°ç¬¦ -->
    <CustomInput
      v-model.lazy="user.description"
      label="æè¿°"
      placeholder="è¯·è¾“å…¥æè¿°"
    />

    <CustomInput
      v-model.number.trim="user.age"
      label="å¹´é¾„"
      type="number"
      placeholder="è¯·è¾“å…¥å¹´é¾„"
    />

    <div class="preview">
      <h3>æ•°æ®é¢„è§ˆ</h3>
      <pre>{{ user }}</pre>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, computed } from 'vue'
import CustomInput from './CustomInput.vue'

const user = ref({
  name: '',
  email: '',
  description: '',
  age: ''
})

// é‚®ç®±éªŒè¯
const emailError = computed(() => {
  if (!user.value.email) return ''
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  return emailRegex.test(user.value.email) ? '' : 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'
})

// ç›‘å¬æ•°æ®å˜åŒ–
watch(user, (newUser) => {
  console.log('ç”¨æˆ·æ•°æ®å˜åŒ–ï¼š', newUser)
}, { deep: true })
</script>
```

### å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ï¼ˆEventsï¼‰

#### åŸºç¡€äº‹ä»¶ä¼ é€’

```vue
<!-- TodoItem.vue - å¾…åŠäº‹é¡¹ç»„ä»¶ -->
<template>
  <div class="todo-item" :class="{ completed: todo.completed }">
    <input
      type="checkbox"
      :checked="todo.completed"
      @change="toggleTodo"
    >
    <span v-if="!isEditing" @dblclick="startEdit" class="todo-text">
      {{ todo.text }}
    </span>
    <input
      v-else
      v-model="editText"
      @blur="finishEdit"
      @keyup.enter="finishEdit"
      @keyup.escape="cancelEdit"
      class="edit-input"
    >
    <div class="actions">
      <button @click="removeTodo">åˆ é™¤</button>
      <button @click="showDetails">è¯¦æƒ…</button>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps({
  todo: {
    type: Object,
    required: true
  }
})

// å®šä¹‰å¯ä»¥å‘çˆ¶ç»„ä»¶å‘é€çš„äº‹ä»¶
const emit = defineEmits([
  'toggle',          // åˆ‡æ¢å®ŒæˆçŠ¶æ€
  'update',          // æ›´æ–°æ–‡æœ¬
  'remove',          // åˆ é™¤å¾…åŠ
  'details',         // æ˜¾ç¤ºè¯¦æƒ…
  'priority-change'  // ä¼˜å…ˆçº§å˜æ›´
])

const isEditing = ref(false)
const editText = ref(props.todo.text)

function toggleTodo() {
  emit('toggle', {
    id: props.todo.id,
    completed: !props.todo.completed
  })
}

function startEdit() {
  isEditing.value = true
  editText.value = props.todo.text
}

function finishEdit() {
  if (editText.value !== props.todo.text) {
    emit('update', {
      id: props.todo.id,
      text: editText.value
    })
  }
  isEditing.value = false
}

function cancelEdit() {
  editText.value = props.todo.text
  isEditing.value = false
}

function removeTodo() {
  emit('remove', props.todo.id)
}

function showDetails() {
  emit('details', props.todo)
}
</script>

<style scoped>
.todo-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-bottom: 5px;
}

.todo-item.completed .todo-text {
  text-decoration: line-through;
  color: #999;
}

.todo-text {
  flex: 1;
  cursor: pointer;
}

.edit-input {
  flex: 1;
  padding: 5px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.actions {
  display: flex;
  gap: 5px;
}
</style>
```

```vue
<!-- TodoList.vue - å¾…åŠäº‹é¡¹åˆ—è¡¨ç»„ä»¶ -->
<template>
  <div class="todo-list">
    <h2>å¾…åŠäº‹é¡¹åˆ—è¡¨</h2>

    <!-- æ·»åŠ æ–°å¾…åŠ -->
    <div class="add-todo">
      <input
        v-model="newTodoText"
        @keyup.enter="addTodo"
        placeholder="æ·»åŠ æ–°å¾…åŠäº‹é¡¹..."
      >
      <button @click="addTodo">æ·»åŠ </button>
    </div>

    <!-- å¾…åŠåˆ—è¡¨ -->
    <div class="todos">
      <TodoItem
        v-for="todo in todos"
        :key="todo.id"
        :todo="todo"
        @toggle="handleToggle"
        @update="handleUpdate"
        @remove="handleRemove"
        @details="handleDetails"
        @priority-change="handlePriorityChange"
      />
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats">
      <p>æ€»è®¡ï¼š{{ todos.length }} é¡¹</p>
      <p>å·²å®Œæˆï¼š{{ completedCount }} é¡¹</p>
      <p>æœªå®Œæˆï¼š{{ uncompletedCount }} é¡¹</p>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <TodoDetails
      v-if="selectedTodo"
      :todo="selectedTodo"
      @close="selectedTodo = null"
    />
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import TodoItem from './TodoItem.vue'
import TodoDetails from './TodoDetails.vue'

const todos = ref([
  { id: 1, text: 'å­¦ä¹ Vueç»„ä»¶é€šä¿¡', completed: false },
  { id: 2, text: 'å®Œæˆé¡¹ç›®ä»»åŠ¡', completed: true },
  { id: 3, text: 'å‡†å¤‡æŠ€æœ¯åˆ†äº«', completed: false }
])

const newTodoText = ref('')
const selectedTodo = ref(null)

const completedCount = computed(() =>
  todos.value.filter(todo => todo.completed).length
)

const uncompletedCount = computed(() =>
  todos.value.filter(todo => !todo.completed).length
)

function addTodo() {
  if (newTodoText.value.trim()) {
    const newTodo = {
      id: Date.now(),
      text: newTodoText.value.trim(),
      completed: false
    }
    todos.value.push(newTodo)
    newTodoText.value = ''
  }
}

// å¤„ç†å­ç»„ä»¶äº‹ä»¶
function handleToggle({ id, completed }) {
  const todo = todos.value.find(t => t.id === id)
  if (todo) {
    todo.completed = completed
    console.log(`å¾…åŠäº‹é¡¹ ${id} çŠ¶æ€å·²æ›´æ–°ä¸ºï¼š${completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}`)
  }
}

function handleUpdate({ id, text }) {
  const todo = todos.value.find(t => t.id === id)
  if (todo) {
    todo.text = text
    console.log(`å¾…åŠäº‹é¡¹ ${id} å†…å®¹å·²æ›´æ–°ä¸ºï¼š${text}`)
  }
}

function handleRemove(id) {
  todos.value = todos.value.filter(todo => todo.id !== id)
  console.log(`å¾…åŠäº‹é¡¹ ${id} å·²åˆ é™¤`)
}

function handleDetails(todo) {
  selectedTodo.value = todo
}

function handlePriorityChange({ id, priority }) {
  const todo = todos.value.find(t => t.id === id)
  if (todo) {
    todo.priority = priority
    console.log(`å¾…åŠäº‹é¡¹ ${id} ä¼˜å…ˆçº§å·²æ›´æ–°ä¸ºï¼š${priority}`)
  }
}
</script>

<style scoped>
.todo-list {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.add-todo {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.add-todo input {
  flex: 1;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.stats {
  margin-top: 20px;
  padding: 15px;
  background: #f5f5f5;
  border-radius: 4px;
}

.stats p {
  margin: 5px 0;
}
</style>
```

---

## ğŸ‘¯ å…„å¼Ÿç»„ä»¶é€šä¿¡

### é€šè¿‡çˆ¶ç»„ä»¶ä¸­è½¬

```vue
<!-- ParentComponent.vue - çˆ¶ç»„ä»¶ä½œä¸ºé€šä¿¡ä¸­è½¬ç«™ -->
<template>
  <div class="parent">
    <h1>å…„å¼Ÿç»„ä»¶é€šä¿¡ç¤ºä¾‹</h1>

    <div class="components">
      <!-- å·¦ä¾§ç»„ä»¶ -->
      <LeftComponent
        :message="sharedMessage"
        :counter="sharedCounter"
        @message-change="handleMessageChange"
        @counter-change="handleCounterChange"
      />

      <!-- å³ä¾§ç»„ä»¶ -->
      <RightComponent
        :message="sharedMessage"
        :counter="sharedCounter"
        @message-change="handleMessageChange"
        @counter-change="handleCounterChange"
      />
    </div>

    <div class="center-info">
      <h3>å…±äº«çŠ¶æ€ï¼ˆçˆ¶ç»„ä»¶ç®¡ç†ï¼‰</h3>
      <p>æ¶ˆæ¯ï¼š{{ sharedMessage }}</p>
      <p>è®¡æ•°å™¨ï¼š{{ sharedCounter }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import LeftComponent from './LeftComponent.vue'
import RightComponent from './RightComponent.vue'

// çˆ¶ç»„ä»¶ç®¡ç†å…±äº«çŠ¶æ€
const sharedMessage = ref('æ¥è‡ªçˆ¶ç»„ä»¶çš„åˆå§‹æ¶ˆæ¯')
const sharedCounter = ref(0)

// å¤„ç†å·¦ä¾§ç»„ä»¶çš„äº‹ä»¶
function handleMessageChange(newMessage) {
  sharedMessage.value = newMessage
  console.log('æ¶ˆæ¯å·²æ›´æ–°ï¼ˆæ¥è‡ªå·¦ä¾§ç»„ä»¶ï¼‰ï¼š', newMessage)
}

function handleCounterChange(change) {
  sharedCounter.value += change
  console.log('è®¡æ•°å™¨å·²æ›´æ–°ï¼š', sharedCounter.value)
}

// å¤„ç†å³ä¾§ç»„ä»¶çš„äº‹ä»¶ï¼ˆå…±ç”¨åŒä¸€ä¸ªå¤„ç†å‡½æ•°ï¼‰
// å› ä¸ºé€»è¾‘å®Œå…¨ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥å¤ç”¨
</script>

<style scoped>
.parent {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.components {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

.center-info {
  padding: 20px;
  background: #f0f8ff;
  border-radius: 8px;
  text-align: center;
}
</style>
```

```vue
<!-- LeftComponent.vue - å·¦ä¾§ç»„ä»¶ -->
<template>
  <div class="left-component">
    <h2>å·¦ä¾§ç»„ä»¶</h2>

    <div class="input-group">
      <label>å‘é€æ¶ˆæ¯ï¼š</label>
      <input
        v-model="localMessage"
        @keyup.enter="sendMessage"
        placeholder="è¾“å…¥æ¶ˆæ¯..."
      >
      <button @click="sendMessage">å‘é€</button>
    </div>

    <div class="counter-controls">
      <h3>è®¡æ•°å™¨æ§åˆ¶</h3>
      <button @click="increment">+1</button>
      <button @click="decrement">-1</button>
      <button @click="reset">é‡ç½®</button>
    </div>

    <div class="received-data">
      <h3>æ¥æ”¶åˆ°çš„æ•°æ®</h3>
      <p>æ¶ˆæ¯ï¼š{{ message }}</p>
      <p>è®¡æ•°å™¨ï¼š{{ counter }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps({
  message: String,
  counter: Number
})

const emit = defineEmits(['message-change', 'counter-change'])

const localMessage = ref('')

function sendMessage() {
  if (localMessage.value.trim()) {
    emit('message-change', `[å·¦] ${localMessage.value}`)
    localMessage.value = ''
  }
}

function increment() {
  emit('counter-change', 1)
}

function decrement() {
  emit('counter-change', -1)
}

function reset() {
  emit('counter-change', -props.counter) // é‡ç½®ä¸º0
}
</script>

<style scoped>
.left-component {
  padding: 20px;
  border: 2px solid #4CAF50;
  border-radius: 8px;
  background: #f9fff9;
}

.input-group {
  margin-bottom: 20px;
}

.input-group input {
  width: 100%;
  padding: 8px;
  margin: 5px 0;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.counter-controls {
  margin-bottom: 20px;
}

.counter-controls button {
  margin-right: 10px;
  padding: 8px 16px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.received-data {
  padding: 15px;
  background: #e8f5e8;
  border-radius: 4px;
}
</style>
```

### ä½¿ç”¨äº‹ä»¶æ€»çº¿

```vue
<!-- EventBus.js - äº‹ä»¶æ€»çº¿å®ç° -->
<script>
import { ref } from 'vue'

// ç®€å•çš„äº‹ä»¶æ€»çº¿å®ç°
class EventBus {
  constructor() {
    this.events = ref({})
  }

  // è®¢é˜…äº‹ä»¶
  on(eventName, callback) {
    if (!this.events.value[eventName]) {
      this.events.value[eventName] = []
    }
    this.events.value[eventName].push(callback)

    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => {
      const callbacks = this.events.value[eventName]
      if (callbacks) {
        const index = callbacks.indexOf(callback)
        if (index > -1) {
          callbacks.splice(index, 1)
        }
      }
    }
  }

  // å–æ¶ˆè®¢é˜…äº‹ä»¶
  off(eventName, callback) {
    const callbacks = this.events.value[eventName]
    if (callbacks) {
      const index = callbacks.indexOf(callback)
      if (index > -1) {
        callbacks.splice(index, 1)
      }
    }
  }

  // å‘å¸ƒäº‹ä»¶
  emit(eventName, ...args) {
    const callbacks = this.events.value[eventName]
    if (callbacks) {
      callbacks.forEach(callback => {
        callback(...args)
      })
    }
  }

  // æ¸…é™¤æ‰€æœ‰äº‹ä»¶
  clear() {
    this.events.value = {}
  }
}

// åˆ›å»ºå…¨å±€äº‹ä»¶æ€»çº¿
export const eventBus = new EventBus()
</script>
```

```vue
<!-- BrotherA.vue - å…„å¼Ÿç»„ä»¶A -->
<template>
  <div class="brother-a">
    <h2>å…„å¼Ÿç»„ä»¶ A</h2>

    <div class="message-sender">
      <label>å‘é€æ¶ˆæ¯ç»™å…„å¼ŸBï¼š</label>
      <input
        v-model="message"
        @keyup.enter="sendMessage"
        placeholder="è¾“å…¥æ¶ˆæ¯..."
      >
      <button @click="sendMessage">å‘é€</button>
    </div>

    <div class="received-messages">
      <h3>æ¥è‡ªå…„å¼ŸBçš„æ¶ˆæ¯ï¼š</h3>
      <ul>
        <li v-for="(msg, index) in receivedMessages" :key="index">
          {{ msg }}
        </li>
      </ul>
    </div>

    <div class="shared-data">
      <h3>å…±äº«è®¡æ•°å™¨ï¼š{{ sharedCounter }}</h3>
      <button @click="incrementCounter">å¢åŠ </button>
      <button @click="decrementCounter">å‡å°‘</button>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import { eventBus } from './EventBus.js'

const message = ref('')
const receivedMessages = ref([])
const sharedCounter = ref(0)

// å‘é€æ¶ˆæ¯ç»™å…„å¼Ÿç»„ä»¶B
function sendMessage() {
  if (message.value.trim()) {
    eventBus.emit('message-to-b', `[æ¥è‡ªA] ${message.value}`)
    message.value = ''
  }
}

// ç›‘å¬æ¥è‡ªå…„å¼Ÿç»„ä»¶Bçš„æ¶ˆæ¯
function handleMessageFromB(msg) {
  receivedMessages.value.unshift(msg)
  // åªä¿ç•™æœ€è¿‘5æ¡æ¶ˆæ¯
  if (receivedMessages.value.length > 5) {
    receivedMessages.value.pop()
  }
}

// ç›‘å¬è®¡æ•°å™¨å˜åŒ–
function handleCounterChange(delta) {
  sharedCounter.value += delta
}

// å‘é€è®¡æ•°å™¨å˜åŒ–
function incrementCounter() {
  eventBus.emit('counter-change', 1)
}

function decrementCounter() {
  eventBus.emit('counter-change', -1)
}

// ç»„ä»¶æŒ‚è½½æ—¶è®¢é˜…äº‹ä»¶
onMounted(() => {
  eventBus.on('message-to-a', handleMessageFromB)
  eventBus.on('counter-change', handleCounterChange)
})

// ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè®¢é˜…
onUnmounted(() => {
  eventBus.off('message-to-a', handleMessageFromB)
  eventBus.off('counter-change', handleCounterChange)
})
</script>

<style scoped>
.brother-a {
  padding: 20px;
  border: 2px solid #2196F3;
  border-radius: 8px;
  background: #f3f8ff;
}

.message-sender {
  margin-bottom: 20px;
}

.message-sender input {
  width: 100%;
  padding: 8px;
  margin: 5px 0;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.received-messages {
  margin-bottom: 20px;
}

.received-messages ul {
  list-style: none;
  padding: 0;
}

.received-messages li {
  padding: 5px;
  background: #e3f2fd;
  margin-bottom: 5px;
  border-radius: 4px;
}

.shared-data {
  text-align: center;
}

.shared-data button {
  margin: 0 5px;
  padding: 8px 16px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
</style>
```

---

## ğŸŒ‰ è·¨å±‚çº§é€šä¿¡

### Provide/Injectæœºåˆ¶

```vue
<!-- GrandParentComponent.vue - ç¥–å…ˆç»„ä»¶ -->
<template>
  <div class="grand-parent">
    <h1>ç¥–ç»„ä»¶</h1>
    <p>ä¸»é¢˜ï¼š{{ currentTheme }}</p>
    <p>ç”¨æˆ·ï¼š{{ currentUser.name }}</p>

    <div class="theme-controls">
      <button @click="changeTheme('light')">æµ…è‰²ä¸»é¢˜</button>
      <button @click="changeTheme('dark')">æ·±è‰²ä¸»é¢˜</button>
    </div>

    <!-- ä½¿ç”¨provideå‘åä»£æä¾›æ•°æ® -->
    <ParentComponent />
  </div>
</template>

<script setup>
import { reactive, ref, provide } from 'vue'
import ParentComponent from './ParentComponent.vue'

// æä¾›å“åº”å¼æ•°æ®
const currentTheme = ref('light')
const currentUser = reactive({
  id: 1,
  name: 'å¼ ä¸‰',
  role: 'admin'
})

// æä¾›æ–¹æ³•
const appConfig = reactive({
  apiBaseUrl: 'https://api.example.com',
  version: '1.0.0',
  debug: true
})

function changeTheme(theme) {
  currentTheme.value = theme
  console.log('ä¸»é¢˜å·²åˆ‡æ¢ä¸ºï¼š', theme)
}

function updateUser(newUserInfo) {
  Object.assign(currentUser, newUserInfo)
  console.log('ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°ï¼š', currentUser)
}

// ä½¿ç”¨provideå‘åä»£ç»„ä»¶æä¾›æ•°æ®å’Œæ–¹æ³•
provide('theme', currentTheme)
provide('currentUser', currentUser)
provide('appConfig', appConfig)
provide('changeTheme', changeTheme)
provide('updateUser', updateUser)

// ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§æä¾›å¤šä¸ªå€¼
provide('app', {
  theme: currentTheme,
  user: currentUser,
  config: appConfig,
  actions: {
    changeTheme,
    updateUser
  }
})
</script>

<style scoped>
.grand-parent {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.theme-controls {
  margin: 20px 0;
}

.theme-controls button {
  margin-right: 10px;
  padding: 8px 16px;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
}
</style>
```

```vue
<!-- ParentComponent.vue - ä¸­é—´å±‚çº§ç»„ä»¶ -->
<template>
  <div class="parent">
    <h2>çˆ¶ç»„ä»¶ï¼ˆä¸éœ€è¦ä¼ é€’æ•°æ®ï¼‰</h2>
    <p>è¿™ä¸ªç»„ä»¶åªæ˜¯ä¸­é—´å±‚ï¼Œä¸å¤„ç†ä»»ä½•æ•°æ®ä¼ é€’</p>

    <ChildComponent />
  </div>
</template>

<script setup>
import ChildComponent from './ChildComponent.vue'

// çˆ¶ç»„ä»¶ä¸éœ€è¦æ¥æ”¶å’Œä¼ é€’æ•°æ®
// æ•°æ®ç›´æ¥ä»ç¥–ç»„ä»¶ä¼ é€’åˆ°å­™ç»„ä»¶
</script>

<style scoped>
.parent {
  margin: 20px 0;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: #fafafa;
}
</style>
```

```vue
<!-- ChildComponent.vue - å­™ç»„ä»¶ -->
<template>
  <div class="child" :class="theme">
    <h2>å­™ç»„ä»¶ï¼ˆç›´æ¥æ¥æ”¶ç¥–ç»„ä»¶æ•°æ®ï¼‰</h2>

    <div class="user-info">
      <h3>ç”¨æˆ·ä¿¡æ¯ï¼ˆæ¥è‡ªç¥–ç»„ä»¶ï¼‰</h3>
      <p>å§“åï¼š{{ currentUser.name }}</p>
      <p>IDï¼š{{ currentUser.id }}</p>
      <p>è§’è‰²ï¼š{{ currentUser.role }}</p>
    </div>

    <div class="app-config">
      <h3>åº”ç”¨é…ç½®ï¼ˆæ¥è‡ªç¥–ç»„ä»¶ï¼‰</h3>
      <p>APIåœ°å€ï¼š{{ appConfig.apiBaseUrl }}</p>
      <p>ç‰ˆæœ¬ï¼š{{ appConfig.version }}</p>
      <p>è°ƒè¯•æ¨¡å¼ï¼š{{ appConfig.debug ? 'å¼€å¯' : 'å…³é—­' }}</p>
    </div>

    <div class="actions">
      <h3>æ“ä½œï¼ˆè°ƒç”¨ç¥–ç»„ä»¶æ–¹æ³•ï¼‰</h3>
      <button @click="toggleTheme">åˆ‡æ¢ä¸»é¢˜</button>
      <button @click="changeUserRole">æ›´æ”¹è§’è‰²</button>
    </div>

    <!-- ä¹Ÿå¯ä»¥ä»ç»Ÿä¸€çš„å¯¹è±¡ä¸­è·å– -->
    <div class="unified-access">
      <h3>ç»Ÿä¸€è®¿é—®æ–¹å¼</h3>
      <p>ä¸»é¢˜ï¼š{{ app.theme }}</p>
      <p>ç”¨æˆ·ï¼š{{ app.user.name }}</p>
      <button @click="app.actions.changeTheme('dark')">æ·±è‰²ä¸»é¢˜</button>
      <button @click="app.actions.updateUser({ name: 'æå››' })">æ›´æ”¹ç”¨æˆ·å</button>
    </div>
  </div>
</template>

<script setup>
import { inject } from 'vue'

// ä½¿ç”¨injectæ¥æ”¶ç¥–ç»„ä»¶æä¾›çš„æ•°æ®
const theme = inject('theme', 'light')
const currentUser = inject('currentUser', {})
const appConfig = inject('appConfig', {})

// æ¥æ”¶ç¥–ç»„ä»¶æä¾›çš„æ–¹æ³•
const changeTheme = inject('changeTheme', () => console.warn('changeThemeæ–¹æ³•æœªæä¾›'))
const updateUser = inject('updateUser', () => console.warn('updateUseræ–¹æ³•æœªæä¾›'))

// æ¥æ”¶ç»Ÿä¸€çš„å¯¹è±¡
const app = inject('app', {})

// ç»„ä»¶å†…éƒ¨æ–¹æ³•
function toggleTheme() {
  const newTheme = theme.value === 'light' ? 'dark' : 'light'
  changeTheme(newTheme)
}

function changeUserRole() {
  const newRole = currentUser.role === 'admin' ? 'user' : 'admin'
  updateUser({ ...currentUser.value, role: newRole })
}
</script>

<style scoped>
.child {
  padding: 20px;
  border: 2px solid #4CAF50;
  border-radius: 8px;
}

.child.light {
  background: white;
  color: #333;
}

.child.dark {
  background: #333;
  color: white;
}

.user-info, .app-config, .actions, .unified-access {
  margin-bottom: 20px;
  padding: 15px;
  border-radius: 4px;
}

.child.light .user-info,
.child.light .app-config,
.child.light .actions,
.child.light .unified-access {
  background: #f0f8ff;
}

.child.dark .user-info,
.child.dark .app-config,
.child.dark .actions,
.child.dark .unified-access {
  background: #1a1a1a;
}

button {
  margin-right: 10px;
  margin-bottom: 5px;
  padding: 8px 16px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.child.dark button {
  background: #666;
}
</style>
```

### é«˜çº§Provide/Injectç”¨æ³•

```vue
<!-- AdvancedProvider.vue - é«˜çº§æä¾›è€… -->
<template>
  <div class="advanced-provider">
    <slot />
  </div>
</template>

<script setup>
import { reactive, provide, readonly, computed } from 'vue'

// åˆ›å»ºå“åº”å¼æ•°æ®
const state = reactive({
  user: null,
  isLoading: false,
  error: null
})

// åˆ›å»ºè®¡ç®—å±æ€§
const isAuthenticated = computed(() => !!state.user)
const userRole = computed(() => state.user?.role || 'guest')

// åˆ›å»ºæ“ä½œæ–¹æ³•
const actions = {
  async login(username, password) {
    state.isLoading = true
    state.error = null

    try {
      // æ¨¡æ‹ŸAPIè°ƒç”¨
      await new Promise(resolve => setTimeout(resolve, 1000))

      if (username === 'admin' && password === 'password') {
        state.user = {
          id: 1,
          name: 'ç®¡ç†å‘˜',
          role: 'admin',
          token: 'fake-token'
        }
      } else {
        throw new Error('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
      }
    } catch (error) {
      state.error = error.message
    } finally {
      state.isLoading = false
    }
  },

  logout() {
    state.user = null
    state.error = null
  },

  clearError() {
    state.error = null
  }
}

// åˆ›å»ºå·¥å…·æ–¹æ³•
const utils = {
  formatUserName(user) {
    return user ? `${user.name} (${user.role})` : 'æœªç™»å½•'
  },

  hasRole(role) {
    return state.user?.role === role
  }
}

// æä¾›æ•°æ®ï¼ˆéƒ¨åˆ†åªè¯»ï¼‰
provide('authState', readonly(state))
provide('authActions', actions)
provide('authUtils', utils)

// æä¾›ç»„åˆå¼APIé£æ ¼çš„æ•°æ®
provide('useAuth', () => ({
  state: readonly(state),
  isAuthenticated,
  userRole,
  ...actions,
  ...utils
}))
</script>
```

```vue
<!-- ConsumerComponent.vue - æ¶ˆè´¹è€…ç»„ä»¶ -->
<template>
  <div class="consumer">
    <div v-if="isLoading" class="loading">
      ç™»å½•ä¸­...
    </div>

    <div v-else-if="error" class="error">
      <p>{{ error }}</p>
      <button @click="clearError">æ¸…é™¤é”™è¯¯</button>
    </div>

    <div v-else-if="isAuthenticated" class="authenticated">
      <h3>æ¬¢è¿ï¼Œ{{ user.name }}ï¼</h3>
      <p>è§’è‰²ï¼š{{ userRole }}</p>
      <button @click="logout">é€€å‡ºç™»å½•</button>
    </div>

    <div v-else class="login-form">
      <h3>ç”¨æˆ·ç™»å½•</h3>
      <input
        v-model="username"
        placeholder="ç”¨æˆ·å"
        @keyup.enter="handleLogin"
      >
      <input
        v-model="password"
        type="password"
        placeholder="å¯†ç "
        @keyup.enter="handleLogin"
      >
      <button @click="handleLogin">ç™»å½•</button>
      <p class="hint">ç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼špassword</p>
    </div>

    <div class="utils-demo">
      <h3>å·¥å…·æ–¹æ³•æ¼”ç¤º</h3>
      <p>æ ¼å¼åŒ–ç”¨æˆ·åï¼š{{ formatUserName(user) }}</p>
      <p>æ˜¯å¦æœ‰ç®¡ç†å‘˜æƒé™ï¼š{{ hasRole('admin') ? 'æ˜¯' : 'å¦' }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref, inject } from 'vue'

// æ–¹å¼1ï¼šåˆ†åˆ«inject
const state = inject('authState')
const actions = inject('authActions')
const utils = inject('authUtils')

// æ–¹å¼2ï¼šä½¿ç”¨ç»„åˆå¼APIé£æ ¼
const useAuth = inject('useAuth')
const {
  isLoading,
  error,
  user,
  isAuthenticated,
  userRole,
  login,
  logout,
  clearError,
  formatUserName,
  hasRole
} = useAuth()

// æœ¬åœ°çŠ¶æ€
const username = ref('')
const password = ref('')

// æ–¹æ³•
async function handleLogin() {
  if (username.value && password.value) {
    await login(username.value, password.value)
    username.value = ''
    password.value = ''
  }
}
</script>

<style scoped>
.consumer {
  max-width: 400px;
  margin: 0 auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
}

.loading, .error, .authenticated, .login-form, .utils-demo {
  margin-bottom: 20px;
  padding: 15px;
  border-radius: 4px;
}

.loading {
  background: #e3f2fd;
  text-align: center;
}

.error {
  background: #ffebee;
  color: #c62828;
}

.authenticated {
  background: #e8f5e8;
}

.login-form input {
  width: 100%;
  padding: 8px;
  margin: 5px 0;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.utils-demo {
  background: #f5f5f5;
}

button {
  padding: 8px 16px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.hint {
  font-size: 12px;
  color: #666;
  margin-top: 10px;
}
</style>
```

---

## ğŸ“ æœ¬ç« å°ç»“

### âœ… æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

1. **çˆ¶å­é€šä¿¡** - Propså‘ä¸‹ä¼ é€’ï¼ŒEventså‘ä¸Šå‘é€
2. **å…„å¼Ÿé€šä¿¡** - çˆ¶ç»„ä»¶ä¸­è½¬ã€äº‹ä»¶æ€»çº¿
3. **è·¨å±‚çº§é€šä¿¡** - Provide/Injectæœºåˆ¶
4. **åŒå‘ç»‘å®š** - v-modelå®ç°è‡ªå®šä¹‰ç»„ä»¶
5. **äº‹ä»¶ç³»ç»Ÿ** - è‡ªå®šä¹‰äº‹ä»¶å’Œäº‹ä»¶æ€»çº¿

### ğŸ¯ å®è·µèƒ½åŠ›

- [ ] èƒ½å¤Ÿå®ç°å®Œæ•´çš„çˆ¶å­ç»„ä»¶é€šä¿¡
- [ ] èƒ½å¤Ÿå¤„ç†å…„å¼Ÿç»„ä»¶é—´çš„æ•°æ®äº¤æ¢
- [ ] èƒ½å¤Ÿä½¿ç”¨Provide/Injectå®ç°è·¨å±‚çº§é€šä¿¡
- [ ] èƒ½å¤Ÿåˆ›å»ºè‡ªå®šä¹‰åŒå‘ç»‘å®šç»„ä»¶
- [ ] èƒ½å¤Ÿé€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼

### ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ 

æŒæ¡äº†ç»„ä»¶é€šä¿¡åï¼Œç»§ç»­å­¦ä¹ ï¼š
- [[07-Vueç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸é’©å­å‡½æ•°.md|ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†]]
- [[08-Vueç»„ä»¶æœ€ä½³å®è·µ.md|ç»„ä»¶å¼€å‘æœ€ä½³å®è·µ]]
- [[09-Vueç»„ä»¶çŠ¶æ€ç®¡ç†è¯¦è§£.md|ç»„ä»¶çŠ¶æ€ç®¡ç†]]

---

## ğŸ’¡ ç»„ä»¶é€šä¿¡é‡‘ç§‘ç‰å¾‹

1. **å•å‘æ•°æ®æµ** - å§‹ç»ˆä¿æŒä»çˆ¶åˆ°å­çš„æ•°æ®æµå‘
2. **æœ€å°ä¾èµ–** - ç»„ä»¶é—´é€šä¿¡å°½é‡å‡å°‘ä¾èµ–å…³ç³»
3. **æ˜ç¡®èŒè´£** - æ¯ä¸ªç»„ä»¶çš„é€šä¿¡èŒè´£è¦æ¸…æ™°æ˜ç¡®
4. **åˆç†é€‰æ‹©** - æ ¹æ®åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„é€šä¿¡æ–¹å¼
5. **é¿å…è¿‡åº¦è®¾è®¡** - ç®€å•åœºæ™¯ä¸è¦ä½¿ç”¨å¤æ‚çš„é€šä¿¡æ–¹æ¡ˆ

**è®°ä½ï¼šå¥½çš„ç»„ä»¶é€šä¿¡æ˜¯å¯ç»´æŠ¤åº”ç”¨çš„åŸºç¡€ï¼** ğŸ‰