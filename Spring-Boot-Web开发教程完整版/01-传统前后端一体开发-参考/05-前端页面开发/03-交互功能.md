# å‰ç«¯äº¤äº’åŠŸèƒ½å®ç°

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- æŒæ¡JavaScriptä¸Thymeleafçš„äº¤äº’
- å­¦ä¼šå®ç°AJAXå¼‚æ­¥è¯·æ±‚
- äº†è§£å‰ç«¯è¡¨å•éªŒè¯å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æŒæ¡åŠ¨æ€å†…å®¹æ›´æ–°å’Œå®æ—¶é€šçŸ¥

## ğŸ—ï¸ åŸºç¡€JavaScriptäº¤äº’

### 1. é¡µé¢åˆå§‹åŒ–å’Œäº‹ä»¶ç»‘å®š

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>äº¤äº’åŠŸèƒ½ç¤ºä¾‹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
        }

        .user-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading" id="loading">
        <div class="loading-spinner">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">åŠ è½½ä¸­...</span>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notificationContainer"></div>

    <div class="container mt-4">
        <h2>ç”¨æˆ·ç®¡ç† - äº¤äº’åŠŸèƒ½æ¼”ç¤º</h2>

        <!-- æœç´¢å’Œè¿‡æ»¤ -->
        <div class="row mb-4">
            <div class="col-md-4">
                <input type="text" id="searchInput" class="form-control"
                       placeholder="æœç´¢ç”¨æˆ·..." th:value="${keyword}">
            </div>
            <div class="col-md-3">
                <select id="roleFilter" class="form-select">
                    <option value="">æ‰€æœ‰è§’è‰²</option>
                    <option th:each="role : ${roles}"
                            th:value="${role.name}"
                            th:text="${role.displayName}">è§’è‰²</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="statusFilter" class="form-select">
                    <option value="">æ‰€æœ‰çŠ¶æ€</option>
                    <option value="true">å¯ç”¨</option>
                    <option value="false">ç¦ç”¨</option>
                </select>
            </div>
            <div class="col-md-2">
                <button id="addUserBtn" class="btn btn-primary w-100">
                    <i class="fas fa-plus me-1"></i>æ·»åŠ ç”¨æˆ·
                </button>
            </div>
        </div>

        <!-- ç”¨æˆ·åˆ—è¡¨ -->
        <div id="userList" class="row">
            <div class="col-md-6 col-lg-4 mb-3" th:each="user : ${users.content}">
                <div class="card user-card" th:data-user-id="${user.id}">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <img th:src="${user.avatarUrl ?: '/images/default-avatar.png'}"
                                 class="rounded-circle me-3" width="48" height="48" alt="å¤´åƒ">
                            <div class="flex-grow-1">
                                <h5 class="card-title mb-1" th:text="${user.username}">ç”¨æˆ·å</h5>
                                <p class="card-text text-muted mb-0" th:text="${user.email}">é‚®ç®±</p>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input status-toggle" type="checkbox"
                                       th:checked="${user.enabled}" th:data-user-id="${user.id}">
                            </div>
                        </div>

                        <div class="row mb-2">
                            <div class="col-6">
                                <small class="text-muted">è§’è‰²</small>
                                <div>
                                    <span class="badge bg-primary" th:text="${user.role.displayName}">è§’è‰²</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">æ³¨å†Œæ—¶é—´</small>
                                <div th:text="${#temporals.format(user.createdAt, 'MM-dd')}">01-01</div>
                            </div>
                        </div>

                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-sm btn-outline-info view-btn"
                                    th:data-user-id="${user.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning edit-btn"
                                    th:data-user-id="${user.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-btn"
                                    th:data-user-id="${user.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ†é¡µ -->
        <nav th:if="${users.totalPages > 1}">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:class="${users.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/users(page=0)}">é¦–é¡µ</a>
                </li>
                <!-- æ›´å¤šåˆ†é¡µé“¾æ¥ -->
            </ul>
        </nav>
    </div>

    <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal fade" id="userModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">ç”¨æˆ·è¯¦æƒ…</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- åŠ¨æ€å†…å®¹ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-primary" id="modalSaveBtn">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/js/all.min.js"></script>
    <script th:inline="javascript">
        // å…¨å±€å˜é‡
        let currentPage = 0;
        let currentSize = 12;
        let searchKeyword = /*[[${keyword}]]*/ '';
        let currentRole = '';
        let currentStatus = '';

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            setupAutoRefresh();
        });

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            // æœç´¢è¾“å…¥
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchKeyword = e.target.value;
                    currentPage = 0;
                    loadUsers();
                }, 500);
            });

            // è§’è‰²è¿‡æ»¤
            document.getElementById('roleFilter').addEventListener('change', function(e) {
                currentRole = e.target.value;
                currentPage = 0;
                loadUsers();
            });

            // çŠ¶æ€è¿‡æ»¤
            document.getElementById('statusFilter').addEventListener('change', function(e) {
                currentStatus = e.target.value;
                currentPage = 0;
                loadUsers();
            });

            // æ·»åŠ ç”¨æˆ·æŒ‰é’®
            document.getElementById('addUserBtn').addEventListener('click', function() {
                showUserModal();
            });

            // ç”¨æˆ·å¡ç‰‡ç‚¹å‡»
            document.querySelectorAll('.user-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    if (!e.target.closest('button') && !e.target.closest('input')) {
                        const userId = this.dataset.userId;
                        viewUser(userId);
                    }
                });
            });

            // çŠ¶æ€åˆ‡æ¢
            document.querySelectorAll('.status-toggle').forEach(toggle => {
                toggle.addEventListener('change', function() {
                    const userId = this.dataset.userId;
                    const enabled = this.checked;
                    toggleUserStatus(userId, enabled);
                });
            });

            // æ“ä½œæŒ‰é’®
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userId = this.dataset.userId;
                    viewUser(userId);
                });
            });

            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userId = this.dataset.userId;
                    editUser(userId);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userId = this.dataset.userId;
                    deleteUser(userId);
                });
            });
        }

        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        function loadUsers() {
            showLoading();

            const params = new URLSearchParams({
                page: currentPage,
                size: currentSize
            });

            if (searchKeyword) params.append('keyword', searchKeyword);
            if (currentRole) params.append('role', currentRole);
            if (currentStatus) params.append('enabled', currentStatus);

            fetch(`/api/v1/users?${params}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderUserList(data.data.content);
                        updatePagination(data.data);
                    } else {
                        showNotification('error', data.message);
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
                    showNotification('error', 'åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥');
                })
                .finally(() => {
                    hideLoading();
                });
        }

        // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
        function renderUserList(users) {
            const userList = document.getElementById('userList');
            userList.innerHTML = users.map(user => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card user-card" data-user-id="${user.id}">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <img src="${user.avatarUrl || '/images/default-avatar.png'}"
                                     class="rounded-circle me-3" width="48" height="48" alt="å¤´åƒ">
                                <div class="flex-grow-1">
                                    <h5 class="card-title mb-1">${user.username}</h5>
                                    <p class="card-text text-muted mb-0">${user.email}</p>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input status-toggle" type="checkbox"
                                           ${user.enabled ? 'checked' : ''} data-user-id="${user.id}">
                                </div>
                            </div>

                            <div class="row mb-2">
                                <div class="col-6">
                                    <small class="text-muted">è§’è‰²</small>
                                    <div>
                                        <span class="badge bg-primary">${user.role.displayName}</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">æ³¨å†Œæ—¶é—´</small>
                                    <div>${formatDate(user.createdAt)}</div>
                                </div>
                            </div>

                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-sm btn-outline-info view-btn" data-user-id="${user.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning edit-btn" data-user-id="${user.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-btn" data-user-id="${user.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // é‡æ–°ç»‘å®šäº‹ä»¶
            bindUserCardEvents();
        }

        // ç»‘å®šç”¨æˆ·å¡ç‰‡äº‹ä»¶
        function bindUserCardEvents() {
            // çŠ¶æ€åˆ‡æ¢
            document.querySelectorAll('.status-toggle').forEach(toggle => {
                toggle.addEventListener('change', function() {
                    const userId = this.dataset.userId;
                    const enabled = this.checked;
                    toggleUserStatus(userId, enabled);
                });
            });

            // æ“ä½œæŒ‰é’®äº‹ä»¶ç»‘å®š...
        }

        // åˆ‡æ¢ç”¨æˆ·çŠ¶æ€
        function toggleUserStatus(userId, enabled) {
            const url = `/api/v1/users/${userId}/status`;
            const data = { enabled: enabled };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const status = enabled ? 'å¯ç”¨' : 'ç¦ç”¨';
                    showNotification('success', `ç”¨æˆ·${status}æˆåŠŸ`);
                } else {
                    showNotification('error', data.message);
                    // æ¢å¤å¼€å…³çŠ¶æ€
                    const toggle = document.querySelector(`.status-toggle[data-user-id="${userId}"]`);
                    if (toggle) toggle.checked = !enabled;
                }
            })
            .catch(error => {
                console.error('çŠ¶æ€åˆ‡æ¢å¤±è´¥:', error);
                showNotification('error', 'çŠ¶æ€åˆ‡æ¢å¤±è´¥');
                const toggle = document.querySelector(`.status-toggle[data-user-id="${userId}"]`);
                if (toggle) toggle.checked = !enabled;
            });
        }

        // æŸ¥çœ‹ç”¨æˆ·
        function viewUser(userId) {
            showLoading();
            fetch(`/api/v1/users/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showUserModal(data.data, 'view');
                    } else {
                        showNotification('error', data.message);
                    }
                })
                .catch(error => {
                    console.error('è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥:', error);
                    showNotification('error', 'è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥');
                })
                .finally(() => {
                    hideLoading();
                });
        }

        // æ˜¾ç¤ºç”¨æˆ·æ¨¡æ€æ¡†
        function showUserModal(user = null, mode = 'edit') {
            const modal = new bootstrap.Modal(document.getElementById('userModal'));
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalSaveBtn = document.getElementById('modalSaveBtn');

            if (mode === 'view') {
                modalTitle.textContent = 'ç”¨æˆ·è¯¦æƒ…';
                modalSaveBtn.style.display = 'none';
                modalBody.innerHTML = `
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <img src="${user.avatarUrl || '/images/default-avatar.png'}"
                                 class="rounded-circle mb-3" width="120" height="120" alt="å¤´åƒ">
                        </div>
                        <div class="col-md-8">
                            <table class="table table-borderless">
                                <tr><td><strong>ç”¨æˆ·å:</strong></td><td>${user.username}</td></tr>
                                <tr><td><strong>é‚®ç®±:</strong></td><td>${user.email}</td></tr>
                                <tr><td><strong>å…¨å:</strong></td><td>${user.fullName || '-'}</td></tr>
                                <tr><td><strong>ç”µè¯:</strong></td><td>${user.phoneNumber || '-'}</td></tr>
                                <tr><td><strong>è§’è‰²:</strong></td><td>${user.role.displayName}</td></tr>
                                <tr><td><strong>çŠ¶æ€:</strong></td><td>${user.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}</td></tr>
                                <tr><td><strong>åˆ›å»ºæ—¶é—´:</strong></td><td>${formatDateTime(user.createdAt)}</td></tr>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                modalTitle.textContent = user ? 'ç¼–è¾‘ç”¨æˆ·' : 'æ·»åŠ ç”¨æˆ·';
                modalSaveBtn.style.display = 'block';
                modalSaveBtn.textContent = user ? 'ä¿å­˜' : 'åˆ›å»º';

                // è¿™é‡Œå¯ä»¥åŠ è½½ç¼–è¾‘è¡¨å•
                modalBody.innerHTML = `
                    <form id="userForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">ç”¨æˆ·å</label>
                            <input type="text" class="form-control" id="username"
                                   value="${user ? user.username : ''}" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">é‚®ç®±</label>
                            <input type="email" class="form-control" id="email"
                                   value="${user ? user.email : ''}" required>
                        </div>
                        ${!user ? `
                        <div class="mb-3">
                            <label for="password" class="form-label">å¯†ç </label>
                            <input type="password" class="form-control" id="password" required>
                        </div>` : ''}
                        <div class="mb-3">
                            <label for="role" class="form-label">è§’è‰²</label>
                            <select class="form-select" id="role">
                                <option value="USER" ${user && user.role === 'USER' ? 'selected' : ''}>æ™®é€šç”¨æˆ·</option>
                                <option value="VIP" ${user && user.role === 'VIP' ? 'selected' : ''}>VIPç”¨æˆ·</option>
                                <option value="ADMIN" ${user && user.role === 'ADMIN' ? 'selected' : ''}>ç®¡ç†å‘˜</option>
                            </select>
                        </div>
                    </form>
                `;

                // ç»‘å®šä¿å­˜äº‹ä»¶
                modalSaveBtn.onclick = function() {
                    saveUser(user ? user.id : null);
                };
            }

            modal.show();
        }

        // ä¿å­˜ç”¨æˆ·
        function saveUser(userId) {
            const form = document.getElementById('userForm');
            const formData = new FormData(form);

            const userData = {
                username: formData.get('username'),
                email: formData.get('email'),
                role: formData.get('role')
            };

            if (!userId) {
                userData.password = formData.get('password');
            }

            const url = userId ? `/api/v1/users/${userId}` : '/api/v1/users';
            const method = userId ? 'PUT' : 'POST';

            showLoading();

            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('success', userId ? 'ç”¨æˆ·æ›´æ–°æˆåŠŸ' : 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ');
                    bootstrap.Modal.getInstance(document.getElementById('userModal')).hide();
                    loadUsers(); // é‡æ–°åŠ è½½åˆ—è¡¨
                } else {
                    showNotification('error', data.message);
                }
            })
            .catch(error => {
                console.error('ä¿å­˜ç”¨æˆ·å¤±è´¥:', error);
                showNotification('error', 'ä¿å­˜ç”¨æˆ·å¤±è´¥');
            })
            .finally(() => {
                hideLoading();
            });
        }

        // åˆ é™¤ç”¨æˆ·
        function deleteUser(userId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                return;
            }

            showLoading();

            fetch(`/api/v1/users/${userId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('success', 'ç”¨æˆ·åˆ é™¤æˆåŠŸ');
                    loadUsers(); // é‡æ–°åŠ è½½åˆ—è¡¨
                } else {
                    showNotification('error', data.message);
                }
            })
            .catch(error => {
                console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥:', error);
                showNotification('error', 'åˆ é™¤ç”¨æˆ·å¤±è´¥');
            })
            .finally(() => {
                hideLoading();
            });
        }

        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        // éšè—åŠ è½½åŠ¨ç”»
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(type, message) {
            const container = document.getElementById('notificationContainer');
            const notificationId = 'notification-' + Date.now();

            const alertClass = type === 'success' ? 'alert-success' :
                             type === 'error' ? 'alert-danger' :
                             type === 'warning' ? 'alert-warning' : 'alert-info';

            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `alert ${alertClass} alert-dismissible fade show notification`;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            container.appendChild(notification);

            // è‡ªåŠ¨ç§»é™¤é€šçŸ¥
            setTimeout(() => {
                const element = document.getElementById(notificationId);
                if (element) {
                    element.remove();
                }
            }, 5000);
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN');
        }

        // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
        function setupAutoRefresh() {
            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®ï¼ˆå¯é€‰ï¼‰
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    // loadUsers();
                }
            }, 30000);
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination(pageData) {
            // å®ç°åˆ†é¡µé€»è¾‘
            console.log('æ›´æ–°åˆ†é¡µ:', pageData);
        }
    </script>
</body>
</html>
```

## ğŸ”„ é«˜çº§AJAXåŠŸèƒ½

### 1. å®æ—¶æœç´¢å’Œè‡ªåŠ¨å®Œæˆ

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>å®æ—¶æœç´¢ç¤ºä¾‹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .autocomplete-item:hover,
        .autocomplete-item.active {
            background-color: #f8f9fa;
        }

        .search-highlight {
            background-color: #ffeb3b;
            padding: 1px 2px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>å®æ—¶æœç´¢å’Œè‡ªåŠ¨å®Œæˆ</h2>

        <!-- æœç´¢æ¡† -->
        <div class="row mb-4">
            <div class="col-md-8 mx-auto">
                <div class="position-relative">
                    <input type="text" id="searchInput" class="form-control form-control-lg"
                           placeholder="æœç´¢ç”¨æˆ·..." autocomplete="off">
                    <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        è¾“å…¥ç”¨æˆ·åã€é‚®ç®±æˆ–å…¨åè¿›è¡Œæœç´¢ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…
                    </small>
                </div>
            </div>
        </div>

        <!-- æœç´¢å†å² -->
        <div class="row mb-4">
            <div class="col-md-8 mx-auto">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">æœç´¢å†å²</h6>
                        <button id="clearHistory" class="btn btn-sm btn-outline-secondary">æ¸…ç©º</button>
                    </div>
                    <div class="card-body">
                        <div id="searchHistory" class="d-flex flex-wrap gap-2">
                            <!-- æœç´¢å†å²æ ‡ç­¾ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æœç´¢ç»“æœ -->
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div id="searchResults">
                    <!-- æœç´¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>

    <script>
        class SearchManager {
            constructor() {
                this.searchInput = document.getElementById('searchInput');
                this.autocompleteDropdown = document.getElementById('autocompleteDropdown');
                this.searchResults = document.getElementById('searchResults');
                this.searchHistory = document.getElementById('searchHistory');
                this.clearHistoryBtn = document.getElementById('clearHistory');

                this.searchTimeout = null;
                this.currentResults = [];
                this.selectedResultIndex = -1;
                this.history = this.loadSearchHistory();

                this.initializeEventListeners();
                this.renderSearchHistory();
            }

            initializeEventListeners() {
                // æœç´¢è¾“å…¥
                this.searchInput.addEventListener('input', (e) => {
                    this.handleSearchInput(e.target.value);
                });

                // é”®ç›˜å¯¼èˆª
                this.searchInput.addEventListener('keydown', (e) => {
                    this.handleKeyNavigation(e);
                });

                // å¤±å»ç„¦ç‚¹æ—¶éšè—è‡ªåŠ¨å®Œæˆ
                this.searchInput.addEventListener('blur', () => {
                    setTimeout(() => {
                        this.hideAutocomplete();
                    }, 200);
                });

                // è·å¾—ç„¦ç‚¹æ—¶æ˜¾ç¤ºè‡ªåŠ¨å®Œæˆ
                this.searchInput.addEventListener('focus', () => {
                    if (this.searchInput.value.trim()) {
                        this.showAutocomplete();
                    }
                });

                // æ¸…ç©ºå†å²
                this.clearHistoryBtn.addEventListener('click', () => {
                    this.clearSearchHistory();
                });

                // ç‚¹å‡»å¤–éƒ¨å…³é—­è‡ªåŠ¨å®Œæˆ
                document.addEventListener('click', (e) => {
                    if (!this.searchInput.contains(e.target) &&
                        !this.autocompleteDropdown.contains(e.target)) {
                        this.hideAutocomplete();
                    }
                });
            }

            handleSearchInput(value) {
                clearTimeout(this.searchTimeout);

                if (value.trim().length < 2) {
                    this.hideAutocomplete();
                    this.searchResults.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-search fa-2x mb-2"></i>
                            <p>è¯·è¾“å…¥è‡³å°‘2ä¸ªå­—ç¬¦è¿›è¡Œæœç´¢</p>
                        </div>
                    `;
                    return;
                }

                this.searchTimeout = setTimeout(() => {
                    this.performSearch(value);
                }, 300);
            }

            performSearch(query) {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                this.autocompleteDropdown.innerHTML = `
                    <div class="text-center p-3">
                        <div class="spinner-border spinner-border-sm me-2"></div>
                        æœç´¢ä¸­...
                    </div>
                `;
                this.showAutocomplete();

                const params = new URLSearchParams({
                    keyword: query,
                    size: 10
                });

                fetch(`/api/v1/users/search?${params}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            this.currentResults = data.data.content;
                            this.renderAutocomplete(query);
                            this.renderSearchResults(query, data.data);
                            this.addToSearchHistory(query);
                        } else {
                            this.showError(data.message);
                        }
                    })
                    .catch(error => {
                        console.error('æœç´¢å¤±è´¥:', error);
                        this.showError('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                    });
            }

            renderAutocomplete(query) {
                if (this.currentResults.length === 0) {
                    this.autocompleteDropdown.innerHTML = `
                        <div class="text-center p-3 text-muted">
                            æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·
                        </div>
                    `;
                    return;
                }

                const html = this.currentResults.map((user, index) => {
                    const highlightedUsername = this.highlightText(user.username, query);
                    const highlightedEmail = this.highlightText(user.email, query);

                    return `
                        <div class="autocomplete-item" data-index="${index}" data-user-id="${user.id}">
                            <div class="d-flex align-items-center">
                                <img src="${user.avatarUrl || '/images/default-avatar.png'}"
                                     class="rounded-circle me-3" width="32" height="32" alt="å¤´åƒ">
                                <div class="flex-grow-1">
                                    <div class="fw-bold">${highlightedUsername}</div>
                                    <small class="text-muted">${highlightedEmail}</small>
                                </div>
                                <div>
                                    <span class="badge bg-primary">${user.role.displayName}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                this.autocompleteDropdown.innerHTML = html;
                this.bindAutocompleteEvents();
                this.selectedResultIndex = -1;
            }

            bindAutocompleteEvents() {
                const items = this.autocompleteDropdown.querySelectorAll('.autocomplete-item');
                items.forEach(item => {
                    item.addEventListener('click', () => {
                        const userId = item.dataset.userId;
                        const user = this.currentResults.find(u => u.id == userId);
                        if (user) {
                            this.selectUser(user);
                        }
                    });

                    item.addEventListener('mouseenter', () => {
                        this.removeActiveClass();
                        item.classList.add('active');
                        this.selectedResultIndex = parseInt(item.dataset.index);
                    });
                });
            }

            handleKeyNavigation(e) {
                const items = this.autocompleteDropdown.querySelectorAll('.autocomplete-item');

                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        this.navigateDown(items);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        this.navigateUp(items);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        this.selectCurrentResult();
                        break;
                    case 'Escape':
                        e.preventDefault();
                        this.hideAutocomplete();
                        break;
                }
            }

            navigateDown(items) {
                if (items.length === 0) return;

                this.removeActiveClass();
                this.selectedResultIndex = Math.min(this.selectedResultIndex + 1, items.length - 1);
                items[this.selectedResultIndex].classList.add('active');
            }

            navigateUp(items) {
                if (items.length === 0) return;

                this.removeActiveClass();
                this.selectedResultIndex = Math.max(this.selectedResultIndex - 1, 0);
                items[this.selectedResultIndex].classList.add('active');
            }

            removeActiveClass() {
                const activeItem = this.autocompleteDropdown.querySelector('.autocomplete-item.active');
                if (activeItem) {
                    activeItem.classList.remove('active');
                }
            }

            selectCurrentResult() {
                const activeItem = this.autocompleteDropdown.querySelector('.autocomplete-item.active');
                if (activeItem) {
                    const userId = activeItem.dataset.userId;
                    const user = this.currentResults.find(u => u.id == userId);
                    if (user) {
                        this.selectUser(user);
                    }
                }
            }

            selectUser(user) {
                this.searchInput.value = user.username;
                this.hideAutocomplete();
                this.showUserDetail(user);
            }

            showUserDetail(user) {
                this.searchResults.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 text-center">
                                    <img src="${user.avatarUrl || '/images/default-avatar.png'}"
                                         class="rounded-circle mb-3" width="120" height="120" alt="å¤´åƒ">
                                </div>
                                <div class="col-md-9">
                                    <h4>${user.username}</h4>
                                    <p class="text-muted">${user.email}</p>
                                    <table class="table table-sm">
                                        <tr><td>å…¨å:</td><td>${user.fullName || '-'}</td></tr>
                                        <tr><td>ç”µè¯:</td><td>${user.phoneNumber || '-'}</td></tr>
                                        <tr><td>è§’è‰²:</td><td><span class="badge bg-primary">${user.role.displayName}</span></td></tr>
                                        <tr><td>çŠ¶æ€:</td><td><span class="badge ${user.enabled ? 'bg-success' : 'bg-secondary'}">${user.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}</span></td></tr>
                                        <tr><td>æ³¨å†Œæ—¶é—´:</td><td>${new Date(user.createdAt).toLocaleString('zh-CN')}</td></tr>
                                    </table>
                                    <div class="mt-3">
                                        <button class="btn btn-primary me-2" onclick="viewUser(${user.id})">
                                            <i class="fas fa-eye me-1"></i>æŸ¥çœ‹è¯¦æƒ…
                                        </button>
                                        <button class="btn btn-outline-secondary" onclick="editUser(${user.id})">
                                            <i class="fas fa-edit me-1"></i>ç¼–è¾‘
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderSearchResults(query, pageData) {
                const html = `
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">æœç´¢ç»“æœ (${pageData.totalElements} æ¡è®°å½•)</h6>
                        </div>
                        <div class="card-body">
                            ${pageData.content.length === 0 ?
                                '<p class="text-muted text-center py-4">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·</p>' :
                                pageData.content.map(user => `
                                    <div class="d-flex align-items-center p-2 border-bottom">
                                        <img src="${user.avatarUrl || '/images/default-avatar.png'}"
                                             class="rounded-circle me-3" width="40" height="40" alt="å¤´åƒ">
                                        <div class="flex-grow-1">
                                            <div class="fw-bold">${user.username}</div>
                                            <small class="text-muted">${user.email}</small>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewUser(${user.id})">
                                            æŸ¥çœ‹
                                        </button>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;

                this.searchResults.innerHTML = html;
            }

            highlightText(text, query) {
                if (!query) return text;
                const regex = new RegExp(`(${query})`, 'gi');
                return text.replace(regex, '<span class="search-highlight">$1</span>');
            }

            showAutocomplete() {
                this.autocompleteDropdown.style.display = 'block';
            }

            hideAutocomplete() {
                this.autocompleteDropdown.style.display = 'none';
            }

            showError(message) {
                this.autocompleteDropdown.innerHTML = `
                    <div class="text-center p-3 text-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>${message}
                    </div>
                `;
                this.showAutocomplete();
            }

            // æœç´¢å†å²åŠŸèƒ½
            loadSearchHistory() {
                const saved = localStorage.getItem('searchHistory');
                return saved ? JSON.parse(saved) : [];
            }

            saveSearchHistory() {
                localStorage.setItem('searchHistory', JSON.stringify(this.history));
            }

            addToSearchHistory(query) {
                if (!query || query.trim().length < 2) return;

                query = query.trim();
                this.history = this.history.filter(item => item !== query);
                this.history.unshift(query);
                this.history = this.history.slice(0, 10); // æœ€å¤šä¿å­˜10æ¡
                this.saveSearchHistory();
                this.renderSearchHistory();
            }

            clearSearchHistory() {
                this.history = [];
                this.saveSearchHistory();
                this.renderSearchHistory();
            }

            renderSearchHistory() {
                if (this.history.length === 0) {
                    this.searchHistory.innerHTML = '<p class="text-muted">æš‚æ— æœç´¢å†å²</p>';
                    return;
                }

                const html = this.history.map(query => `
                    <span class="badge bg-light text-dark cursor-pointer" onclick="searchManager.searchHistoryItem('${query}')">
                        ${query}
                        <i class="fas fa-times ms-1" onclick="event.stopPropagation(); searchManager.removeFromHistory('${query}')"></i>
                    </span>
                `).join('');

                this.searchHistory.innerHTML = html;
            }

            searchHistoryItem(query) {
                this.searchInput.value = query;
                this.performSearch(query);
            }

            removeFromHistory(query) {
                this.history = this.history.filter(item => item !== query);
                this.saveSearchHistory();
                this.renderSearchHistory();
            }
        }

        // åˆå§‹åŒ–æœç´¢ç®¡ç†å™¨
        const searchManager = new SearchManager();

        // å…¨å±€å‡½æ•°ï¼ˆä¾›HTMLè°ƒç”¨ï¼‰
        function viewUser(userId) {
            console.log('æŸ¥çœ‹ç”¨æˆ·:', userId);
            // å®ç°æŸ¥çœ‹ç”¨æˆ·é€»è¾‘
        }

        function editUser(userId) {
            console.log('ç¼–è¾‘ç”¨æˆ·:', userId);
            // å®ç°ç¼–è¾‘ç”¨æˆ·é€»è¾‘
        }
    </script>
</body>
</html>
```

## ğŸ“Š å®æ—¶æ•°æ®æ›´æ–°

### 1. WebSocketå®æ—¶é€šçŸ¥

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>å®æ—¶æ•°æ®æ›´æ–°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
            max-width: 400px;
        }

        .notification-enter {
            animation: slideInRight 0.3s ease-out;
        }

        .notification-exit {
            animation: slideOutRight 0.3s ease-in;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
            }
        }

        .data-update {
            background-color: #fff3cd;
            transition: background-color 2s ease;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>å®æ—¶æ•°æ®ç›‘æ§
                <span class="live-indicator ms-2"></span>
                <small class="text-muted ms-2">å®æ—¶æ›´æ–°ä¸­</small>
            </h2>
            <div>
                <button id="pauseBtn" class="btn btn-outline-warning btn-sm">
                    <i class="fas fa-pause me-1"></i>æš‚åœ
                </button>
                <button id="refreshBtn" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-sync-alt me-1"></i>åˆ·æ–°
                </button>
            </div>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="row mb-4" id="statsCards">
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-primary" id="totalUsers">-</h3>
                        <p class="card-text">æ€»ç”¨æˆ·æ•°</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-success" id="onlineUsers">-</h3>
                        <p class="card-text">åœ¨çº¿ç”¨æˆ·</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-info" id="newUsersToday">-</h3>
                        <p class="card-text">ä»Šæ—¥æ–°å¢</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-warning" id="systemLoad">-</h3>
                        <p class="card-text">ç³»ç»Ÿè´Ÿè½½</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å®æ—¶æ´»åŠ¨æ—¥å¿— -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">å®æ—¶æ´»åŠ¨</h5>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="activityLog">
                            <!-- æ´»åŠ¨æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ç³»ç»ŸçŠ¶æ€</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span>CPUä½¿ç”¨ç‡</span>
                                <span id="cpuUsage">-</span>
                            </div>
                            <div class="progress">
                                <div id="cpuProgressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span>å†…å­˜ä½¿ç”¨ç‡</span>
                                <span id="memoryUsage">-</span>
                            </div>
                            <div class="progress">
                                <div id="memoryProgressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span>ç½‘ç»œçŠ¶æ€</span>
                                <span id="networkStatus" class="badge bg-success">æ­£å¸¸</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notificationContainer"></div>

    <script th:inline="javascript">
        class RealTimeMonitor {
            constructor() {
                this.isPaused = false;
                this.updateInterval = null;
                this.websocket = null;
                this.notificationQueue = [];

                this.initializeWebSocket();
                this.startPeriodicUpdate();
                this.bindEventListeners();
            }

            initializeWebSocket() {
                // æ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶éœ€è¦é…ç½®WebSocketç«¯ç‚¹
                // const wsUrl = `ws://${window.location.host}/ws/monitor`;
                // this.websocket = new WebSocket(wsUrl);

                // this.websocket.onopen = () => {
                //     console.log('WebSocketè¿æ¥å·²å»ºç«‹');
                //     this.showNotification('success', 'å®æ—¶è¿æ¥å·²å»ºç«‹');
                // };

                // this.websocket.onmessage = (event) => {
                //     const data = JSON.parse(event.data);
                //     this.handleWebSocketMessage(data);
                // };

                // this.websocket.onclose = () => {
                //     console.log('WebSocketè¿æ¥å·²å…³é—­');
                //     this.showNotification('warning', 'å®æ—¶è¿æ¥å·²æ–­å¼€');
                //     // å°è¯•é‡è¿
                //     setTimeout(() => this.initializeWebSocket(), 5000);
                // };

                // æ¨¡æ‹ŸWebSocketæ¶ˆæ¯
                this.simulateWebSocketMessages();
            }

            simulateWebSocketMessages() {
                // æ¨¡æ‹Ÿå®æ—¶æ¶ˆæ¯æ¨é€
                setInterval(() => {
                    if (!this.isPaused) {
                        const messages = [
                            { type: 'user_login', username: 'user' + Math.floor(Math.random() * 1000) },
                            { type: 'user_register', username: 'newuser' + Math.floor(Math.random() * 1000) },
                            { type: 'system_alert', message: 'ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜' },
                            { type: 'data_update', target: 'stats' }
                        ];

                        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                        this.handleWebSocketMessage(randomMessage);
                    }
                }, Math.random() * 10000 + 5000); // 5-15ç§’éšæœºé—´éš”
            }

            handleWebSocketMessage(data) {
                switch (data.type) {
                    case 'user_login':
                        this.addActivityLog(`${data.username} ç™»å½•ç³»ç»Ÿ`, 'login');
                        this.showNotification('info', `${data.username} å·²ç™»å½•`);
                        this.updateStats();
                        break;
                    case 'user_register':
                        this.addActivityLog(`æ–°ç”¨æˆ· ${data.username} æ³¨å†Œ`, 'register');
                        this.showNotification('success', `æ¬¢è¿æ–°ç”¨æˆ· ${data.username}`);
                        this.updateStats();
                        break;
                    case 'system_alert':
                        this.addActivityLog(data.message, 'alert');
                        this.showNotification('warning', data.message);
                        break;
                    case 'data_update':
                        this.updateStats();
                        break;
                }
            }

            startPeriodicUpdate() {
                this.updateInterval = setInterval(() => {
                    if (!this.isPaused) {
                        this.updateStats();
                        this.updateSystemStatus();
                    }
                }, 5000); // æ¯5ç§’æ›´æ–°ä¸€æ¬¡
            }

            updateStats() {
                // æ¨¡æ‹Ÿè·å–ç»Ÿè®¡æ•°æ®
                const stats = {
                    totalUsers: Math.floor(Math.random() * 100) + 1200,
                    onlineUsers: Math.floor(Math.random() * 50) + 150,
                    newUsersToday: Math.floor(Math.random() * 20) + 5,
                    systemLoad: (Math.random() * 40 + 30).toFixed(1)
                };

                this.updateStatCard('totalUsers', stats.totalUsers);
                this.updateStatCard('onlineUsers', stats.onlineUsers);
                this.updateStatCard('newUsersToday', stats.newUsersToday);
                this.updateStatCard('systemLoad', stats.systemLoad + '%');
            }

            updateStatCard(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    const oldValue = element.textContent;
                    if (oldValue !== value.toString()) {
                        element.textContent = value;
                        element.parentElement.parentElement.classList.add('data-update');
                        setTimeout(() => {
                            element.parentElement.parentElement.classList.remove('data-update');
                        }, 2000);
                    }
                }
            }

            updateSystemStatus() {
                const cpuUsage = Math.floor(Math.random() * 30) + 40;
                const memoryUsage = Math.floor(Math.random() * 20) + 60;

                document.getElementById('cpuUsage').textContent = cpuUsage + '%';
                document.getElementById('cpuProgressBar').style.width = cpuUsage + '%';
                document.getElementById('cpuProgressBar').className =
                    cpuUsage > 80 ? 'progress-bar bg-danger' :
                    cpuUsage > 60 ? 'progress-bar bg-warning' : 'progress-bar bg-success';

                document.getElementById('memoryUsage').textContent = memoryUsage + '%';
                document.getElementById('memoryProgressBar').style.width = memoryUsage + '%';
                document.getElementById('memoryProgressBar').className =
                    memoryUsage > 80 ? 'progress-bar bg-danger' :
                    memoryUsage > 60 ? 'progress-bar bg-warning' : 'progress-bar bg-info';
            }

            addActivityLog(message, type = 'info') {
                const logContainer = document.getElementById('activityLog');
                const timestamp = new Date().toLocaleTimeString('zh-CN');

                const iconMap = {
                    'login': 'fas fa-sign-in-alt text-success',
                    'register': 'fas fa-user-plus text-primary',
                    'alert': 'fas fa-exclamation-triangle text-warning',
                    'info': 'fas fa-info-circle text-info'
                };

                const logEntry = document.createElement('div');
                logEntry.className = 'd-flex align-items-start mb-2 p-2 border-bottom';
                logEntry.innerHTML = `
                    <i class="${iconMap[type]} me-2 mt-1"></i>
                    <div class="flex-grow-1">
                        <div>${message}</div>
                        <small class="text-muted">${timestamp}</small>
                    </div>
                `;

                logContainer.insertBefore(logEntry, logContainer.firstChild);

                // ä¿æŒæœ€å¤š50æ¡è®°å½•
                while (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }

            showNotification(type, message) {
                const container = document.getElementById('notificationContainer');
                const notificationId = 'notification-' + Date.now();

                const typeClassMap = {
                    'success': 'alert-success',
                    'error': 'alert-danger',
                    'warning': 'alert-warning',
                    'info': 'alert-info'
                };

                const iconMap = {
                    'success': 'fas fa-check-circle',
                    'error': 'fas fa-exclamation-circle',
                    'warning': 'fas fa-exclamation-triangle',
                    'info': 'fas fa-info-circle'
                };

                const notification = document.createElement('div');
                notification.id = notificationId;
                notification.className = `alert ${typeClassMap[type]} alert-dismissible fade show notification-toast notification-enter`;
                notification.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="${iconMap[type]} me-2"></i>
                        <div class="flex-grow-1">${message}</div>
                        <button type="button" class="btn-close ms-2" data-bs-dismiss="alert"></button>
                    </div>
                `;

                container.appendChild(notification);

                // è‡ªåŠ¨ç§»é™¤é€šçŸ¥
                setTimeout(() => {
                    notification.classList.remove('notification-enter');
                    notification.classList.add('notification-exit');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }, 5000);
            }

            bindEventListeners() {
                document.getElementById('pauseBtn').addEventListener('click', () => {
                    this.togglePause();
                });

                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.manualRefresh();
                });

                // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶çš„å¤„ç†
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.pause();
                    } else {
                        this.resume();
                    }
                });
            }

            togglePause() {
                if (this.isPaused) {
                    this.resume();
                } else {
                    this.pause();
                }
            }

            pause() {
                this.isPaused = true;
                const btn = document.getElementById('pauseBtn');
                btn.innerHTML = '<i class="fas fa-play me-1"></i>ç»§ç»­';
                btn.classList.remove('btn-outline-warning');
                btn.classList.add('btn-outline-success');

                this.showNotification('info', 'å®æ—¶æ›´æ–°å·²æš‚åœ');
            }

            resume() {
                this.isPaused = false;
                const btn = document.getElementById('pauseBtn');
                btn.innerHTML = '<i class="fas fa-pause me-1"></i>æš‚åœ';
                btn.classList.remove('btn-outline-success');
                btn.classList.add('btn-outline-warning');

                this.showNotification('info', 'å®æ—¶æ›´æ–°å·²æ¢å¤');
                this.updateStats();
                this.updateSystemStatus();
            }

            manualRefresh() {
                this.showNotification('info', 'æ­£åœ¨åˆ·æ–°æ•°æ®...');
                this.updateStats();
                this.updateSystemStatus();
            }
        }

        // åˆå§‹åŒ–å®æ—¶ç›‘æ§
        const monitor = new RealTimeMonitor();

        // åˆå§‹åŠ è½½
        monitor.updateStats();
        monitor.updateSystemStatus();
    </script>
</body>
</html>
```

## âœ… æ£€æŸ¥ç‚¹

å®Œæˆæœ¬èŠ‚å­¦ä¹ åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] å®ç°JavaScriptä¸Thymeleafçš„äº¤äº’
- [ ] ä½¿ç”¨AJAXè¿›è¡Œå¼‚æ­¥æ•°æ®è¯·æ±‚
- [ ] åˆ›å»ºå®æ—¶æœç´¢å’Œè‡ªåŠ¨å®ŒæˆåŠŸèƒ½
- [ ] å®ç°WebSocketå®æ—¶æ•°æ®æ›´æ–°
- [ ] ä¼˜åŒ–å‰ç«¯ç”¨æˆ·ä½“éªŒ

## ğŸš€ ä¸‹ä¸€æ­¥

å‰ç«¯é¡µé¢å¼€å‘å®Œæˆåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿›å…¥ï¼š
[é«˜çº§åŠŸèƒ½ - å…¨å±€å¼‚å¸¸å¤„ç†](../06-é«˜çº§åŠŸèƒ½/01-å¼‚å¸¸å¤„ç†.md)

---

**æç¤º**: è‰¯å¥½çš„å‰ç«¯äº¤äº’èƒ½å¤Ÿæ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒï¼Œåˆç†ä½¿ç”¨AJAXå’Œå®æ—¶æ›´æ–°æŠ€æœ¯å¯ä»¥è®©åº”ç”¨æ›´åŠ ç°ä»£åŒ–å’Œå“åº”è¿…é€Ÿã€‚