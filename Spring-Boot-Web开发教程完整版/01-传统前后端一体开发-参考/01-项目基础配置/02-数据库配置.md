# æ•°æ®åº“è¿æ¥é…ç½®

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- å­¦ä¼šé…ç½®Spring Bootä¸MySQLæ•°æ®åº“çš„è¿æ¥
- ç†è§£æ•°æ®åº“è¿æ¥æ± çš„é…ç½®
- æŒæ¡JPAç›¸å…³é…ç½®é€‰é¡¹

## ğŸ› ï¸ æ•°æ®åº“å‡†å¤‡

### 1. å®‰è£…MySQLæ•°æ®åº“

#### Windowså®‰è£…
```bash
# ä¸‹è½½MySQLå®‰è£…åŒ…
# è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹©"Server only"æˆ–"Developer Default"
# è®¾ç½®rootç”¨æˆ·å¯†ç ï¼ˆå»ºè®®ï¼šroot123ï¼‰
# å¯åŠ¨MySQLæœåŠ¡
```

#### macOSå®‰è£…
```bash
# ä½¿ç”¨Homebrewå®‰è£…
brew install mysql

# å¯åŠ¨MySQLæœåŠ¡
brew services start mysql

# è®¾ç½®rootå¯†ç 
mysql_secure_installation
```

#### Linuxå®‰è£…
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨è®¾ç½®
sudo mysql_secure_installation
```

### 2. åˆ›å»ºæ•°æ®åº“

è¿æ¥åˆ°MySQLå¹¶åˆ›å»ºé¡¹ç›®æ•°æ®åº“ï¼š

```sql
-- ç™»å½•MySQL
mysql -u root -p

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE springweb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆæ¨èï¼‰
CREATE USER 'springweb'@'localhost' IDENTIFIED BY 'springweb123';
GRANT ALL PRIVILEGES ON springweb.* TO 'springweb'@'localhost';
FLUSH PRIVILEGES;

-- æŸ¥çœ‹æ•°æ®åº“
SHOW DATABASES;
USE springweb;
```

## ğŸ”§ application.propertiesé…ç½®

åœ¨`src/main/resources/application.properties`ä¸­é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```properties
# ===================================================================
# æ•°æ®åº“è¿æ¥é…ç½®
# ===================================================================

# æ•°æ®åº“è¿æ¥åŸºæœ¬ä¿¡æ¯
spring.datasource.url=jdbc:mysql://localhost:3306/springweb?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
spring.datasource.username=springweb
spring.datasource.password=springweb123
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# æ•°æ®åº“è¿æ¥æ± é…ç½®ï¼ˆHikariCPï¼‰
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.auto-commit=true

# ===================================================================
# JPAé…ç½®
# ===================================================================

# æ•°æ®åº“æ–¹è¨€
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect

# SQLè¯­å¥æ˜¾ç¤ºï¼ˆå¼€å‘ç¯å¢ƒï¼‰
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# æ•°æ®åº“è¡¨åˆ›å»ºç­–ç•¥
spring.jpa.hibernate.ddl-auto=update

# ç»Ÿè®¡ä¿¡æ¯
spring.jpa.properties.hibernate.generate_statistics=true

# æ‰¹å¤„ç†é…ç½®
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ===================================================================
# åº”ç”¨åŸºæœ¬é…ç½®
# ===================================================================

# åº”ç”¨åç§°
spring.application.name=SpringWeb

# æœåŠ¡å™¨ç«¯å£
server.port=8080

# æœåŠ¡å™¨ç¼–ç 
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# ===================================================================
# æ—¥å¿—é…ç½®
# ===================================================================

# æ—¥å¿—çº§åˆ«
logging.level.com.cmliy.springweb=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# æ—¥å¿—æ–‡ä»¶é…ç½®
logging.file.name=logs/springweb.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# ===================================================================
# å¼€å‘å·¥å…·é…ç½®
# ===================================================================

# çƒ­éƒ¨ç½²
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true

# é™æ€èµ„æºç¼“å­˜
spring.web.resources.cache.period=0
```

## ğŸ“ é…ç½®å‚æ•°è¯¦è§£

### æ•°æ®åº“è¿æ¥å‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `spring.datasource.url` | æ•°æ®åº“è¿æ¥URL | `jdbc:mysql://localhost:3306/dbname` |
| `spring.datasource.username` | æ•°æ®åº“ç”¨æˆ·å | `springweb` |
| `spring.datasource.password` | æ•°æ®åº“å¯†ç  | `springweb123` |
| `spring.datasource.driver-class-name` | JDBCé©±åŠ¨ç±» | `com.mysql.cj.jdbc.Driver` |

### è¿æ¥æ± é…ç½®ï¼ˆHikariCPï¼‰

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `connection-timeout` | è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ | 30000 |
| `maximum-pool-size` | æœ€å¤§è¿æ¥æ± å¤§å° | 10 |
| `minimum-idle` | æœ€å°ç©ºé—²è¿æ¥æ•° | 10 |
| `idle-timeout` | ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ | 600000 |
| `max-lifetime` | è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆæ¯«ç§’ï¼‰ | 1800000 |

### JPAé…ç½®å‚æ•°

| å‚æ•° | è¯´æ˜ | å¯é€‰å€¼ |
|------|------|--------|
| `spring.jpa.hibernate.ddl-auto` | æ•°æ®åº“è¡¨åˆ›å»ºç­–ç•¥ | `none`, `validate`, `update`, `create`, `create-drop` |
| `spring.jpa.show-sql` | æ˜¯å¦æ˜¾ç¤ºSQLè¯­å¥ | `true`, `false` |
| `spring.jpa.database-platform` | æ•°æ®åº“æ–¹è¨€ | æ ¹æ®æ•°æ®åº“ç±»å‹é€‰æ‹© |

### ddl-autoé€‰é¡¹è¯´æ˜

- **none**: ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
- **validate**: éªŒè¯æ•°æ®åº“ç»“æ„ï¼Œä¸ä¿®æ”¹
- **update**: æ›´æ–°æ•°æ®åº“ç»“æ„ï¼ˆæ¨èå¼€å‘ç¯å¢ƒä½¿ç”¨ï¼‰
- **create**: æ¯æ¬¡å¯åŠ¨åˆ›å»ºè¡¨ï¼ˆä¼šåˆ é™¤æ•°æ®ï¼‰
- **create-drop**: å¯åŠ¨æ—¶åˆ›å»ºï¼Œå…³é—­æ—¶åˆ é™¤

## ğŸ”„ ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒé…ç½®

åˆ›å»º`application-dev.properties`ï¼š

```properties
# å¼€å‘ç¯å¢ƒé…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/springweb_dev?useSSL=false&serverTimezone=Asia/Shanghai
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=update
logging.level.com.cmliy.springweb=DEBUG
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

åˆ›å»º`application-prod.properties`ï¼š

```properties
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring.datasource.url=jdbc:mysql://prod-db-host:3306/springweb_prod?useSSL=true&serverTimezone=Asia/Shanghai
spring.jpa.show-sql=false
spring.jpa.hibernate.ddl-auto=validate
logging.level.com.cmliy.springweb=INFO
logging.level.org.springframework.web=WARN
```

### æ¿€æ´»ç¯å¢ƒé…ç½®

åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæ¿€æ´»çš„é…ç½®ï¼š

```properties
# æ¿€æ´»å¼€å‘ç¯å¢ƒ
spring.profiles.active=dev
```

æˆ–é€šè¿‡å¯åŠ¨å‚æ•°æŒ‡å®šï¼š

```bash
java -jar SpringWeb.jar --spring.profiles.active=prod
```

## ğŸ§ª è¿æ¥æµ‹è¯•

### 1. å¯åŠ¨åº”ç”¨æµ‹è¯•

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
mvn spring-boot:run
```

### 2. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºï¼ŒæŸ¥æ‰¾ä»¥ä¸‹ä¿¡æ¯ï¼š

```
Started SpringWebApplication in X.XXX seconds
HikariPool-1 - Starting...
HikariPool-1 - Start completed.
```

### 3. æ•°æ®åº“è¿æ¥éªŒè¯

```java
@RestController
public class TestController {

    @Autowired
    private DataSource dataSource;

    @GetMapping("/test-db")
    public String testDatabase() {
        try (Connection connection = dataSource.getConnection()) {
            return "æ•°æ®åº“è¿æ¥æˆåŠŸï¼è¿æ¥ä¿¡æ¯ï¼š" + connection.getMetaData().getDatabaseProductName();
        } catch (SQLException e) {
            return "æ•°æ®åº“è¿æ¥å¤±è´¥ï¼š" + e.getMessage();
        }
    }
}
```

è®¿é—® `http://localhost:8080/test-db` æµ‹è¯•è¿æ¥ã€‚

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### 1. è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Communications link failure`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
- éªŒè¯æ•°æ®åº“URLã€ç”¨æˆ·åã€å¯†ç 
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. æ—¶åŒºé—®é¢˜

**é”™è¯¯ä¿¡æ¯**: `The server time zone value 'XXX' is unrecognized`

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨URLä¸­æ·»åŠ æ—¶åŒºå‚æ•°ï¼š`?serverTimezone=Asia/Shanghai`
- æˆ–ä¿®æ”¹MySQLæ—¶åŒºè®¾ç½®

### 3. SSLè¿æ¥é—®é¢˜

**é”™è¯¯ä¿¡æ¯**: `SSL connection required`

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨URLä¸­æ·»åŠ ï¼š`?useSSL=false`
- æˆ–é…ç½®SSLè¯ä¹¦

### 4. æƒé™é—®é¢˜

**é”™è¯¯ä¿¡æ¯**: `Access denied for user`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç”¨æˆ·æƒé™è®¾ç½®
- ç¡®è®¤æ•°æ®åº“ç”¨æˆ·å­˜åœ¨ä¸”å¯†ç æ­£ç¡®

## âœ… æ£€æŸ¥ç‚¹

å®Œæˆæœ¬èŠ‚å­¦ä¹ åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] æˆåŠŸå®‰è£…å’Œé…ç½®MySQLæ•°æ®åº“
- [ ] åˆ›å»ºé¡¹ç›®æ•°æ®åº“å’Œç”¨æˆ·
- [ ] æ­£ç¡®é…ç½®application.properties
- [ ] ç†è§£å„ç§é…ç½®å‚æ•°çš„ä½œç”¨
- [ ] èƒ½å¤Ÿæ’æŸ¥å¸¸è§çš„æ•°æ®åº“è¿æ¥é—®é¢˜

## ğŸš€ ä¸‹ä¸€æ­¥

æ•°æ®åº“é…ç½®å®Œæˆåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ ï¼š
[é¡¹ç›®ç»“æ„è¯´æ˜](03-é¡¹ç›®ç»“æ„.md)

---

**æç¤º**: å»ºè®®åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨`update`ç­–ç•¥ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨`validate`ç­–ç•¥ã€‚