---
tags:
  - æ€§èƒ½ä¼˜åŒ–
  - SQLä¼˜åŒ–
  - JPAè°ƒä¼˜
  - ç¼“å­˜ç­–ç•¥
  - è¿æ¥æ± ä¼˜åŒ–
created: 2025-11-19
modified: 2025-11-19
category: æ•°æ®åº“æŠ€æœ¯
difficulty: advanced
---

# 06-æ€§èƒ½ä¼˜åŒ–

> **å­¦ä¹ ç›®æ ‡**: æŒæ¡æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œæå‡ç®€å•CRUDæ“ä½œçš„æ‰§è¡Œæ•ˆç‡

## ğŸ¯ æœ¬ç« æ¦‚è§ˆ

**å­¦ä¹ æ—¶é—´**: 60-90åˆ†é’Ÿ | **éš¾åº¦ç­‰çº§**: â­â­â­â­â­ | **é‡ç‚¹ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

æ€§èƒ½ä¼˜åŒ–æ˜¯æå‡åº”ç”¨å“åº”é€Ÿåº¦çš„å…³é”®ã€‚æœ¬ç« å°†æ•™ä½ å®ç”¨çš„æ•°æ®åº“ä¼˜åŒ–æŠ€å·§ï¼Œé‡ç‚¹å…³æ³¨ç®€å•CRUDæ“ä½œçš„æ€§èƒ½æå‡ï¼Œè®©ä½ çš„åº”ç”¨è¿è¡Œæ›´å¿«é€Ÿã€‚

---

## ğŸ“‹ æ ¸å¿ƒéœ€æ±‚

### ğŸ¯ ä¸šåŠ¡ç›®æ ‡
- æå‡æŸ¥è¯¢å“åº”é€Ÿåº¦
- å‡å°‘æ•°æ®åº“è¿æ¥å¼€é”€
- ä¼˜åŒ–æ‰¹é‡æ“ä½œæ€§èƒ½
- ç›‘æ§æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡

### ğŸ› ï¸ æŠ€æœ¯éœ€æ±‚
- SQLæŸ¥è¯¢ä¼˜åŒ–
- JPAæ€§èƒ½è°ƒä¼˜
- è¿æ¥æ± é…ç½®ä¼˜åŒ–
- åŸºç¡€ç¼“å­˜ç­–ç•¥

---

## ğŸ—ï¸ æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒç­–ç•¥

### ğŸ¯ ä¼˜åŒ–å±‚æ¬¡

```mermaid
graph TD
    A[æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–] --> B[SQLå±‚ä¼˜åŒ–]
    A --> C[è¿æ¥å±‚ä¼˜åŒ–]
    A --> D[JPAå±‚ä¼˜åŒ–]
    A --> E[åº”ç”¨å±‚ä¼˜åŒ–]

    B --> B1[ç´¢å¼•ä¼˜åŒ–]
    B --> B2[æŸ¥è¯¢ä¼˜åŒ–]
    B --> B3[æ‰¹é‡æ“ä½œ]

    C --> C1[è¿æ¥æ± é…ç½®]
    C --> C2[è¿æ¥å¤ç”¨]
    C --> C3[è¶…æ—¶è®¾ç½®]

    D --> D1[æ‡’åŠ è½½é…ç½®]
    D --> D2[æ‰¹é‡æŠ“å–]
    D --> D3[ç¼“å­˜ç­–ç•¥]

    E --> E1[åˆ†é¡µæŸ¥è¯¢]
    E --> E2[å¼‚æ­¥å¤„ç†]
    E --> E3[ç»“æœç¼“å­˜]

    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style C fill:#fff9c4
    style D fill:#ffccbc
    style E fill:#f8bbd9
```

---

## ğŸ’» å®æˆ˜ï¼šè¿æ¥æ± ä¼˜åŒ–

### 1ï¸âƒ£ HikariCPæ€§èƒ½é…ç½®

```yaml
# ğŸ¯ application.yml - é«˜æ€§èƒ½è¿æ¥æ± é…ç½®
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/clothing_store?useSSL=false&serverTimezone=UTC&rewriteBatchedStatements=true
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver

    # ğŸŠ HikariCPè¿æ¥æ± ä¼˜åŒ–
    hikari:
      # ğŸ”— åŸºç¡€è¿æ¥é…ç½®
      maximum-pool-size: 20              # æœ€å¤§è¿æ¥æ•°
      minimum-idle: 10                    # æœ€å°ç©ºé—²è¿æ¥
      idle-timeout: 600000                # ç©ºé—²è¶…æ—¶ï¼ˆ10åˆ†é’Ÿï¼‰
      connection-timeout: 30000           # è¿æ¥è¶…æ—¶ï¼ˆ30ç§’ï¼‰
      max-lifetime: 1800000               # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰

      # ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®
      auto-commit: true                   # è‡ªåŠ¨æäº¤
      connection-test-query: SELECT 1     # è¿æ¥æµ‹è¯•æŸ¥è¯¢
      validation-timeout: 5000            # éªŒè¯è¶…æ—¶
      leak-detection-threshold: 60000     # è¿æ¥æ³„æ¼æ£€æµ‹ï¼ˆ1åˆ†é’Ÿï¼‰

      # ğŸ“Š ç›‘æ§é…ç½®
      pool-name: "ClothingStoreHikariCP"  # è¿æ¥æ± åç§°
      register-mbeans: true               # æ³¨å†ŒJMXç›‘æ§

  # ğŸ¯ JPAæ€§èƒ½ä¼˜åŒ–
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false                      # ç”Ÿäº§ç¯å¢ƒå…³é—­SQLæ—¥å¿—
    properties:
      hibernate:
        # ğŸš€ æ‰¹å¤„ç†ä¼˜åŒ–
        jdbc:
          batch_size: 50                 # æ‰¹å¤„ç†å¤§å°
          batch_versioned_data: true      # æ‰¹å¤„ç†ç‰ˆæœ¬åŒ–æ•°æ®
        order_inserts: true              # ä¼˜åŒ–æ’å…¥é¡ºåº
        order_updates: true              # ä¼˜åŒ–æ›´æ–°é¡ºåº

        # ğŸ“Š æŸ¥è¯¢ä¼˜åŒ–
        query:
          plan_cache_max_size: 4096      # æŸ¥è¯¢è®¡åˆ’ç¼“å­˜å¤§å°
          in_clause_parameter_padding: true

        # ğŸ” ç»Ÿè®¡ç›‘æ§
        generate_statistics: false       # ç”Ÿäº§ç¯å¢ƒå…³é—­ç»Ÿè®¡
        session:
          events:
            log:
              statement_formatting: false
```

### 2ï¸âƒ£ è¿æ¥æ± ç›‘æ§é…ç½®

```java
@Component
@Slf4j
public class ConnectionPoolMonitor {

    @Autowired
    private DataSource dataSource;

    @EventListener(ApplicationReadyEvent.class)
    public void logConnectionPoolInfo() {
        if (dataSource instanceof HikariDataSource) {
            HikariDataSource hikariDataSource = (HikariDataSource) dataSource;
            HikariPoolMXBean poolProxy = hikariDataSource.getHikariPoolMXBean();

            log.info("ğŸŠ è¿æ¥æ± ä¿¡æ¯:");
            log.info("  ğŸ“Š æ´»è·ƒè¿æ¥æ•°: {}", poolProxy.getActiveConnections());
            log.info("  ğŸ“Š ç©ºé—²è¿æ¥æ•°: {}", poolProxy.getIdleConnections());
            log.info("  ğŸ“Š æ€»è¿æ¥æ•°: {}", poolProxy.getTotalConnections());
            log.info("  ğŸ“Š ç­‰å¾…çº¿ç¨‹æ•°: {}", poolProxy.getThreadsAwaitingConnection());
            log.info("  ğŸ“Š æœ€å¤§è¿æ¥æ•°: {}", hikariDataSource.getMaximumPoolSize());
        }
    }

    @Scheduled(fixedRate = 300000)  // æ¯5åˆ†é’Ÿç›‘æ§ä¸€æ¬¡
    public void monitorConnectionPool() {
        if (dataSource instanceof HikariDataSource) {
            HikariDataSource hikariDataSource = (HikariDataSource) dataSource;
            HikariPoolMXBean poolProxy = hikariDataSource.getHikariPoolMXBean();

            int active = poolProxy.getActiveConnections();
            int total = poolProxy.getTotalConnections();
            int max = hikariDataSource.getMaximumPoolSize();

            double usageRate = (double) active / max * 100;

            if (usageRate > 80) {
                log.warn("âš ï¸ è¿æ¥æ± ä½¿ç”¨ç‡è¿‡é«˜: {:.1f}% ({}/{})", usageRate, active, max);
            } else {
                log.info("ğŸ“Š è¿æ¥æ± çŠ¶æ€: {:.1f}% ({}/{})", usageRate, active, max);
            }
        }
    }
}
```

---

## ğŸ› ï¸ JPAæ€§èƒ½ä¼˜åŒ–

### 1ï¸âƒ£ å®ä½“å±‚ä¼˜åŒ–

```java
@Entity
@Table(name = "users", indexes = {
    @Index(name = "idx_username", columnList = "username"),
    @Index(name = "idx_email", columnList = "email"),
    @Index(name = "idx_role_created", columnList = "role, created_at")
})
@Cacheable  // å¯ç”¨äºŒçº§ç¼“å­˜
@org.hibernate.annotations.Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    // ğŸ“ å­—æ®µé•¿åº¦ä¼˜åŒ–
    @Column(name = "username", unique = true, nullable = false, length = 50)
    private String username;

    @Column(name = "email", unique = true, nullable = false, length = 100)
    private String email;

    // ğŸ“„ å¤§å­—æ®µä½¿ç”¨å»¶è¿ŸåŠ è½½
    @Lob
    @Basic(fetch = FetchType.LAZY)
    @Column(name = "profile_data")
    private String profileData;

    // ğŸ”— ä¸€å¯¹å¤šå…³ç³»ä¼˜åŒ–
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    @BatchSize(size = 20)  // æ‰¹é‡æŠ“å–ä¼˜åŒ–
    private List<Order> orders = new ArrayList<>();

    // ğŸ¨ å¤šå¯¹å¤šå…³ç³»ä¼˜åŒ–
    @ManyToMany(fetch = FetchType.LAZY)
    @JoinTable(
        name = "user_roles",
        joinColumns = @JoinColumn(name = "user_id"),
        inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    @BatchSize(size = 20)
    private Set<Role> roles = new HashSet<>();
}
```

### 2ï¸âƒ£ Repositoryå±‚ä¼˜åŒ–

```java
@Repository
public interface UserRepository extends JpaRepository<User, Long>, JpaSpecificationExecutor<User> {

    // ğŸš€ æ‰¹é‡æ“ä½œä¼˜åŒ–
    @Modifying
    @Query("UPDATE User u SET u.lastLoginTime = :loginTime WHERE u.id = :userId")
    int updateLastLoginTime(@Param("userId") Long userId, @Param("loginTime") LocalDateTime loginTime);

    // ğŸ“Š æ‰¹é‡æ›´æ–°ç”¨æˆ·çŠ¶æ€
    @Modifying
    @Query("UPDATE User u SET u.status = :status WHERE u.id IN :userIds")
    int batchUpdateUserStatus(@Param("userIds") List<Long> userIds, @Param("status") String status);

    // ğŸ” ä¼˜åŒ–çš„ç”¨æˆ·æœç´¢ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
    @Query("SELECT u FROM User u WHERE " +
           "(:username IS NULL OR u.username LIKE CONCAT('%', :username, '%')) AND " +
           "(:role IS NULL OR u.role = :role) AND " +
           "u.createdAt >= :startDate")
    Page<User> searchUsersOptimized(
            @Param("username") String username,
            @Param("role") String role,
            @Param("startDate") LocalDateTime startDate,
            Pageable pageable);

    // ğŸ“Š æŠ•å½±æŸ¥è¯¢ - åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
    @Query("SELECT new com.cmliy.springweb.dto.UserSummary(u.id, u.username, u.email, u.createdAt) " +
           "FROM User u WHERE u.role = :role")
    List<UserSummary> findUserSummariesByRole(@Param("role") String role);

    // ğŸ” ç»Ÿè®¡æŸ¥è¯¢ä¼˜åŒ–
    @Query("SELECT COUNT(u) FROM User u WHERE u.role = :role")
    long countByRole(@Param("role") String role);
}
```

### 3ï¸âƒ£ æœåŠ¡å±‚æ‰¹é‡ä¼˜åŒ–

```java
@Service
@Transactional
public class OptimizedUserService {

    @Autowired
    private UserRepository userRepository;

    @PersistenceContext
    private EntityManager entityManager;

    // ğŸš€ æ‰¹é‡æ’å…¥ä¼˜åŒ–
    @Transactional
    public List<User> batchCreateUsers(List<User> users) {
        List<User> savedUsers = new ArrayList<>();

        for (int i = 0; i < users.size(); i++) {
            User user = users.get(i);
            savedUsers.add(userRepository.save(user));

            // ğŸ”„ æ‰¹å¤„ç†ä¼˜åŒ–ï¼šæ¯50ä¸ªå®ä½“æ¸…ç†ä¸€æ¬¡ç¼“å­˜
            if (i % 50 == 0) {
                entityManager.flush();
                entityManager.clear();
            }
        }

        return savedUsers;
    }

    // ğŸš€ æ‰¹é‡æ›´æ–°ä¼˜åŒ–
    @Transactional
    public int batchUpdateUsers(List<User> users) {
        int updatedCount = 0;

        for (int i = 0; i < users.size(); i++) {
            User user = users.get(i);
            entityManager.merge(user);

            // ğŸ”„ æ‰¹å¤„ç†ä¼˜åŒ–
            if (i % 50 == 0) {
                entityManager.flush();
                entityManager.clear();
            }
            updatedCount++;
        }

        return updatedCount;
    }

    // ğŸ“Š åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
    @Transactional(readOnly = true)
    public Page<UserSummary> getUsersPageOptimized(UserSearchCriteria criteria, Pageable pageable) {
        Specification<User> spec = buildSpecification(criteria);

        // ğŸ¯ ä½¿ç”¨æŠ•å½±æŸ¥è¯¢å‡å°‘æ•°æ®ä¼ è¾“
        return userRepository.findAll(spec, pageable)
                .map(this::convertToSummary);
    }

    private UserSummary convertToSummary(User user) {
        return new UserSummary(
            user.getId(),
            user.getUsername(),
            user.getEmail(),
            user.getCreatedAt()
        );
    }

    private Specification<User> buildSpecification(UserSearchCriteria criteria) {
        return Specification.where(null)
                .and(criteria.hasUsername() ? UserSpecifications.hasUsername(criteria.getUsername()) : null)
                .and(criteria.hasRole() ? UserSpecifications.hasRole(criteria.getRole()) : null);
    }
}
```

---

## ğŸ§ª æ€§èƒ½æµ‹è¯•

### 1ï¸âƒ£ æŸ¥è¯¢æ€§èƒ½æµ‹è¯•

```java
@SpringBootTest
@TestMethodOrder(OrderAnnotation.class)
public class PerformanceTest {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private UserService userService;

    private List<Long> testUserIds;

    @BeforeEach
    public void setupTestData() {
        // åˆ›å»ºæµ‹è¯•æ•°æ®
        testUserIds = new ArrayList<>();
        for (int i = 0; i < 1000; i++) {
            User user = new User();
            user.setUsername("perf_test_" + i);
            user.setEmail("perf_test_" + i + "@example.com");
            user.setPassword("password123");
            user.setRole(i % 3 == 0 ? "ADMIN" : "USER");

            User saved = userRepository.save(user);
            testUserIds.add(saved.getId());
        }
    }

    @Test
    @Order(1)
    public void testSingleQueryPerformance() {
        long startTime = System.currentTimeMillis();

        // ğŸ” å•ä¸ªç”¨æˆ·æŸ¥è¯¢
        for (Long userId : testUserIds.subList(0, 100)) {
            userRepository.findById(userId).orElse(null);
        }

        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;

        System.out.println("ğŸ“Š å•ä¸ªæŸ¥è¯¢100æ¬¡è€—æ—¶: " + duration + "ms");
        assertTrue("æŸ¥è¯¢æ€§èƒ½åº”è¯¥è¶³å¤Ÿå¿«", duration < 1000);
    }

    @Test
    @Order(2)
    public void testBatchQueryPerformance() {
        long startTime = System.currentTimeMillis();

        // ğŸ“Š æ‰¹é‡æŸ¥è¯¢
        List<User> users = userRepository.findAllById(testUserIds.subList(0, 100));

        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;

        assertEquals(100, users.size());
        System.out.println("ğŸ“Š æ‰¹é‡æŸ¥è¯¢100ä¸ªç”¨æˆ·è€—æ—¶: " + duration + "ms");
        assertTrue("æ‰¹é‡æŸ¥è¯¢åº”è¯¥æ›´å¿«", duration < 500);
    }

    @Test
    @Order(3)
    public void testProjectionQueryPerformance() {
        long startTime = System.currentTimeMillis();

        // ğŸ¯ æŠ•å½±æŸ¥è¯¢
        List<UserSummary> summaries = userRepository.findUserSummariesByRole("USER");

        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;

        assertFalse(summaries.isEmpty());
        System.out.println("ğŸ“Š æŠ•å½±æŸ¥è¯¢è€—æ—¶: " + duration + "msï¼Œè¿”å›" + summaries.size() + "æ¡è®°å½•");
        assertTrue("æŠ•å½±æŸ¥è¯¢åº”è¯¥æ›´å¿«", duration < 300);
    }

    @Test
    @Order(4)
    public void testBatchInsertPerformance() {
        // æ¸…ç†æµ‹è¯•æ•°æ®
        userRepository.deleteAll();

        List<User> newUsers = new ArrayList<>();
        for (int i = 0; i < 500; i++) {
            User user = new User();
            user.setUsername("batch_insert_" + i);
            user.setEmail("batch_insert_" + i + "@example.com");
            user.setPassword("password123");
            user.setRole("USER");
            newUsers.add(user);
        }

        long startTime = System.currentTimeMillis();

        // ğŸš€ æ‰¹é‡æ’å…¥
        List<User> savedUsers = userService.batchCreateUsers(newUsers);

        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;

        assertEquals(500, savedUsers.size());
        System.out.println("ğŸ“Š æ‰¹é‡æ’å…¥500ä¸ªç”¨æˆ·è€—æ—¶: " + duration + "ms");
        assertTrue("æ‰¹é‡æ’å…¥åº”è¯¥é«˜æ•ˆ", duration < 2000);
    }
}
```

---

## ğŸš€ å¸¸è§æ€§èƒ½é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### â“ é—®é¢˜1: N+1æŸ¥è¯¢é—®é¢˜

**ç°è±¡**: æŸ¥è¯¢1ä¸ªä¸»å¯¹è±¡ï¼Œè§¦å‘Næ¬¡å…³è”å¯¹è±¡æŸ¥è¯¢

**è§£å†³æ–¹æ¡ˆ**:
```java
// âŒ é—®é¢˜ä»£ç 
@Entity
public class User {
    @OneToMany(mappedBy = "user", fetch = FetchType.LAZY)  // æ‡’åŠ è½½å¯¼è‡´N+1
    private List<Order> orders;
}

// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨JOIN FETCH
@Query("SELECT u FROM User u LEFT JOIN FETCH u.orders WHERE u.id = :userId")
User findUserWithOrders(@Param("userId") Long userId);

// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨@BatchSize
@OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
@BatchSize(size = 20)  // æ‰¹é‡æŠ“å–
private List<Order> orders;

// âœ… è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨EntityGraph
@EntityGraph(attributePaths = {"orders"})
List<User> findAllUsersWithOrders();
```

### â“ é—®é¢˜2: è¿æ¥æ± è€—å°½

**ç°è±¡**: è·å–è¿æ¥è¶…æ—¶ï¼Œåº”ç”¨å“åº”ç¼“æ…¢

**è§£å†³æ–¹æ¡ˆ**:
```yaml
# ğŸ¯ ä¼˜åŒ–è¿æ¥æ± é…ç½®
spring:
  datasource:
    hikari:
      maximum-pool-size: 30              # å¢åŠ æœ€å¤§è¿æ¥æ•°
      minimum-idle: 10                    # ä¿æŒæœ€å°è¿æ¥
      connection-timeout: 60000           # å¢åŠ è¿æ¥è¶…æ—¶
      leak-detection-threshold: 30000     # å‡å°‘æ³„æ¼æ£€æµ‹é˜ˆå€¼
```

### â“ é—®é¢˜3: æŸ¥è¯¢æ…¢

**ç°è±¡**: ç®€å•æŸ¥è¯¢æ‰§è¡Œæ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
```java
// âœ… æ·»åŠ æ•°æ®åº“ç´¢å¼•
@Table(name = "users", indexes = {
    @Index(name = "idx_username", columnList = "username"),
    @Index(name = "idx_email", columnList = "email"),
    @Index(name = "idx_role_created", columnList = "role, created_at")
})

// âœ… ä½¿ç”¨æŠ•å½±æŸ¥è¯¢
@Query("SELECT new com.example.dto.UserSummary(u.id, u.username) FROM User u WHERE u.role = :role")
List<UserSummary> findUserSummariesByRole(@Param("role") String role);

// âœ… åˆ†é¡µæŸ¥è¯¢å¤§æ•°æ®é›†
Page<User> users = userRepository.findAll(PageRequest.of(0, 50));
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡

### ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | è¯´æ˜ |
|------|----------|------|
| è¿æ¥æ± ä½¿ç”¨ç‡ | < 80% | æ´»è·ƒè¿æ¥æ•°/æœ€å¤§è¿æ¥æ•° |
| æŸ¥è¯¢å“åº”æ—¶é—´ | < 100ms | ç®€å•æŸ¥è¯¢æ‰§è¡Œæ—¶é—´ |
| æ‰¹å¤„ç†ååé‡ | > 1000/s | æ¯ç§’å¤„ç†è®°å½•æ•° |
| ç¼“å­˜å‘½ä¸­ç‡ | > 80% | äºŒçº§ç¼“å­˜å‘½ä¸­æ¯”ä¾‹ |
| å†…å­˜ä½¿ç”¨ç‡ | < 70% | JVMå†…å­˜ä½¿ç”¨æƒ…å†µ |

### ğŸ“ˆ ç›‘æ§å®ç°

```java
@Component
@Slf4j
public class PerformanceMonitor {

    @Autowired
    private MeterRegistry meterRegistry;

    @EventListener
    public void handleQueryExecution(QueryExecutionEvent event) {
        Timer.Sample sample = Timer.start(meterRegistry);
        sample.stop(Timer.builder("database.query.duration")
                .tag("query", event.getQueryName())
                .register(meterRegistry));
    }

    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ”¶é›†æŒ‡æ ‡
    public void collectMetrics() {
        // è¿æ¥æ± æŒ‡æ ‡
        collectConnectionPoolMetrics();

        // JVMæŒ‡æ ‡
        collectJVMMetrics();
    }

    private void collectConnectionPoolMetrics() {
        // å®ç°è¿æ¥æ± æŒ‡æ ‡æ”¶é›†
    }

    private void collectJVMMetrics() {
        // å®ç°JVMæŒ‡æ ‡æ”¶é›†
    }
}
```

---

## ğŸ“ æœ¬ç« å°ç»“

### âœ… å·²æŒæ¡æŠ€èƒ½

- [ ] **ç†è§£** æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- [ ] **èƒ½å¤Ÿ** ä¼˜åŒ–è¿æ¥æ± é…ç½®
- [ ] **æŒæ¡** JPAæ€§èƒ½è°ƒä¼˜æŠ€å·§
- [ ] **äº†è§£** æ‰¹é‡æ“ä½œä¼˜åŒ–
- [ ] **èƒ½å¤Ÿ** è¿›è¡Œæ€§èƒ½æµ‹è¯•

### ğŸ¯ å…³é”®è¦ç‚¹

1. **è¿æ¥æ± ä¼˜åŒ–** - åˆç†é…ç½®è¿æ¥æ± å‚æ•°
2. **æŸ¥è¯¢ä¼˜åŒ–** - ä½¿ç”¨ç´¢å¼•ã€æŠ•å½±å’Œæ‰¹é‡æ“ä½œ
3. **JPAè°ƒä¼˜** - æ‡’åŠ è½½ã€æ‰¹å¤„ç†å’Œç¼“å­˜ç­–ç•¥
4. **æ€§èƒ½ç›‘æ§** - æŒç»­ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡

### ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ï¼Œæ¥ä¸‹æ¥å¯ä»¥ï¼š
- â†’ **åŠŸèƒ½ä¸€åç«¯å¼€å‘** - åº”ç”¨ä¼˜åŒ–æŠ€æœ¯å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- â†’ **å®æˆ˜é¡¹ç›®** - åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨æ€§èƒ½ä¼˜åŒ–
- â†’ **é«˜çº§ä¸»é¢˜** - å­¦ä¹ åˆ†å¸ƒå¼æ•°æ®åº“å’Œç¼“å­˜æŠ€æœ¯

---

**è®°ä½ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¸æ–­ç›‘æ§å’Œè°ƒæ•´ï¼** ğŸ‰

---