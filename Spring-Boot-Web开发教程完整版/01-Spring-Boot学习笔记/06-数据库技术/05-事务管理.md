---
tags:
  - äº‹åŠ¡ç®¡ç†
  - Springäº‹åŠ¡
  - ä¼ æ’­è¡Œä¸º
  - éš”ç¦»çº§åˆ«
  - å›æ»š
created: 2025-11-19
modified: 2025-11-19
category: æ•°æ®åº“æŠ€æœ¯
difficulty: intermediate
---

# 05-äº‹åŠ¡ç®¡ç†

> **å­¦ä¹ ç›®æ ‡**: æŒæ¡Springäº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§å’Œå¯é æ€§

## ğŸ¯ æœ¬ç« æ¦‚è§ˆ

**å­¦ä¹ æ—¶é—´**: 60-75åˆ†é’Ÿ | **éš¾åº¦ç­‰çº§**: â­â­â­â­ | **é‡ç‚¹ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥

äº‹åŠ¡ç®¡ç†æ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„é‡è¦æœºåˆ¶ã€‚æœ¬ç« å°†æ•™ä½ Springäº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µå’Œåœ¨ç®€å•CRUDæ“ä½œä¸­çš„åº”ç”¨ï¼Œç¡®ä¿ä½ çš„æ•°æ®åº“æ“ä½œå®‰å…¨å¯é ã€‚

---

## ğŸ“‹ æ ¸å¿ƒéœ€æ±‚

### ğŸ¯ ä¸šåŠ¡ç›®æ ‡
- ç¡®ä¿æ•°æ®åº“æ“ä½œçš„åŸå­æ€§
- å¤„ç†ä¸šåŠ¡æ“ä½œä¸­çš„å¼‚å¸¸å›æ»š
- æ§åˆ¶äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º
- ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§

### ğŸ› ï¸ æŠ€æœ¯éœ€æ±‚
- Springäº‹åŠ¡æ³¨è§£ä½¿ç”¨
- äº‹åŠ¡ä¼ æ’­è¡Œä¸ºç†è§£
- å¼‚å¸¸å¤„ç†ä¸å›æ»š
- äº‹åŠ¡è¾¹ç•Œæ§åˆ¶

---

## ğŸ—ï¸ äº‹åŠ¡ç®¡ç†æ ¸å¿ƒæ¦‚å¿µ

### ğŸ”„ äº‹åŠ¡ACIDç‰¹æ€§

```mermaid
graph TD
    A[äº‹åŠ¡ Transaction] --> B[åŸå­æ€§ Atomicity]
    A --> C[ä¸€è‡´æ€§ Consistency]
    A --> D[éš”ç¦»æ€§ Isolation]
    A --> E[æŒä¹…æ€§ Durability]

    B --> B1[è¦ä¹ˆå…¨éƒ¨æˆåŠŸ<br/>è¦ä¹ˆå…¨éƒ¨å¤±è´¥]
    C --> C1[æ•°æ®çŠ¶æ€å§‹ç»ˆä¸€è‡´]
    D --> D1[å¹¶å‘äº‹åŠ¡äº’ä¸å¹²æ‰°]
    E --> E1[æäº¤åæ°¸ä¹…ä¿å­˜]

    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style C fill:#fff9c4
    style D fill:#ffccbc
    style E fill:#f8bbd9
```

### ğŸ¯ Springäº‹åŠ¡ä¼ æ’­è¡Œä¸º

| ä¼ æ’­è¡Œä¸º | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|----------|------|----------|
| `REQUIRED` | é»˜è®¤å€¼ï¼Œæœ‰äº‹åŠ¡åˆ™åŠ å…¥ï¼Œæ— åˆ™åˆ›å»º | å¤§å¤šæ•°ä¸šåŠ¡æ–¹æ³• |
| `REQUIRES_NEW` | æ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡ | éœ€è¦ç‹¬ç«‹äº‹åŠ¡çš„æ“ä½œ |
| `SUPPORTS` | æœ‰äº‹åŠ¡åˆ™åŠ å…¥ï¼Œæ— åˆ™éäº‹åŠ¡æ‰§è¡Œ | æŸ¥è¯¢æ“ä½œ |
| `NOT_SUPPORTED` | æ€»æ˜¯éäº‹åŠ¡æ‰§è¡Œ | ä¸éœ€è¦äº‹åŠ¡çš„æ“ä½œ |
| `MANDATORY` | å¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™æŠ›å¼‚å¸¸ | å¼ºåˆ¶äº‹åŠ¡è¦æ±‚ |
| `NEVER` | å¿…é¡»éäº‹åŠ¡æ‰§è¡Œï¼Œå¦åˆ™æŠ›å¼‚å¸¸ | ç¦æ­¢äº‹åŠ¡çš„æ“ä½œ |

---

## ğŸ’» å®æˆ˜ï¼šSpringäº‹åŠ¡é…ç½®

### 1ï¸âƒ£ äº‹åŠ¡é…ç½®ç±»

```java
@Configuration
@EnableTransactionManagement  // ğŸ¯ å¯ç”¨äº‹åŠ¡ç®¡ç†
public class TransactionConfig {

    // ğŸ¯ äº‹åŠ¡ç®¡ç†å™¨é…ç½®ï¼ˆSpring Bootè‡ªåŠ¨é…ç½®ï¼Œé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰
    @Bean
    public PlatformTransactionManager transactionManager(EntityManagerFactory entityManagerFactory) {
        return new JpaTransactionManager(entityManagerFactory);
    }

    // ğŸ¯ äº‹åŠ¡æ¨¡æ¿ï¼ˆç¼–ç¨‹å¼äº‹åŠ¡ï¼‰
    @Bean
    public TransactionTemplate transactionTemplate(PlatformTransactionManager transactionManager) {
        TransactionTemplate template = new TransactionTemplate(transactionManager);
        template.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);
        template.setIsolationLevel(TransactionDefinition.ISOLATION_READ_COMMITTED);
        template.setTimeout(30);  // 30ç§’è¶…æ—¶
        return template;
    }
}
```

### 2ï¸âƒ£ ç”¨æˆ·æœåŠ¡äº‹åŠ¡ç®¡ç†

```java
@Service
@Transactional  // ğŸ¯ ç±»çº§åˆ«äº‹åŠ¡ï¼šæ‰€æœ‰publicæ–¹æ³•éƒ½å¯ç”¨äº‹åŠ¡
public class UserService {

    @Autowired
    private UserRepository userRepository;
    @Autowired
    private AuditLogService auditLogService;

    // ğŸ‘¤ åˆ›å»ºç”¨æˆ·ï¼ˆé»˜è®¤äº‹åŠ¡ä¼ æ’­ï¼‰
    @Transactional
    public User createUser(User user) {
        // ğŸ” æ£€æŸ¥ç”¨æˆ·åå”¯ä¸€æ€§
        if (userRepository.existsByUsername(user.getUsername())) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨: " + user.getUsername());
        }

        // ğŸ” æ£€æŸ¥é‚®ç®±å”¯ä¸€æ€§
        if (userRepository.existsByEmail(user.getEmail())) {
            throw new BusinessException("é‚®ç®±å·²å­˜åœ¨: " + user.getEmail());
        }

        // ğŸ’¾ ä¿å­˜ç”¨æˆ·
        User savedUser = userRepository.save(user);

        // ğŸ“ è®°å½•å®¡è®¡æ—¥å¿—ï¼ˆåŒä¸€äº‹åŠ¡ï¼‰
        auditLogService.logUserAction("CREATE_USER", savedUser.getId(),
                                     "åˆ›å»ºç”¨æˆ·: " + savedUser.getUsername());

        return savedUser;
    }

    // ğŸ“ æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    @Transactional
    public User updateUser(Long userId, UserUpdateRequest request) {
        // ğŸ” æŸ¥æ‰¾ç”¨æˆ·
        User user = userRepository.findById(userId)
            .orElseThrow(() -> new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨: " + userId));

        // ğŸ“ è®°å½•æ›´æ–°å‰çŠ¶æ€
        String oldInfo = user.toString();

        // ğŸ”„ æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        if (request.getUsername() != null) {
            user.setUsername(request.getUsername());
        }
        if (request.getEmail() != null) {
            user.setEmail(request.getEmail());
        }

        // ğŸ’¾ ä¿å­˜æ›´æ–°
        User updatedUser = userRepository.save(user);

        // ğŸ“ è®°å½•å®¡è®¡æ—¥å¿—
        auditLogService.logUserAction("UPDATE_USER", userId,
                                     String.format("æ›´æ–°ç”¨æˆ·ä¿¡æ¯: %s -> %s", oldInfo, updatedUser));

        return updatedUser;
    }

    // ğŸ”„ æ‰¹é‡æ›´æ–°ç”¨æˆ·è§’è‰²
    @Transactional
    public int batchUpdateUserRole(List<Long> userIds, String newRole) {
        int updatedCount = 0;

        for (Long userId : userIds) {
            User user = userRepository.findById(userId)
                .orElseThrow(() -> new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨: " + userId));

            String oldRole = user.getRole();
            user.setRole(newRole);
            userRepository.save(user);

            // ğŸ“ è®°å½•è§’è‰²å˜æ›´æ—¥å¿—
            auditLogService.logUserAction("CHANGE_ROLE", userId,
                                         String.format("è§’è‰²å˜æ›´: %s -> %s", oldRole, newRole));

            updatedCount++;
        }

        return updatedCount;
    }

    // ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·ï¼ˆçº§è”åˆ é™¤ç›¸å…³æ•°æ®ï¼‰
    @Transactional
    public void deleteUser(Long userId) {
        User user = userRepository.findById(userId)
            .orElseThrow(() -> new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨: " + userId));

        // ğŸ“ è®°å½•åˆ é™¤æ—¥å¿—ï¼ˆåœ¨åˆ é™¤å‰è®°å½•ï¼‰
        auditLogService.logUserAction("DELETE_USER", userId,
                                     "åˆ é™¤ç”¨æˆ·: " + user.getUsername());

        // ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·ï¼ˆä¼šçº§è”åˆ é™¤ç›¸å…³æ•°æ®ï¼‰
        userRepository.deleteById(userId);
    }

    // ğŸ”„ è½¬è´¦ç¤ºä¾‹ï¼ˆéœ€è¦äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§ï¼‰
    @Transactional
    public void transferUserPoints(Long fromUserId, Long toUserId, Integer points) {
        if (points <= 0) {
            throw new BusinessException("è½¬è´¦ç§¯åˆ†å¿…é¡»å¤§äº0");
        }

        User fromUser = userRepository.findById(fromUserId)
            .orElseThrow(() -> new BusinessException("è½¬å‡ºç”¨æˆ·ä¸å­˜åœ¨: " + fromUserId));

        User toUser = userRepository.findById(toUserId)
            .orElseThrow(() -> new BusinessException("è½¬å…¥ç”¨æˆ·ä¸å­˜åœ¨: " + toUserId));

        // ğŸ” æ£€æŸ¥ä½™é¢
        if (fromUser.getPoints() < points) {
            throw new BusinessException("ç§¯åˆ†ä½™é¢ä¸è¶³");
        }

        // ğŸ’¸ æ‰£é™¤è½¬å‡ºç”¨æˆ·ç§¯åˆ†
        fromUser.setPoints(fromUser.getPoints() - points);
        userRepository.save(fromUser);

        // ğŸ’¸ å¢åŠ è½¬å…¥ç”¨æˆ·ç§¯åˆ†
        toUser.setPoints(toUser.getPoints() + points);
        userRepository.save(toUser);

        // ğŸ“ è®°å½•è½¬è´¦æ—¥å¿—
        auditLogService.logUserAction("TRANSFER_POINTS", fromUserId,
                                     String.format("å‘ç”¨æˆ·%dè½¬è´¦%dç§¯åˆ†", toUserId, points));
        auditLogService.logUserAction("RECEIVE_POINTS", toUserId,
                                     String.format("ä»ç”¨æˆ·%dæ¥æ”¶%dç§¯åˆ†", fromUserId, points));
    }

    // ğŸ” åªè¯»æŸ¥è¯¢ï¼ˆåªè¯»äº‹åŠ¡ä¼˜åŒ–ï¼‰
    @Transactional(readOnly = true)
    public User getUserById(Long userId) {
        return userRepository.findById(userId)
            .orElseThrow(() -> new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨: " + userId));
    }

    // ğŸ“Š ç”¨æˆ·ç»Ÿè®¡ï¼ˆåªè¯»äº‹åŠ¡ï¼‰
    @Transactional(readOnly = true)
    public UserStatistics getUserStatistics() {
        long totalUsers = userRepository.count();
        long activeUsers = userRepository.countByLastLoginTimeAfter(
            LocalDateTime.now().minusDays(30));

        return new UserStatistics(totalUsers, activeUsers);
    }
}
```

---

## ğŸ› ï¸ å¤æ‚äº‹åŠ¡åœºæ™¯

### 1ï¸âƒ£ åµŒå¥—äº‹åŠ¡å¤„ç†

```java
@Service
public class OrderService {

    @Autowired
    private UserService userService;
    @Autowired
    private ProductService productService;
    @Autowired
    private OrderRepository orderRepository;
    @Autowired
    private InventoryService inventoryService;

    // ğŸ›’ åˆ›å»ºè®¢å•ï¼ˆä¸»äº‹åŠ¡ï¼‰
    @Transactional
    public Order createOrder(Long userId, List<OrderItemRequest> items) {
        // ğŸ” éªŒè¯ç”¨æˆ·
        User user = userService.getUserById(userId);

        // ğŸ“¦ åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(userId);
        order.setStatus("PENDING");
        order.setTotalAmount(BigDecimal.ZERO);
        order.setCreatedAt(LocalDateTime.now());

        // ğŸ›ï¸ å¤„ç†è®¢å•é¡¹ï¼ˆåµŒå¥—äº‹åŠ¡ï¼‰
        for (OrderItemRequest item : items) {
            processOrderItem(order, item);
        }

        // ğŸ’¾ ä¿å­˜è®¢å•
        Order savedOrder = orderRepository.save(order);

        // ğŸ“‰ æ‰£å‡åº“å­˜ï¼ˆç‹¬ç«‹äº‹åŠ¡ï¼‰
        try {
            inventoryService.deductInventory(items);
        } catch (InsufficientInventoryException e) {
            throw new BusinessException("åº“å­˜ä¸è¶³ï¼Œè®¢å•åˆ›å»ºå¤±è´¥");
        }

        return savedOrder;
    }

    // ğŸ›ï¸ å¤„ç†è®¢å•é¡¹ï¼ˆå½“å‰äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼‰
    @Transactional(propagation = Propagation.REQUIRED)  // é»˜è®¤ä¼ æ’­è¡Œä¸º
    private void processOrderItem(Order order, OrderItemRequest item) {
        // ğŸ” éªŒè¯å•†å“
        Product product = productService.getProductById(item.getProductId());

        // ğŸ’° è®¡ç®—å°è®¡
        BigDecimal subtotal = product.getPrice().multiply(BigDecimal.valueOf(item.getQuantity()));

        // ğŸ“¦ æ·»åŠ è®¢å•é¡¹
        OrderItem orderItem = new OrderItem();
        orderItem.setProductId(item.getProductId());
        orderItem.setQuantity(item.getQuantity());
        orderItem.setUnitPrice(product.getPrice());
        orderItem.setSubtotal(subtotal);

        order.addItem(orderItem);

        // ğŸ”„ æ›´æ–°è®¢å•æ€»é‡‘é¢
        order.setTotalAmount(order.getTotalAmount().add(subtotal));
    }
}
```

### 2ï¸âƒ£ ç‹¬ç«‹äº‹åŠ¡å¤„ç†

```java
@Service
public class AuditLogService {

    @Autowired
    private AuditLogRepository auditLogRepository;

    // ğŸ“ è®°å½•å®¡è®¡æ—¥å¿—ï¼ˆç‹¬ç«‹äº‹åŠ¡ï¼‰
    @Transactional(propagation = Propagation.REQUIRES_NEW)  // æ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡
    public void logUserAction(String action, Long userId, String description) {
        try {
            AuditLog log = new AuditLog();
            log.setAction(action);
            log.setUserId(userId);
            log.setDescription(description);
            log.setCreatedAt(LocalDateTime.now());
            log.setIpAddress(getCurrentIpAddress());

            auditLogRepository.save(log);
        } catch (Exception e) {
            // ğŸš¨ æ—¥å¿—è®°å½•å¤±è´¥ä¸åº”å½±å“ä¸»ä¸šåŠ¡
            System.err.println("å®¡è®¡æ—¥å¿—è®°å½•å¤±è´¥: " + e.getMessage());
            // ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å½±å“ä¸»äº‹åŠ¡
        }
    }

    // ğŸ“Š æ¸…ç†æ—§æ—¥å¿—ï¼ˆç‹¬ç«‹äº‹åŠ¡ï¼‰
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public int cleanOldLogs(int daysToKeep) {
        LocalDateTime cutoffDate = LocalDateTime.now().minusDays(daysToKeep);
        return auditLogRepository.deleteByCreatedAtBefore(cutoffDate);
    }

    private String getCurrentIpAddress() {
        // è·å–å½“å‰è¯·æ±‚IPåœ°å€çš„å®ç°
        return "127.0.0.1";  // ç®€åŒ–å®ç°
    }
}
```

---

## ğŸ§ª äº‹åŠ¡æµ‹è¯•

### 1ï¸âƒ£ äº‹åŠ¡å›æ»šæµ‹è¯•

```java
@SpringBootTest
@TestMethodOrder(OrderAnnotation.class)
public class TransactionManagementTest {

    @Autowired
    private UserService userService;

    @Test
    @Order(1)
    public void testTransactionRollbackOnException() {
        // ğŸ“Š åˆå§‹ç”¨æˆ·æ•°é‡
        long initialCount = userService.count();

        // ğŸ‘¤ åˆ›å»ºä¸€ä¸ªä¼šå¤±è´¥çš„ç”¨æˆ·ï¼ˆé‚®ç®±é‡å¤ï¼‰
        User user = new User();
        user.setUsername("rollback_test");
        user.setEmail("existing@example.com");  // å‡è®¾è¿™ä¸ªé‚®ç®±å·²å­˜åœ¨
        user.setPassword("password123");

        // âŒ é¢„æœŸä¼šæŠ›å‡ºå¼‚å¸¸å¹¶å›æ»š
        assertThrows(BusinessException.class, () -> {
            userService.createUser(user);
        });

        // âœ… éªŒè¯äº‹åŠ¡å›æ»šï¼šç”¨æˆ·æ•°é‡æ²¡æœ‰å¢åŠ 
        long finalCount = userService.count();
        assertEquals(initialCount, finalCount);

        System.out.println("âœ… äº‹åŠ¡å›æ»šæµ‹è¯•é€šè¿‡ï¼šå¼‚å¸¸åæ•°æ®æœªå‘ç”Ÿå˜åŒ–");
    }

    @Test
    @Order(2)
    public void testSuccessfulTransaction() {
        // ğŸ“Š åˆå§‹ç”¨æˆ·æ•°é‡
        long initialCount = userService.count();

        // ğŸ‘¤ åˆ›å»ºæ­£å¸¸ç”¨æˆ·
        User user = new User();
        user.setUsername("success_test_" + System.currentTimeMillis());
        user.setEmail("success_" + System.currentTimeMillis() + "@example.com");
        user.setPassword("password123");

        // âœ… æˆåŠŸåˆ›å»ºç”¨æˆ·
        User savedUser = userService.createUser(user);

        // âœ… éªŒè¯äº‹åŠ¡æäº¤ï¼šç”¨æˆ·æ•°é‡å¢åŠ 
        long finalCount = userService.count();
        assertEquals(initialCount + 1, finalCount);
        assertNotNull(savedUser.getId());

        System.out.println("âœ… æˆåŠŸäº‹åŠ¡æµ‹è¯•é€šè¿‡ï¼šæ•°æ®æ­£ç¡®ä¿å­˜");
    }

    @Test
    @Order(3)
    public void testNestedTransaction() {
        // ğŸ‘¤ åˆ›å»ºæµ‹è¯•ç”¨æˆ·
        User user = new User();
        user.setUsername("nested_test_" + System.currentTimeMillis());
        user.setEmail("nested_" + System.currentTimeMillis() + "@example.com");
        user.setPassword("password123");
        user.setPoints(100);

        User savedUser = userService.createUser(user);
        assertNotNull(savedUser.getId());

        // ğŸ”„ æµ‹è¯•è½¬è´¦ï¼ˆæ¶‰åŠå¤šä¸ªæ›´æ–°æ“ä½œï¼‰
        Long fromUserId = savedUser.getId();

        // ğŸ‘¤ åˆ›å»ºå¦ä¸€ä¸ªç”¨æˆ·
        User toUser = new User();
        toUser.setUsername("receiver_" + System.currentTimeMillis());
        toUser.setEmail("receiver_" + System.currentTimeMillis() + "@example.com");
        toUser.setPassword("password123");
        toUser.setPoints(50);

        User savedToUser = userService.createUser(toUser);
        Long toUserId = savedToUser.getId();

        // ğŸ’¸ æ‰§è¡Œè½¬è´¦
        userService.transferUserPoints(fromUserId, toUserId, 30);

        // âœ… éªŒè¯è½¬è´¦ç»“æœ
        User updatedFromUser = userService.getUserById(fromUserId);
        User updatedToUser = userService.getUserById(toUserId);

        assertEquals(70, updatedFromUser.getPoints());  // 100 - 30
        assertEquals(80, updatedToUser.getPoints());    // 50 + 30

        System.out.println("âœ… åµŒå¥—äº‹åŠ¡æµ‹è¯•é€šè¿‡ï¼šè½¬è´¦æ“ä½œæˆåŠŸ");
    }
}
```

---

## ğŸš€ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### â“ é—®é¢˜1: äº‹åŠ¡ä¸å›æ»š

**ç°è±¡**: æŠ›å‡ºå¼‚å¸¸åæ•°æ®ä»ç„¶è¢«ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**:
```java
// âœ… æ˜ç¡®æŒ‡å®šå›æ»šå¼‚å¸¸ç±»å‹
@Transactional(rollbackFor = {BusinessException.class, RuntimeException.class})
public void createUser(User user) {
    // ä¸šåŠ¡é€»è¾‘
}

// æˆ–è€…æ•è·å¼‚å¸¸åæ‰‹åŠ¨æ ‡è®°å›æ»š
@Transactional
public void createUser(User user) {
    try {
        // ä¸šåŠ¡é€»è¾‘
    } catch (Exception e) {
        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
        throw e;
    }
}
```

### â“ é—®é¢˜2: åªè¯»äº‹åŠ¡ä¸­çš„å†™æ“ä½œ

**ç°è±¡**: åœ¨åªè¯»äº‹åŠ¡ä¸­è¿›è¡Œå†™æ“ä½œæŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
```java
// âŒ é”™è¯¯ï¼šåªè¯»äº‹åŠ¡ä¸èƒ½å†™æ•°æ®
@Transactional(readOnly = true)
public void updateUser(User user) {
    userRepository.save(user);  // ä¼šæŠ›å‡ºå¼‚å¸¸
}

// âœ… æ­£ç¡®ï¼šå†™æ“ä½œä½¿ç”¨è¯»å†™äº‹åŠ¡
@Transactional
public void updateUser(User user) {
    userRepository.save(user);
}
```

### â“ é—®é¢˜3: äº‹åŠ¡ä¼ æ’­è¡Œä¸ºé…ç½®é”™è¯¯

**ç°è±¡**: åµŒå¥—äº‹åŠ¡è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸ

**è§£å†³æ–¹æ¡ˆ**:
```java
// âœ… æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©æ­£ç¡®çš„ä¼ æ’­è¡Œä¸º
@Transactional(propagation = Propagation.REQUIRES_NEW)  // ç‹¬ç«‹äº‹åŠ¡
public void logOperation(String message) {
    // æ—¥å¿—è®°å½•é€»è¾‘
}

@Transactional(propagation = Propagation.REQUIRED)     // åŠ å…¥ç°æœ‰äº‹åŠ¡
public void businessOperation() {
    // ä¸šåŠ¡é€»è¾‘
    logOperation("æ“ä½œå®Œæˆ");  // ä¼šåœ¨åŒä¸€äº‹åŠ¡ä¸­æ‰§è¡Œ
}
```

---

## ğŸ“Š äº‹åŠ¡æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ğŸ¯ æ˜ç¡®äº‹åŠ¡è¾¹ç•Œ** - åœ¨Serviceå±‚ç®¡ç†äº‹åŠ¡
2. **ğŸ”„ åˆç†è®¾ç½®ä¼ æ’­è¡Œä¸º** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©
3. **ğŸš¨ æ­£ç¡®å¤„ç†å¼‚å¸¸** - æŒ‡å®šå›æ»šå¼‚å¸¸ç±»å‹
4. **ğŸ“Š åªè¯»äº‹åŠ¡ä¼˜åŒ–** - æŸ¥è¯¢æ“ä½œä½¿ç”¨åªè¯»äº‹åŠ¡
5. **â° è®¾ç½®åˆç†è¶…æ—¶** - é¿å…é•¿æ—¶é—´äº‹åŠ¡
6. **ğŸ§ª ç¼–å†™äº‹åŠ¡æµ‹è¯•** - éªŒè¯å›æ»šå’Œæäº¤è¡Œä¸º

### âŒ é¿å…åšæ³•

1. **ğŸš« åœ¨Controllerå±‚ç®¡ç†äº‹åŠ¡**
2. **ğŸš« è¿‡é•¿çš„äº‹åŠ¡æ—¶é—´**
3. **ğŸš« å¿½ç•¥å¼‚å¸¸å¤„ç†**
4. **ğŸš« æ»¥ç”¨REQUIRES_NEWä¼ æ’­**
5. **ğŸš« åœ¨äº‹åŠ¡ä¸­è¿›è¡Œå¤–éƒ¨è°ƒç”¨**

---

## ğŸ“ æœ¬ç« å°ç»“

### âœ… å·²æŒæ¡æŠ€èƒ½

- [ ] **ç†è§£** äº‹åŠ¡ACIDç‰¹æ€§
- [ ] **èƒ½å¤Ÿ** é…ç½®Springäº‹åŠ¡
- [ ] **æŒæ¡** äº‹åŠ¡ä¼ æ’­è¡Œä¸º
- [ ] **äº†è§£** å¼‚å¸¸å¤„ç†ä¸å›æ»š
- [ ] **èƒ½å¤Ÿ** æµ‹è¯•äº‹åŠ¡è¡Œä¸º

### ğŸ¯ å…³é”®è¦ç‚¹

1. **äº‹åŠ¡ç®¡ç†** - ä¿è¯æ•°æ®æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§
2. **ä¼ æ’­è¡Œä¸º** - æ§åˆ¶äº‹åŠ¡ä¹‹é—´çš„è¾¹ç•Œå’Œå…³ç³»
3. **å¼‚å¸¸å¤„ç†** - æ­£ç¡®å¤„ç†å¼‚å¸¸ä»¥ç¡®ä¿äº‹åŠ¡å›æ»š
4. **æ€§èƒ½ä¼˜åŒ–** - åˆç†ä½¿ç”¨åªè¯»äº‹åŠ¡å’Œè¶…æ—¶è®¾ç½®

### ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†äº‹åŠ¡ç®¡ç†ï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š
- â†’ **06-æ€§èƒ½ä¼˜åŒ–** - å­¦ä¹ æ•°æ®åº“æ€§èƒ½è°ƒä¼˜
- â†’ **åŠŸèƒ½ä¸€åç«¯å¼€å‘** - å¼€å§‹å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- â†’ **å®æˆ˜é¡¹ç›®** - åº”ç”¨äº‹åŠ¡ç®¡ç†åˆ°å®é™…ä¸šåŠ¡

---

**è®°ä½ï¼šæ­£ç¡®çš„äº‹åŠ¡ç®¡ç†æ˜¯æ•°æ®ä¸€è‡´æ€§çš„é‡è¦ä¿éšœï¼** ğŸ‰

---