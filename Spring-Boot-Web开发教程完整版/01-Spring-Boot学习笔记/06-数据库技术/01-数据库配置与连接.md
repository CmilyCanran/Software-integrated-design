---
tags:
  - æ•°æ®åº“é…ç½®
  - Spring Boot
  - MySQL
  - è¿æ¥æ± 
  - æ•°æ®æº
created: 2025-11-19
modified: 2025-11-19
category: æ•°æ®åº“æŠ€æœ¯
difficulty: beginner
---

# 01-æ•°æ®åº“é…ç½®ä¸è¿æ¥

> **å­¦ä¹ ç›®æ ‡**: æŒæ¡Spring Bootæ•°æ®åº“ç¯å¢ƒæ­å»ºï¼Œå®ç°ç®€å•çš„æ•°æ®åº“è¿æ¥å’ŒåŸºç¡€CRUDæ“ä½œ

## ğŸ¯ æœ¬ç« æ¦‚è§ˆ

**å­¦ä¹ æ—¶é—´**: 45-60åˆ†é’Ÿ | **éš¾åº¦ç­‰çº§**: â­â­ | **é‡ç‚¹ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥

æœ¬ç« å°†æ•™ä½ å¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­é…ç½®æ•°æ®åº“è¿æ¥ï¼Œä¸ºåç»­çš„CRUDæ“ä½œæ‰“ä¸‹åŸºç¡€ã€‚è€ƒè™‘åˆ°ä½ å·²ç»æŒæ¡SQLï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨Spring Bootçš„é…ç½®å’Œé›†æˆä¸Šã€‚

---

## ğŸ“‹ æ ¸å¿ƒéœ€æ±‚

### ğŸ¯ ä¸šåŠ¡ç›®æ ‡
- é…ç½®MySQLæ•°æ®åº“è¿æ¥
- å®ç°åŸºç¡€çš„æ•°æ®æºé…ç½®
- æµ‹è¯•æ•°æ®åº“è¿æ¥çŠ¶æ€
- ä¸ºç®€å•CRUDæ“ä½œåšå¥½å‡†å¤‡

### ğŸ› ï¸ æŠ€æœ¯éœ€æ±‚
- Spring Bootæ•°æ®æºé…ç½®
- MySQLè¿æ¥å™¨é›†æˆ
- è¿æ¥æ± åŸºç¡€é…ç½®
- å¤šç¯å¢ƒæ•°æ®åº“é…ç½®

---

## ğŸ—ï¸ æ•°æ®åº“é…ç½®æ ¸å¿ƒæ¦‚å¿µ

### ğŸ”§ æ•°æ®æº (DataSource) é…ç½®

Spring Booté€šè¿‡`DataSource`å¯¹è±¡ç®¡ç†æ•°æ®åº“è¿æ¥ï¼š

```java
// ğŸ¯ Spring Bootè‡ªåŠ¨é…ç½®çš„æ•°æ®æº
@Configuration
public class DataSourceConfig {

    @Bean
    @ConfigurationProperties(prefix = "spring.datasource")
    public DataSource dataSource() {
        return DataSourceBuilder.create().build();
    }
}
```

### ğŸ“Š è¿æ¥æ±  (Connection Pool) åŸç†

```mermaid
graph LR
    A[åº”ç”¨ç¨‹åº] --> B[è¿æ¥æ± ]
    B --> C[MySQLæ•°æ®åº“]
    B --> D[è¿æ¥1]
    B --> E[è¿æ¥2]
    B --> F[è¿æ¥N]

    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#fff3e0
```

**è¿æ¥æ± ä¼˜åŠ¿**:
- âœ… **æ€§èƒ½æå‡** - é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯è¿æ¥
- âœ… **èµ„æºç®¡ç†** - é™åˆ¶æœ€å¤§è¿æ¥æ•°
- âœ… **è¿æ¥å¤ç”¨** - æé«˜æ•°æ®åº“è®¿é—®æ•ˆç‡

---

## ğŸ’» å®æˆ˜é…ç½®æ­¥éª¤

### 1ï¸âƒ£ æ·»åŠ MySQLä¾èµ–

åœ¨`pom.xml`ä¸­æ·»åŠ MySQLè¿æ¥å™¨ï¼š

```xml
<dependencies>
    <!-- ğŸ¯ Spring Boot JPA Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>

    <!-- ğŸ”— MySQLè¿æ¥å™¨ -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <scope>runtime</scope>
    </dependency>

    <!-- ğŸ”§ H2æ•°æ®åº“ï¼ˆæµ‹è¯•ç”¨ï¼‰ -->
    <dependency>
        <groupId>com.h2database</groupId>
        <artifactId>h2</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

### 2ï¸âƒ£ é…ç½®æ•°æ®åº“è¿æ¥

åœ¨`application.yml`ä¸­é…ç½®æ•°æ®æºï¼š

```yaml
# ğŸ¯ æ•°æ®åº“é…ç½®
spring:
  datasource:
    # ğŸ”— æ•°æ®åº“è¿æ¥ä¿¡æ¯
    url: jdbc:mysql://localhost:3306/clothing_store?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver

    # ğŸŠ è¿æ¥æ± é…ç½®
    hikari:
      maximum-pool-size: 10              # æœ€å¤§è¿æ¥æ•°
      minimum-idle: 5                    # æœ€å°ç©ºé—²è¿æ¥
      idle-timeout: 300000               # ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      connection-timeout: 20000          # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      max-lifetime: 1200000              # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

  # ğŸ¯ JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: update                   # è‡ªåŠ¨æ›´æ–°è¡¨ç»“æ„
    show-sql: true                       # æ˜¾ç¤ºSQLè¯­å¥
    properties:
      hibernate:
        format_sql: true                 # æ ¼å¼åŒ–SQLè¾“å‡º
        dialect: org.hibernate.dialect.MySQL8Dialect
```

### 3ï¸âƒ£ å¤šç¯å¢ƒé…ç½®

åˆ›å»ºä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼š

**application-dev.yml**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰:
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/clothing_store_dev?useSSL=false&serverTimezone=UTC
    username: root
    password: 123456
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: update
```

**application-prod.yml**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:
```yaml
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/clothing_store?useSSL=true&serverTimezone=UTC
    username: ${DB_USERNAME:app_user}
    password: ${DB_PASSWORD:secure_password}
  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate
```

---

## ğŸ§ª æ•°æ®åº“è¿æ¥æµ‹è¯•

### 1ï¸âƒ£ åˆ›å»ºæµ‹è¯•æ•°æ®åº“

```sql
-- ğŸ¯ åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS clothing_store
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- ğŸ“Š ä½¿ç”¨æ•°æ®åº“
USE clothing_store;

-- ğŸ‘¥ åˆ›å»ºæµ‹è¯•ç”¨æˆ·è¡¨ï¼ˆåç»­ç« èŠ‚ä¼šè¯¦ç»†è®²JPAï¼‰
CREATE TABLE IF NOT EXISTS users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ğŸ“ æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO users (username, email, password) VALUES
('admin', 'admin@example.com', '$2a$10$YourHashedPasswordHere'),
('testuser', 'test@example.com', '$2a$10$YourHashedPasswordHere');
```

### 2ï¸âƒ£ åˆ›å»ºè¿æ¥æµ‹è¯•ç»„ä»¶

```java
@Component
@Slf4j
public class DatabaseConnectionTester {

    @Autowired
    private DataSource dataSource;

    @EventListener(ApplicationReadyEvent.class)
    public void testConnection() {
        try (Connection connection = dataSource.getConnection()) {
            log.info("ğŸ‰ æ•°æ®åº“è¿æ¥æˆåŠŸ!");
            log.info("ğŸ“Š æ•°æ®åº“ä¿¡æ¯: {}", connection.getMetaData().getDatabaseProductName());
            log.info("ğŸ”— è¿æ¥URL: {}", connection.getMetaData().getURL());
            log.info("ğŸ‘¤ ç”¨æˆ·å: {}", connection.getMetaData().getUserName());

            // ğŸ§ª ç®€å•æŸ¥è¯¢æµ‹è¯•
            try (Statement stmt = connection.createStatement();
                 ResultSet rs = stmt.executeQuery("SELECT COUNT(*) FROM users")) {
                if (rs.next()) {
                    log.info("ğŸ‘¥ ç”¨æˆ·è¡¨è®°å½•æ•°: {}", rs.getInt(1));
                }
            }

        } catch (SQLException e) {
            log.error("âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: {}", e.getMessage());
        }
    }
}
```

---

## ğŸš€ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### â“ é—®é¢˜1: è¿æ¥è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**: `Connection timeout`

**è§£å†³æ–¹æ¡ˆ**:
```yaml
spring:
  datasource:
    hikari:
      connection-timeout: 60000        # å¢åŠ è¿æ¥è¶…æ—¶æ—¶é—´
      maximum-pool-size: 20            # å¢åŠ è¿æ¥æ± å¤§å°
```

### â“ é—®é¢˜2: æ—¶åŒºé”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `The server time zone value 'XXX' is unrecognized`

**è§£å†³æ–¹æ¡ˆ**:
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/clothing_store?useSSL=false&serverTimezone=Asia/Shanghai
```

### â“ é—®é¢˜3: SSLè¿æ¥é—®é¢˜

**é”™è¯¯ä¿¡æ¯**: `SSL connection required`

**è§£å†³æ–¹æ¡ˆ**:
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/clothing_store?useSSL=false&allowPublicKeyRetrieval=true
```

---

## ğŸ“Š é…ç½®å‚æ•°è¯¦è§£

### ğŸ”§ æ ¸å¿ƒé…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | æ¨èå€¼ |
|------|--------|------|--------|
| `spring.datasource.url` | - | æ•°æ®åº“è¿æ¥URL | æ ¹æ®ç¯å¢ƒé…ç½® |
| `spring.datasource.username` | - | æ•°æ®åº“ç”¨æˆ·å | åº”ç”¨ä¸“ç”¨ç”¨æˆ· |
| `spring.datasource.password` | - | æ•°æ®åº“å¯†ç  | å¼ºå¯†ç  |
| `spring.datasource.hikari.maximum-pool-size` | 10 | æœ€å¤§è¿æ¥æ•° | 10-20 |
| `spring.datasource.hikari.minimum-idle` | 10 | æœ€å°ç©ºé—²è¿æ¥ | 5-10 |
| `spring.datasource.hikari.connection-timeout` | 30000 | è¿æ¥è¶…æ—¶(ms) | 20000-60000 |

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

**å¼€å‘ç¯å¢ƒ**:
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2
```

**ç”Ÿäº§ç¯å¢ƒ**:
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 10
      max-lifetime: 1800000
```

---

## ğŸ“ æœ¬ç« å°ç»“

### âœ… å·²æŒæ¡æŠ€èƒ½

- [ ] **ç†è§£** Spring Bootæ•°æ®æºé…ç½®åŸç†
- [ ] **èƒ½å¤Ÿ** é…ç½®MySQLæ•°æ®åº“è¿æ¥
- [ ] **æŒæ¡** è¿æ¥æ± åŸºç¡€å‚æ•°è®¾ç½®
- [ ] **äº†è§£** å¤šç¯å¢ƒæ•°æ®åº“é…ç½®æ–¹æ³•
- [ ] **èƒ½å¤Ÿ** æµ‹è¯•æ•°æ®åº“è¿æ¥çŠ¶æ€

### ğŸ¯ å…³é”®è¦ç‚¹

1. **æ•°æ®æºé…ç½®** - é€šè¿‡`application.yml`é…ç½®æ•°æ®åº“è¿æ¥å‚æ•°
2. **è¿æ¥æ± ç®¡ç†** - HikariCPæä¾›é«˜æ•ˆçš„è¿æ¥æ± ç®¡ç†
3. **å¤šç¯å¢ƒæ”¯æŒ** - é€šè¿‡profileå®ç°ä¸åŒç¯å¢ƒçš„é…ç½®
4. **è¿æ¥æµ‹è¯•** - éªŒè¯æ•°æ®åº“è¿æ¥çš„æ­£ç¡®æ€§

### ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†æ•°æ®åº“é…ç½®åŸºç¡€ï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š
- â†’ **02-JPAæ ¸å¿ƒæŠ€æœ¯** - å­¦ä¹ å®ä½“æ˜ å°„å’Œå…³ç³»è®¾è®¡
- â†’ **03-æ•°æ®è®¿é—®å±‚Repository** - æŒæ¡æ•°æ®è®¿é—®æ¥å£è®¾è®¡
- â†’ **å®æˆ˜é¡¹ç›®** - å¼€å§‹å®ç°ç”¨æˆ·è®¤è¯çš„æ•°æ®åº“æ“ä½œ

---

**è®°ä½ï¼šè‰¯å¥½çš„æ•°æ®åº“é…ç½®æ˜¯ç¨³å®šåº”ç”¨çš„åŸºç¡€ï¼** ğŸ‰

---