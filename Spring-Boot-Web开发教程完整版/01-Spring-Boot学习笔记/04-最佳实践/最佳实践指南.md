---
tags:
  - æœ€ä½³å®è·µ
  - Spring Boot
  - ä»£ç è§„èŒƒ
  - æ¶æ„è®¾è®¡
  - æ€§èƒ½ä¼˜åŒ–
created: 2025-11-16
modified: 2025-11-16
category: æœ€ä½³å®è·µ
difficulty: advanced
---

# Spring Boot æœ€ä½³å®è·µæŒ‡å—

## ç›®å½•
- [ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ](#ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ)
- [ä»£ç ç»„ç»‡ä¸æ¶æ„æ¨¡å¼](#ä»£ç ç»„ç»‡ä¸æ¶æ„æ¨¡å¼)
- [æ³¨è§£ä½¿ç”¨è§„èŒƒ](#æ³¨è§£ä½¿ç”¨è§„èŒƒ)
- [å¼‚å¸¸å¤„ç†ä¸é”™è¯¯ç®¡ç†](#å¼‚å¸¸å¤„ç†ä¸é”™è¯¯ç®¡ç†)
- [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
- [å®‰å…¨æœ€ä½³å®è·µ](#å®‰å…¨æœ€ä½³å®è·µ)
- [å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ)
- [ç°ä»£å¼€å‘æ¨è](#ç°ä»£å¼€å‘æ¨è)

---

## ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ

### ğŸ¯ æ ¸å¿ƒåŸåˆ™ï¼šä¼˜å…ˆä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥

> [!IMPORTANT] æ ¸å¿ƒåŸåˆ™
> æ„é€ å‡½æ•°æ³¨å…¥æ˜¯ç°ä»£Spring Bootå¼€å‘çš„é¦–é€‰æ–¹å¼ï¼Œå®ƒæä¾›äº†ä¸å¯å˜æ€§å’Œæ˜ç¡®çš„ä¾èµ–å…³ç³»ã€‚

#### âœ… æ¨èåšæ³•

```java
@Service
public class UserService {

    private final UserRepository userRepository;
    private final EmailService emailService;

    // æ¨èï¼šæ„é€ å‡½æ•°æ³¨å…¥
    public UserService(UserRepository userRepository, EmailService emailService) {
        this.userRepository = userRepository;
        this.emailService = emailService;
    }

    public void createUser(User user) {
        userRepository.save(user);
        emailService.sendWelcomeEmail(user.getEmail());
    }
}
```

#### âœ… ç»“åˆLombokç®€åŒ–ä»£ç 

```java
@Service
@RequiredArgsConstructor  // è‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°
public class UserService {

    private final UserRepository userRepository;
    private final EmailService emailService;

    // æ„é€ å‡½æ•°å’Œå…¶ä»–æ–¹æ³•è‡ªåŠ¨ç”Ÿæˆ
}
```

#### âŒ ä¸æ¨èï¼šå­—æ®µæ³¨å…¥

```java
@Service
public class OldFashionedService {
    @Autowired
    private DependencyService dependencyService;
    // é—®é¢˜ï¼šä¾èµ–ä¸å¯å˜ï¼Œéš¾ä»¥æµ‹è¯•
}
```

### ğŸ”§ å¤„ç†ä¾èµ–å†²çª

#### æƒ…å†µ1ï¼šå¤šä¸ªå®ç°ç±»æ—¶ä½¿ç”¨@Primary

```java
@Service
@Primary  // æŒ‡å®šè¿™ä¸ªæ˜¯é»˜è®¤é€‰é¡¹
public class AlipayService implements PaymentService {
    public void processPayment(double amount) {
        // æ”¯ä»˜å®å®ç°
    }
}

@Service
public class WechatPayService implements PaymentService {
    public void processPayment(double amount) {
        // å¾®ä¿¡æ”¯ä»˜å®ç°
    }
}
```

#### æƒ…å†µ2ï¼šä½¿ç”¨@Qualifierç²¾ç¡®æŒ‡å®š

```java
@Service("alipay")
public class AlipayService implements PaymentService { ... }

@Service("wechatPay")
public class WechatPayService implements PaymentService { ... }

@Service
public class OrderService {
    @Autowired
    public OrderService(@Qualifier("alipay") PaymentService paymentService) {
        this.paymentService = paymentService;
    }
}
```

### ğŸš¨ å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆ

```java
@Service
public class ServiceA {
    @Autowired
    @Lazy  // ä½¿ç”¨@Lazyæ³¨è§£è§£å†³å¾ªç¯ä¾èµ–
    private ServiceB serviceB;
}

@Service
public class ServiceB {
    @Autowired
    private ServiceA serviceA;
}
```

---

## ä»£ç ç»„ç»‡ä¸æ¶æ„æ¨¡å¼

### ğŸ—ï¸ åˆ†å±‚æ¶æ„æœ€ä½³å®è·µ

> [!TIP] æ¶æ„åŸåˆ™
> éµå¾ªæ ‡å‡†çš„åˆ†å±‚æ¶æ„æ¨¡å¼ï¼Œç¡®ä¿ä»£ç ç»“æ„æ¸…æ™°ã€èŒè´£æ˜ç¡®ã€‚

#### æ ‡å‡†ä¸‰å±‚æ¶æ„

```java
// è¡¨ç°å±‚ - Controller
@RestController
@RequestMapping("/api/users")
public class UserController {

    private final UserService userService;

    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.ok(savedUser);
    }
}

// ä¸šåŠ¡å±‚ - Service
@Service
public class UserService {

    private final UserRepository userRepository;

    @Autowired
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public User save(User user) {
        // ä¸šåŠ¡é€»è¾‘å¤„ç†
        user.setCreatedAt(LocalDateTime.now());
        return userRepository.save(user);
    }
}

// æ•°æ®è®¿é—®å±‚ - Repository
@Repository
public class UserRepository {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    public User save(User user) {
        // æ•°æ®åº“æ“ä½œ
        String sql = "INSERT INTO users (name, email) VALUES (?, ?)";
        jdbcTemplate.update(sql, user.getName(), user.getEmail());
        return user;
    }
}
```

### ğŸ“ åŒ…ç»“æ„ç»„ç»‡

```
com.example.project
â”œâ”€â”€ ProjectApplication.java          # ä¸»å¯åŠ¨ç±»
â”œâ”€â”€ controller
â”‚   â””â”€â”€ UserController.java
â”œâ”€â”€ service
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ impl
â”‚       â””â”€â”€ UserServiceImpl.java
â”œâ”€â”€ repository
â”‚   â””â”€â”€ UserRepository.java
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ WebConfig.java
â”‚   â””â”€â”€ DataConfig.java
â”œâ”€â”€ model
â”‚   â”œâ”€â”€ User.java
â”‚   â””â”€â”€ dto
â”‚       â””â”€â”€ UserDTO.java
â””â”€â”€ exception
    â””â”€â”€ GlobalExceptionHandler.java
```

### ğŸ¨ é…ç½®ç±»åˆ†ç¦»åŸåˆ™

#### âŒ é”™è¯¯ï¼šæ‰€æœ‰é…ç½®æ··åœ¨ä¸€èµ·

```java
@Configuration
public class AllInOneConfig {
    // ç½‘ç»œé…ç½®
    @Bean
    public RestTemplate restTemplate() { ... }

    // æ•°æ®åº“é…ç½®
    @Bean
    public DataSource dataSource() { ... }

    // å®‰å…¨é…ç½®
    @Bean
    public SecurityManager securityManager() { ... }

    // ...å‡ åä¸ªBeanå®šä¹‰
}
```

#### âœ… æ­£ç¡®ï¼šæŒ‰èŒè´£åˆ†ç¦»é…ç½®

```java
// ç½‘ç»œé…ç½®
@Configuration
public class WebConfig {
    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

// æ•°æ®åº“é…ç½®
@Configuration
public class DataConfig {
    @Bean
    public DataSource dataSource() {
        return new HikariDataSource();
    }
}

// å®‰å…¨é…ç½®
@Configuration
public class SecurityConfig {
    @Bean
    public SecurityManager securityManager() {
        return new DefaultSecurityManager();
    }
}
```

---

## æ³¨è§£ä½¿ç”¨è§„èŒƒ

### ğŸ“‹ æ³¨è§£é€‰æ‹©æŒ‡å—

> [!NOTE] æ³¨è§£é€‰æ‹©
> æ ¹æ®ä¸åŒçš„åœºæ™¯å’ŒèŒè´£é€‰æ‹©åˆé€‚çš„æ³¨è§£ï¼Œç¡®ä¿ä»£ç è¯­ä¹‰æ¸…æ™°ã€‚

| åœºæ™¯ | æ¨èæ³¨è§£ | è¯´æ˜ |
|------|----------|------|
| **è‡ªå·±å†™çš„ä¸šåŠ¡é€»è¾‘ç±»** | `@Service` | æ˜ç¡®è¡¨ç¤ºä¸šåŠ¡å±‚ç»„ä»¶ |
| **æ•°æ®è®¿é—®å±‚ç±»** | `@Repository` | æä¾›å¼‚å¸¸ç¿»è¯‘åŠŸèƒ½ |
| **Webæ§åˆ¶å™¨** | `@RestController` | å¤„ç†HTTPè¯·æ±‚ |
| **é€šç”¨å·¥å…·ç±»** | `@Component` | æ— æ³•å½’ç±»åˆ°å…¶ä»–ä¸‰å±‚æ—¶ä½¿ç”¨ |
| **ç¬¬ä¸‰æ–¹åº“ç±»** | `@Configuration` + `@Bean` | æ— æ³•ä¿®æ”¹æºç çš„ç±» |

### ğŸ” @ComponentScanæœ€ä½³å®è·µ

#### é»˜è®¤æ‰«æè§„åˆ™

```java
@SpringBootApplication
// é»˜è®¤æ‰«æä¸»å¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…
public class MyProjectApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyProjectApplication.class, args);
    }
}
```

#### æ‰‹åŠ¨æŒ‡å®šæ‰«æè·¯å¾„

```java
@SpringBootApplication
@ComponentScan(basePackages = {
    "com.example.myproject",     // é¡¹ç›®ä¸»åŒ…
    "com.company.common.utils"   // å¤–éƒ¨å·¥å…·åŒ…
})
public class MyProjectApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyProjectApplication.class, args);
    }
}
```

### ğŸ·ï¸ è‡ªå®šä¹‰æ³¨è§£å¢å¼ºè¯­ä¹‰

```java
// åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Component  // ç»§æ‰¿ComponentåŠŸèƒ½
public @interface BeanVehicle {
}

// ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
@BeanVehicle
public class Car {
    public void run() {
        System.out.println("Car is running!");
    }
}

@BeanVehicle
public class Bike {
    public void run() {
        System.out.println("Bike is running!");
    }
}

// æŒ‰ç±»å‹æ³¨å…¥æ‰€æœ‰äº¤é€šå·¥å…·
@Service
public class TransportManager {
    private final List<BeanVehicle> vehicles;

    @Autowired
    public TransportManager(List<BeanVehicle> vehicles) {
        this.vehicles = vehicles;
    }
}
```

---

## å¼‚å¸¸å¤„ç†ä¸é”™è¯¯ç®¡ç†

### ğŸ›¡ï¸ @Repositoryå¼‚å¸¸ç¿»è¯‘æœºåˆ¶

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```java
// âŒ Serviceå±‚ç›´æ¥æ•è·æŠ€æœ¯ç›¸å…³å¼‚å¸¸
@Service
public class UserService {
    public void doSomething() {
        try {
            userRepository.findById(1L);
        } catch (SQLException e) {  // Serviceå±‚å¿…é¡»çŸ¥é“JDBCï¼
            // å¤„ç†...
        }
    }
}
```

#### ä½¿ç”¨@Repositoryçš„ä¼˜é›…æ–¹å¼

```java
@Repository
public class UserRepository {
    public User findById(Long id) {
        // æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½æŠ›å‡ºSQLException
        // @Repositoryä¼šè‡ªåŠ¨å°†å…¶ç¿»è¯‘ä¸ºDataAccessException
    }
}

@Service
public class UserService {
    public void doSomething() {
        try {
            userRepository.findById(1L);
        } catch (DataAccessException e) {  // âœ… æŠ€æœ¯æ— å…³çš„å¼‚å¸¸
            // åªå¤„ç†é€šç”¨çš„æ•°æ®è®¿é—®å¼‚å¸¸
        }
    }
}
```

### ğŸŒ å…¨å±€å¼‚å¸¸å¤„ç†

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusinessException(BusinessException e) {
        ErrorResponse error = new ErrorResponse(e.getCode(), e.getMessage());
        return ResponseEntity.badRequest().body(error);
    }

    // å¤„ç†æ•°æ®è®¿é—®å¼‚å¸¸
    @ExceptionHandler(DataAccessException.class)
    public ResponseEntity<ErrorResponse> handleDataAccessException(DataAccessException e) {
        ErrorResponse error = new ErrorResponse("DATA_ERROR", "æ•°æ®è®¿é—®å¼‚å¸¸");
        return ResponseEntity.status(500).body(error);
    }

    // å¤„ç†å…¶ä»–æ‰€æœ‰å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGenericException(Exception e) {
        ErrorResponse error = new ErrorResponse("INTERNAL_ERROR", "ç³»ç»Ÿå†…éƒ¨é”™è¯¯");
        return ResponseEntity.status(500).body(error);
    }
}
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### âš¡ Beanä½œç”¨åŸŸä¼˜åŒ–

#### é»˜è®¤å•ä¾‹æ¨¡å¼ï¼ˆæ¨èï¼‰

```java
@Service
// é»˜è®¤å°±æ˜¯å•ä¾‹ï¼Œæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªå®ä¾‹
public class UserService {
    // æ— çŠ¶æ€æœåŠ¡ï¼Œé€‚åˆå•ä¾‹
    public User findUser(Long id) {
        return userRepository.findById(id);
    }
}
```

#### åŸå‹æ¨¡å¼ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

```java
@Service
@Scope("prototype")  // æ¯æ¬¡æ³¨å…¥éƒ½åˆ›å»ºæ–°å®ä¾‹
public class StatefulService {
    private String currentState;

    // æœ‰çŠ¶æ€æœåŠ¡ï¼Œéœ€è¦åŸå‹æ¨¡å¼
    public void process(String input) {
        this.currentState = input;
    }
}
```

### ğŸ”„ å»¶è¿ŸåŠ è½½

```java
@Service
@Lazy  // å»¶è¿ŸåŠ è½½ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»º
public class HeavyService {

    @PostConstruct
    public void init() {
        // è€—æ—¶çš„åˆå§‹åŒ–æ“ä½œ
        System.out.println("HeavyService initialized");
    }
}
```

### ğŸ“Š è¿æ¥æ± é…ç½®ä¼˜åŒ–

```java
@Configuration
public class DataConfig {

    @Bean
    @Primary
    public DataSource dataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        config.setUsername("user");
        config.setPassword("password");

        // è¿æ¥æ± ä¼˜åŒ–é…ç½®
        config.setMaximumPoolSize(20);        // æœ€å¤§è¿æ¥æ•°
        config.setMinimumIdle(5);             // æœ€å°ç©ºé—²è¿æ¥
        config.setConnectionTimeout(30000);   // è¿æ¥è¶…æ—¶æ—¶é—´
        config.setIdleTimeout(600000);        // ç©ºé—²è¶…æ—¶æ—¶é—´
        config.setMaxLifetime(1800000);       // è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´

        return new HikariDataSource(config);
    }
}
```

---

## å®‰å…¨æœ€ä½³å®è·µ

### ğŸ” é…ç½®æ–‡ä»¶å®‰å…¨

#### ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯

```properties
# application.properties
spring.datasource.url=${DB_URL:jdbc:mysql://localhost:3306/mydb}
spring.datasource.username=${DB_USERNAME:user}
spring.datasource.password=${DB_PASSWORD:password}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

#### é…ç½®æ–‡ä»¶åŠ å¯†

```java
@Configuration
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();  // ä½¿ç”¨BCryptåŠ å¯†å¯†ç 
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/public/**").permitAll()
                .requestMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .httpBasic(withDefaults());
        return http.build();
    }
}
```

### ğŸ›¡ï¸ è¾“å…¥éªŒè¯

```java
@RestController
public class UserController {

    @PostMapping("/users")
    public ResponseEntity<User> createUser(@Valid @RequestBody UserDTO userDTO) {
        // @Validä¼šè‡ªåŠ¨éªŒè¯UserDTOä¸­çš„æ³¨è§£
        User user = userService.save(userDTO);
        return ResponseEntity.ok(user);
    }
}

public class UserDTO {

    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 2, max = 50, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-50ä¹‹é—´")
    private String name;

    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    private String email;

    @Pattern(regexp = "^[0-9]{11}$", message = "æ‰‹æœºå·å¿…é¡»æ˜¯11ä½æ•°å­—")
    private String phone;

    // getters and setters
}
```

---

## å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

### ğŸ•³ï¸ é™·é˜±1ï¼š@Requiredæ³¨è§£å·²è¿‡æ—¶

> [!WARNING] å·²è¿‡æ—¶æé†’
> @Requiredæ³¨è§£ä»Spring 5.1+å¼€å§‹å·²æ ‡è®°ä¸ºè¿‡æ—¶ï¼Œåº”ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥æ›¿ä»£ã€‚

```java
// âŒ å·²è¿‡æ—¶çš„åšæ³•
@Service
public class OldService {
    private UserRepository userRepository;

    @Required  // Spring 5.1+ å·²æ ‡è®°ä¸ºè¿‡æ—¶
    public void setUserRepository(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}

// âœ… ç°ä»£æ¨èåšæ³•
@Service
public class ModernService {
    private final UserRepository userRepository;

    // æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆæ¨èï¼‰
    public ModernService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

### ğŸ•³ï¸ é™·é˜±2ï¼šfinalç±»æ— æ³•è¢«ä»£ç†

> [!IMPORTANT] AOPä»£ç†é™åˆ¶
> finalç±»æ— æ³•è¢«Spring AOPä»£ç†ï¼Œä¼šå¯¼è‡´äº‹åŠ¡ã€ç¼“å­˜ç­‰æ³¨è§£å¤±æ•ˆã€‚

```java
// âŒ é”™è¯¯ï¼šfinalç±»æ— æ³•è¢«AOPä»£ç†
@Service
public final class FinalService {
    @Transactional  // è¿™ä¸ªäº‹åŠ¡æ³¨è§£å¯èƒ½ä¸ç”Ÿæ•ˆ
    public void doSomething() {
        // ä¸šåŠ¡é€»è¾‘
    }
}

// âœ… æ­£ç¡®ï¼šé¿å…ä½¿ç”¨final
@Service
public class GoodService {
    @Transactional  // äº‹åŠ¡æ­£å¸¸å·¥ä½œ
    public void doSomething() {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

### ğŸ•³ï¸ é™·é˜±3ï¼šçŠ¶æ€ç®¡ç†ä¸å½“

```java
// âŒ é”™è¯¯ï¼šæœ‰çŠ¶æ€Serviceï¼Œçº¿ç¨‹ä¸å®‰å…¨
@Service
public class BadStatefulService {
    private String currentUser;  // è¿™ä¸ªçŠ¶æ€ä¼šè¢«å¤šçº¿ç¨‹å…±äº«

    public void process(String user) {
        this.currentUser = user;  // çº¿ç¨‹Aè®¾ç½®userAï¼Œçº¿ç¨‹Bå¯èƒ½è¦†ç›–
        // ...å…¶ä»–é€»è¾‘
    }
}

// âœ… æ­£ç¡®ï¼šæ— çŠ¶æ€è®¾è®¡ï¼Œçº¿ç¨‹å®‰å…¨
@Service
public class GoodStatelessService {
    public void process(String user) {
        // ç›´æ¥ä½¿ç”¨ä¼ å…¥çš„å‚æ•°ï¼Œä¸ä¿å­˜çŠ¶æ€
        String currentUser = user;
        // ...å…¶ä»–é€»è¾‘
    }
}
```

### ğŸ•³ï¸ é™·é˜±4ï¼šå¾ªç¯ä¾èµ–

```java
// âŒ é”™è¯¯ï¼šç›´æ¥å¾ªç¯ä¾èµ–
@Service
public class ServiceA {
    @Autowired
    private ServiceB serviceB;
}

@Service
public class ServiceB {
    @Autowired
    private ServiceA serviceA;  // å¾ªç¯ä¾èµ–
}

// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨@Lazy
@Service
public class ServiceA {
    @Autowired
    @Lazy
    private ServiceB serviceB;
}

// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šé‡æ„è®¾è®¡ï¼Œæå–å…±åŒä¾èµ–
@Service
public class CommonService {
    // å°†å…±åŒé€»è¾‘æå–åˆ°è¿™é‡Œ
}

@Service
public class ServiceA {
    @Autowired
    private CommonService commonService;
}

@Service
public class ServiceB {
    @Autowired
    private CommonService commonService;
}
```

---

## ç°ä»£å¼€å‘æ¨è

### ğŸš€ Spring Boot 3.x æ–°ç‰¹æ€§

#### ä½¿ç”¨æœ€æ–°æ³¨è§£

```java
// Spring Boot 3.x æ¨èæ–¹å¼
@RestController
@RequestMapping("/api/v1/users")
public class UserController {

    private final UserService userService;

    // Spring 4.3+ å•ä¸ªæ„é€ å‡½æ•°å¯çœç•¥@Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        return ResponseEntity.ok(userService.findById(id));
    }
}
```

#### å“åº”å¼ç¼–ç¨‹æ”¯æŒ

```java
@Service
public class ReactiveUserService {

    private final ReactiveUserRepository userRepository;

    public ReactiveUserService(ReactiveUserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public Mono<User> findById(Long id) {
        return userRepository.findById(id)
                .switchIfEmpty(Mono.error(new UserNotFoundException("User not found")));
    }

    public Flux<User> findAll() {
        return userRepository.findAll();
    }
}

@RestController
public class ReactiveUserController {

    private final ReactiveUserService userService;

    public ReactiveUserController(ReactiveUserService userService) {
        this.userService = userService;
    }

    @GetMapping("/{id}")
    public Mono<ResponseEntity<User>> getUser(@PathVariable Long id) {
        return userService.findById(id)
                .map(ResponseEntity::ok)
                .defaultIfEmpty(ResponseEntity.notFound().build());
    }
}
```

### ğŸ“¦ å®¹å™¨åŒ–æœ€ä½³å®è·µ

#### Dockerfileä¼˜åŒ–

```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM maven:3.8.4-openjdk-17 AS builder
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline
COPY src ./src
RUN mvn clean package -DskipTests

# è¿è¡Œæ—¶é•œåƒ
FROM openjdk:17-jre-slim
WORKDIR /app
COPY --from=builder /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
```

#### å¥åº·æ£€æŸ¥é…ç½®

```java
@Component
public class CustomHealthIndicator implements HealthIndicator {

    private final ExternalServiceClient externalService;

    @Override
    public Health health() {
        try {
            boolean isHealthy = externalService.checkHealth();
            if (isHealthy) {
                return Health.up()
                        .withDetail("externalService", "Available")
                        .build();
            } else {
                return Health.down()
                        .withDetail("externalService", "Unavailable")
                        .build();
            }
        } catch (Exception e) {
            return Health.down()
                    .withDetail("externalService", "Error: " + e.getMessage())
                    .build();
        }
    }
}
```

### ğŸ”§ ç›‘æ§ä¸æ—¥å¿—

#### Actuatoré…ç½®

```properties
# application.properties
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true
```

#### ç»“æ„åŒ–æ—¥å¿—

```java
@Component
@Slf4j
public class UserService {

    public User createUser(UserDTO userDTO) {
        log.info("Creating user with email: {}", userDTO.getEmail());

        try {
            User user = convertToEntity(userDTO);
            User savedUser = userRepository.save(user);

            log.info("Successfully created user with id: {}", savedUser.getId());
            return savedUser;

        } catch (Exception e) {
            log.error("Failed to create user with email: {}", userDTO.getEmail(), e);
            throw new BusinessException("ç”¨æˆ·åˆ›å»ºå¤±è´¥");
        }
    }
}
```

---

## æ€»ç»“

### ğŸ¯ æ ¸å¿ƒåŸåˆ™

> [!IMPORTANT] æ ¸å¿ƒåŸåˆ™
> 1. **ä¾èµ–æ³¨å…¥ä¼˜å…ˆæ„é€ å‡½æ•°æ³¨å…¥**ï¼Œç¡®ä¿ä¸å¯å˜æ€§å’Œæ˜ç¡®ä¾èµ–
> 2. **åˆ†å±‚æ¶æ„èŒè´£æ¸…æ™°**ï¼ŒControllerã€Serviceã€Repositoryå„å¸å…¶èŒ
> 3. **é…ç½®ç±»æŒ‰èŒè´£åˆ†ç¦»**ï¼Œé¿å…"å¤§é€šé“º"å¼çš„é…ç½®ç±»
> 4. **å¼‚å¸¸å¤„ç†ç»Ÿä¸€è§„èŒƒ**ï¼Œä½¿ç”¨@Repositoryçš„å¼‚å¸¸ç¿»è¯‘æœºåˆ¶
> 5. **ä¿æŒæ— çŠ¶æ€è®¾è®¡**ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨
> 6. **éµå¾ªç°ä»£Spring Bootè§„èŒƒ**ï¼Œä½¿ç”¨æœ€æ–°ç‰¹æ€§å’Œæœ€ä½³å®è·µ

### ğŸ“ˆ æŒç»­æ”¹è¿›

> [!TIP] æ”¹è¿›å»ºè®®
> - å®šæœŸå®¡æŸ¥ä»£ç ç»“æ„ï¼Œç¡®ä¿ç¬¦åˆæœ€ä½³å®è·µ
> - å…³æ³¨Spring Bootæ–°ç‰ˆæœ¬ç‰¹æ€§ï¼ŒåŠæ—¶å‡çº§
> - å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹ï¼Œå›¢é˜Ÿå…±åŒç»´æŠ¤ä»£ç è´¨é‡
> - ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•ç¡®ä¿é‡æ„å®‰å…¨
> - ç›‘æ§åº”ç”¨æ€§èƒ½ï¼ŒæŒç»­ä¼˜åŒ–

è¿™äº›æœ€ä½³å®è·µå°†å¸®åŠ©ä½ æ„å»ºæ›´åŠ å¥å£®ã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„Spring Bootåº”ç”¨ç¨‹åºã€‚è®°ä½ï¼Œæœ€å¥½çš„å®è·µæ˜¯é€‚åˆé¡¹ç›®å®é™…æƒ…å†µçš„å®è·µï¼Œçµæ´»è¿ç”¨è¿™äº›åŸåˆ™ï¼Œè€Œä¸æ˜¯ç”Ÿæ¬ç¡¬å¥—ã€‚

---

## ç›¸å…³å­¦ä¹ ç¬”è®°

- [[Springæ³¨è§£è¯¦è§£]] - Springæ³¨è§£å®Œæ•´è¯¦è§£
- [[ä¾èµ–æ³¨å…¥è¯¦è§£]] - ä¾èµ–æ³¨å…¥æ·±åº¦è§£æ
- [[é…ç½®ç®¡ç†è¯¦è§£]] - Spring Booté…ç½®ç®¡ç†

## ç›¸å…³æŠ€æœ¯æ–‡æ¡£

- Spring Bootå®˜æ–¹æ–‡æ¡£ - æœ€æ–°çš„å®˜æ–¹æœ€ä½³å®è·µ
- Spring Frameworkå‚è€ƒæŒ‡å— - æ·±å…¥ç†è§£Springæ ¸å¿ƒæ¦‚å¿µ
- ä»£ç è§„èŒƒå’Œæ ‡å‡† - å›¢é˜Ÿå¼€å‘è§„èŒƒæŒ‡å—