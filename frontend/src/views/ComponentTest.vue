<template>
  <div class="component-test">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="test-header">
      <h1>ğŸ§ª ç»„ä»¶æµ‹è¯•é¡µé¢</h1>
      <p>è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•æ‰€æœ‰å¯å¤ç”¨ç»„ä»¶çš„é¡µé¢ï¼Œåªèƒ½é€šè¿‡æ‰‹åŠ¨è¾“å…¥URLè®¿é—®</p>
    </div>

    <!-- StatusTag ç»„ä»¶æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ“‹ StatusTag çŠ¶æ€æ ‡ç­¾ç»„ä»¶</h2>
      <div class="component-showcase">
        <div class="showcase-item">
          <h4>åœ¨å”®çŠ¶æ€</h4>
          <StatusTag status="available" />
        </div>
        <div class="showcase-item">
          <h4>ä¸‹æ¶çŠ¶æ€</h4>
          <StatusTag status="unavailable" />
        </div>
        <div class="showcase-item">
          <h4>ç¼ºè´§çŠ¶æ€</h4>
          <StatusTag status="out_of_stock" />
        </div>
      </div>
    </div>

    <!-- PriceDisplay ç»„ä»¶æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ’° PriceDisplay ä»·æ ¼æ˜¾ç¤ºç»„ä»¶</h2>
      <div class="component-showcase">
        <div class="showcase-item">
          <h4>æ ‡å‡†ä»·æ ¼</h4>
          <PriceDisplay :price="99.99" />
        </div>
        <div class="showcase-item">
          <h4>å¤§å°ºå¯¸</h4>
          <PriceDisplay :price="199.99" size="large" />
        </div>
        <div class="showcase-item">
          <h4>å°å°ºå¯¸</h4>
          <PriceDisplay :price="29.99" size="small" />
        </div>
        <div class="showcase-item">
          <h4>ç¾å…ƒä»·æ ¼</h4>
          <PriceDisplay :price="49.99" currency="$" />
        </div>
      </div>
    </div>

    <!-- StockIndicator ç»„ä»¶æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ“¦ StockIndicator åº“å­˜æŒ‡ç¤ºå™¨ç»„ä»¶</h2>
      <div class="component-showcase">
        <div class="showcase-item">
          <h4>åº“å­˜å……è¶³</h4>
          <StockIndicator :stock-quantity="50" />
        </div>
        <div class="showcase-item">
          <h4>åº“å­˜ç´§å¼ </h4>
          <StockIndicator :stock-quantity="5" />
        </div>
        <div class="showcase-item">
          <h4>ç¼ºè´§</h4>
          <StockIndicator :stock-quantity="0" />
        </div>
        <div class="showcase-item">
          <h4>æ˜¾ç¤ºæ•°é‡</h4>
          <StockIndicator :stock-quantity="15" :show-count="true" />
        </div>
      </div>
    </div>

    <!-- SearchBox ç»„ä»¶æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ” SearchBox æœç´¢æ¡†ç»„ä»¶</h2>
      <div class="component-showcase">
        <div class="showcase-item full-width">
          <h4>åŸºç¡€æœç´¢æ¡†</h4>
          <SearchBox
            placeholder="æœç´¢å•†å“åç§°..."
            @search="handleSearch"
            @input="handleSearchInput"
          />
        </div>
        <div class="showcase-item full-width">
          <h4>å¸¦å»ºè®®çš„æœç´¢æ¡†</h4>
          <SearchBox
            placeholder="æœç´¢..."
            :suggestions="searchSuggestions"
            :show-suggestions="true"
            @search="handleSearch"
            @suggestion-select="handleSuggestionSelect"
          />
        </div>
      </div>
    </div>

    <!-- PaginationBar ç»„ä»¶æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ“„ PaginationBar åˆ†é¡µå™¨ç»„ä»¶</h2>
      <div class="component-showcase">
        <div class="showcase-item full-width">
          <h4>æ ‡å‡†åˆ†é¡µå™¨</h4>
          <PaginationBar
            :total="100"
            :current-page="currentPage"
            :page-size="10"
            @update:current-page="handlePageChange"
            @update:page-size="handlePageSizeChange"
          />
        </div>
        <div class="showcase-item full-width">
          <h4>å°å°ºå¯¸åˆ†é¡µå™¨</h4>
          <PaginationBar
            :total="50"
            :current-page="2"
            :page-size="5"
            :small="true"
            @update:current-page="handlePageChange"
          />
        </div>
      </div>
    </div>

    <!-- ProductCard ç»„ä»¶æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ›ï¸ ProductCard å•†å“å¡ç‰‡ç»„ä»¶</h2>
      <div class="component-showcase">
        <div class="showcase-item" v-for="product in testProducts" :key="product.id">
          <ProductCard
            :product="product"
            :can-edit="true"
            :can-delete="true"
            :show-actions="true"
            @click="handleProductClick"
            @edit="handleProductEdit"
            @delete="handleProductDelete"
            @add-to-cart="handleAddToCart"
          />
        </div>
      </div>
    </div>

    <!-- äº¤äº’ç»“æœå±•ç¤º -->
    <div class="test-section">
      <h2>ğŸ“Š äº¤äº’æ—¥å¿—</h2>
      <div class="interaction-log">
        <el-button
          type="primary"
          size="small"
          @click="clearLog"
        >
          æ¸…ç©ºæ—¥å¿—
        </el-button>
        <div class="log-container">
          <div
            v-for="(log, index) in interactionLogs"
            :key="index"
            class="log-item"
          >
            <span class="log-time">{{ log.time }}</span>
            <span class="log-event">{{ log.event }}</span>
            <span class="log-detail">{{ log.detail }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import StatusTag from '@/components/StatusTag.vue'
import PriceDisplay from '@/components/PriceDisplay.vue'
import StockIndicator from '@/components/StockIndicator.vue'
import SearchBox from '@/components/SearchBox.vue'
import PaginationBar from '@/components/PaginationBar.vue'
import ProductCard from '@/components/ProductCard.vue'
import type { Product } from '@/types/product'

// å“åº”å¼æ•°æ®
const currentPage = ref<number>(1)
const interactionLogs = ref<Array<{
  time: string
  event: string
  detail: string
}>>([])

// æœç´¢å»ºè®®
const searchSuggestions = ref<string[]>([
  'è¿åŠ¨é‹',
  'ä¼‘é—²è£¤',
  'Tæ¤',
  'è¿è¡£è£™',
  'èƒŒåŒ…',
  'æ‰‹è¡¨',
  'æ‰‹æœºå£³',
  'è€³æœº'
])

// æµ‹è¯•å•†å“æ•°æ®
const testProducts = ref<Product[]>([
  {
    id: 1,
    productName: 'æ—¶å°šè¿åŠ¨é‹ - 2024æ–°æ¬¾',
    description: 'è½»ä¾¿é€æ°”ï¼Œé€‚åˆè·‘æ­¥å’Œæ—¥å¸¸ç©¿ç€ï¼Œé‡‡ç”¨æœ€æ–°ç§‘æŠ€ææ–™åˆ¶ä½œ',
    price: 299.99,
    salesCount: 15,
    discount: 0,
    stockQuantity: 15,
    isAvailable: true,
    creatorId: 1,
    createdAt: '2024-01-15T10:00:00Z',
    updatedAt: '2024-01-15T10:00:00Z',
    images: [
      { id: 1, productId: 1, imageUrl: '/shoe1.jpg', isMain: true, orderIndex: 1 }
    ]
  },
  {
    id: 2,
    productName: 'çº¯æ£‰Tæ¤',
    description: '100%çº¯æ£‰æè´¨ï¼Œèˆ’é€‚é€æ°”ï¼Œå¤šè‰²å¯é€‰',
    price: 59.99,
    salesCount: 50,
    discount: 10,
    stockQuantity: 50,
    isAvailable: true,
    creatorId: 1,
    createdAt: '2024-01-10T15:30:00Z',
    updatedAt: '2024-01-10T15:30:00Z',
    images: [
      { id: 2, productId: 2, imageUrl: '/tshirt1.jpg', isMain: true, orderIndex: 1 }
    ]
  },
  {
    id: 3,
    productName: 'å•†åŠ¡åŒè‚©åŒ…',
    description: 'å¤§å®¹é‡è®¾è®¡ï¼Œé˜²æ°´é¢æ–™ï¼Œé€‚åˆå•†åŠ¡å’Œæ—…è¡Œä½¿ç”¨',
    price: 199.99,
    salesCount: 25,
    discount: 5,
    stockQuantity: 0,
    isAvailable: false,
    creatorId: 1,
    createdAt: '2024-01-05T09:20:00Z',
    updatedAt: '2024-01-05T09:20:00Z',
    images: [
      { id: 3, productId: 3, imageUrl: '/backpack1.jpg', isMain: true, orderIndex: 1 }
    ]
  },
  {
    id: 4,
    productName: 'æ™ºèƒ½æ‰‹è¡¨',
    description: 'å¤šåŠŸèƒ½è¿åŠ¨ç›‘æµ‹ï¼Œå¿ƒç‡ç›‘æµ‹ï¼Œæ¶ˆæ¯æé†’ï¼Œé•¿ç»­èˆª',
    price: 899.99,
    salesCount: 8,
    discount: 0,
    stockQuantity: 8,
    isAvailable: true,
    creatorId: 1,
    createdAt: '2024-01-20T14:15:00Z',
    updatedAt: '2024-01-20T14:15:00Z',
    images: [
      { id: 4, productId: 4, imageUrl: '/watch1.jpg', isMain: true, orderIndex: 1 }
    ]
  }
])

// æ·»åŠ æ—¥å¿—
const addLog = (event: string, detail: string): void => {
  const now = new Date()
  const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`

  interactionLogs.value.unshift({
    time: timeString,
    event,
    detail
  })

  // ä¿æŒæœ€å¤š50æ¡æ—¥å¿—
  if (interactionLogs.value.length > 50) {
    interactionLogs.value = interactionLogs.value.slice(0, 50)
  }
}

// æ¸…ç©ºæ—¥å¿—
const clearLog = (): void => {
  interactionLogs.value = []
}

// æœç´¢ç›¸å…³äº‹ä»¶
const handleSearch = (query: string): void => {
  addLog('æœç´¢', `å…³é”®è¯: "${query}"`)
}

const handleSearchInput = (query: string): void => {
  // å®æ—¶æœç´¢è¾“å…¥äº‹ä»¶
}

const handleSuggestionSelect = (suggestion: string): void => {
  addLog('é€‰æ‹©å»ºè®®', `å»ºè®®: "${suggestion}"`)
}

// åˆ†é¡µç›¸å…³äº‹ä»¶
const handlePageChange = (page: number): void => {
  currentPage.value = page
  addLog('é¡µé¢åˆ‡æ¢', `ç¬¬ ${page} é¡µ`)
}

const handlePageSizeChange = (size: number): void => {
  addLog('æ¯é¡µæ¡æ•°', `${size} æ¡/é¡µ`)
}

// å•†å“å¡ç‰‡ç›¸å…³äº‹ä»¶
const handleProductClick = (product: Product): void => {
  addLog('å•†å“ç‚¹å‡»', product.productName)
}

const handleProductEdit = (product: Product): void => {
  addLog('ç¼–è¾‘å•†å“', product.productName)
}

const handleProductDelete = (product: Product): void => {
  addLog('åˆ é™¤å•†å“', product.productName)
}

const handleAddToCart = (product: Product): void => {
  addLog('åŠ å…¥è´­ç‰©è½¦', product.productName)
}
</script>

<style scoped>
.component-test {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background: #f5f7fa;
  min-height: 100vh;
}

.test-header {
  text-align: center;
  margin-bottom: 40px;
  padding: 30px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.test-header h1 {
  margin: 0 0 10px 0;
  color: #303133;
  font-size: 28px;
}

.test-header p {
  margin: 0;
  color: #606266;
  font-size: 16px;
}

.test-section {
  margin-bottom: 30px;
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.test-section h2 {
  margin: 0 0 20px 0;
  color: #303133;
  font-size: 20px;
  border-bottom: 2px solid #409eff;
  padding-bottom: 8px;
}

.component-showcase {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.showcase-item {
  padding: 15px;
  border: 1px solid #e4e7ed;
  border-radius: 6px;
  text-align: center;
}

.showcase-item.full-width {
  grid-column: 1 / -1;
  text-align: left;
}

.showcase-item h4 {
  margin: 0 0 10px 0;
  color: #606266;
  font-size: 14px;
  font-weight: 500;
}

.interaction-log {
  max-height: 400px;
}

.log-container {
  margin-top: 15px;
  max-height: 350px;
  overflow-y: auto;
  border: 1px solid #e4e7ed;
  border-radius: 4px;
  padding: 10px;
  background: #fafafa;
}

.log-item {
  display: flex;
  gap: 10px;
  padding: 5px 0;
  border-bottom: 1px solid #f0f0f0;
  font-size: 12px;
}

.log-item:last-child {
  border-bottom: none;
}

.log-time {
  color: #909399;
  min-width: 60px;
  font-family: monospace;
}

.log-event {
  color: #409eff;
  min-width: 80px;
  font-weight: 500;
}

.log-detail {
  color: #606266;
  flex: 1;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .component-test {
    padding: 10px;
  }

  .test-header {
    padding: 20px;
  }

  .test-header h1 {
    font-size: 24px;
  }

  .test-header p {
    font-size: 14px;
  }

  .component-showcase {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .showcase-item {
    padding: 12px;
  }
}
</style>