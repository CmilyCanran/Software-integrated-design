---
tags:
  - APIæ–‡æ¡£
  - å•†å“
  - å›¾ç‰‡
  - ä¸Šä¼ 
created: 2025-11-21
modified: 2025-11-21
category: å•†å“API
difficulty: intermediate
---

# ğŸ–¼ï¸ ä¸Šä¼ å•†å“å›¾ç‰‡æ¥å£

## ğŸ“‹ æ¥å£æ¦‚è¿°

å•†å®¶ä¸ºè‡ªå·±çš„å•†å“ä¸Šä¼ å›¾ç‰‡ã€‚

## ğŸ“ è¯·æ±‚ä¿¡æ¯

- **HTTPæ–¹æ³•**: `POST`
- **URLè·¯å¾„**: `/products/{id}/image`
- **æƒé™è¦æ±‚**: SHOPERè§’è‰²ï¼ˆå•†å“åˆ›å»ºè€…ï¼‰
- **Content-Type**: `multipart/form-data`

## ğŸ“¥ è¯·æ±‚å‚æ•°

### è·¯å¾„å‚æ•° (Path Parameters)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | number | æ˜¯ | å•†å“ID |

### è¯·æ±‚ä½“ (Request Body)

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| image | file | æ˜¯ | å›¾ç‰‡æ–‡ä»¶ |

## ğŸ“¤ è¯·æ±‚ç¤ºä¾‹

```
POST /products/2/image
```

```javascript
// ä½¿ç”¨FormDataä¸Šä¼ æ–‡ä»¶
const formData = new FormData()
formData.append('image', fileInput.files[0])
```

## âœ… æˆåŠŸå“åº”

### å“åº”ç»“æ„

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| success | boolean | æ“ä½œæ˜¯å¦æˆåŠŸ |
| code | number | çŠ¶æ€ç  |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | å›¾ç‰‡ä¿¡æ¯ |
| data.imageUrl | string | å›¾ç‰‡URL |

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "code": 200,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageUrl": "http://localhost:8080/images/product2_main.jpg"
  }
}
```

## âŒ é”™è¯¯å“åº”

### é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆå•†å“ä¸å­˜åœ¨ï¼‰

```json
{
  "success": false,
  "code": 404,
  "message": "è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨",
  "data": null
}
```

### é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆæƒé™ä¸è¶³ï¼‰

```json
{
  "success": false,
  "code": 403,
  "message": "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®æ­¤èµ„æº",
  "data": null
}
```

### é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆæ–‡ä»¶è¿‡å¤§ï¼‰

```json
{
  "success": false,
  "code": 400,
  "message": "æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶",
  "data": null
}
```

### é”™è¯¯å“åº”ç¤ºä¾‹ï¼ˆæ–‡ä»¶ç±»å‹ä¸æ”¯æŒï¼‰

```json
{
  "success": false,
  "code": 400,
  "message": "ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹",
  "data": null
}
```

## ğŸ§ª å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```javascript
import { api } from '@/api/request'

// ä¸Šä¼ å•†å“å›¾ç‰‡å‡½æ•°
async function uploadProductImage(productId: number, file: File): Promise<{ imageUrl: string }> {
  try {
    const formData = new FormData()
    formData.append('image', file)

    const response = await api.post<{ imageUrl: string }>(
      `/products/${productId}/image`,
      formData,
      {
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      }
    )

    return response
  } catch (error) {
    console.error('ä¸Šä¼ å›¾ç‰‡å¤±è´¥:', error)
    throw error
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const fileInput = document.getElementById('imageInput') as HTMLInputElement
const productId = 2

if (fileInput.files && fileInput.files[0]) {
  const imageFile = fileInput.files[0]

  uploadProductImage(productId, imageFile)
    .then(response => {
      console.log('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ:', response)
      // æ›´æ–°å•†å“å›¾ç‰‡
      productStore.updateProductImage(productId, response.imageUrl)
    })
    .catch(error => {
      console.error('ä¸Šä¼ å›¾ç‰‡å¤±è´¥:', error)
      // é”™è¯¯å¤„ç†
      if (error.response?.status === 404) {
        console.error('å•†å“ä¸å­˜åœ¨')
      } else if (error.response?.status === 403) {
        console.error('æƒé™ä¸è¶³ï¼Œè¯·ç¡®è®¤æ‚¨æ˜¯è¯¥å•†å“çš„åˆ›å»ºè€…')
      } else if (error.response?.status === 400) {
        if (error.response.data?.message?.includes('å¤§å°')) {
          console.error('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶')
        } else if (error.response.data?.message?.includes('ç±»å‹')) {
          console.error('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹')
        } else {
          console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥')
        }
      }
    })
}
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¤§å°é™åˆ¶**: å•ä¸ªæ–‡ä»¶æœ€å¤§æ”¯æŒ5MB
2. **æ–‡ä»¶ç±»å‹é™åˆ¶**: ä»…æ”¯æŒJPGã€PNGã€GIFæ ¼å¼
3. **å›¾ç‰‡å¤„ç†**: æœåŠ¡å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾å’Œä¸åŒå°ºå¯¸çš„å›¾ç‰‡
4. **URLæ ¼å¼**: è¿”å›çš„å›¾ç‰‡URLå¯ä»¥ç›´æ¥åœ¨å‰ç«¯ä½¿ç”¨
5. **æƒé™éªŒè¯**: åªæœ‰å•†å“åˆ›å»ºè€…æ‰èƒ½ä¸Šä¼ å›¾ç‰‡